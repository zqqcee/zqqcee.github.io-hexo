<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Pull Requestå®Œæ•´è¿‡ç¨‹ã€è®°ä¸€æ¬¡ç»™antvis/G6çš„PRã€‘</title>
    <url>/2023/06/08/aea9cc721cd4/</url>
    <content><![CDATA[<h1 id="Pull-Requestå®Œæ•´è¿‡ç¨‹ã€è®°ä¸€æ¬¡ç»™antvis-G6çš„PRã€‘"><a href="#Pull-Requestå®Œæ•´è¿‡ç¨‹ã€è®°ä¸€æ¬¡ç»™antvis-G6çš„PRã€‘" class="headerlink" title="Pull Requestå®Œæ•´è¿‡ç¨‹ã€è®°ä¸€æ¬¡ç»™antvis/G6çš„PRã€‘"></a>Pull Requestå®Œæ•´è¿‡ç¨‹ã€è®°ä¸€æ¬¡ç»™antvis/G6çš„PRã€‘</h1><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>G6æ­£åœ¨è¿›è¡Œ<code>v4</code>åˆ°<code>v5</code>çš„ç‰ˆæœ¬å‡çº§ï¼Œå‘äº†å‡ ä¸ªIssue Huntï¼Œå› ä¸ºå¾ˆå–œæ¬¢G6ï¼Œæ‰€ä»¥æƒ³å°è¯•å¸®åŠ©å®Œæˆä¸€ä¸ªçŸ©å½¢Itemçš„è¿ç§»ã€‚åœ¨ç¼–å†™æµ‹è¯•demoçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°äº†G6çš„ä¸€ä¸ªä¸¥é‡bugã€‚æœ¬æ–‡è®°å½•äº†æˆ‘ä»å‘ç°bugï¼Œæ’æŸ¥bugåˆ°ç»™G6æPRï¼Œä¸ä»“åº“ç®¡ç†å‘˜æ²Ÿé€šï¼Œæœ€ç»ˆPRè¢«æˆåŠŸmergeçš„è¿‡ç¨‹ã€‚è¿™æ˜¯æˆ‘ç»™G6çš„ç¬¬äºŒä¸ªPRï¼Œç»™æƒ³è¦å‚ä¸å¼€æºï¼Œä¸ºè‡ªå·±å–œæ¬¢çš„é¡¹ç›®è´¡çŒ®ç»µè–„ä¹‹åŠ›çš„æœ‹å‹æä¾›ä¸€å¥—å®Œæ•´çš„è´¡çŒ®æµç¨‹å‚è€ƒã€‚é™„ä¸Šä¸¤æ¬¡Pull Requestçš„é“¾æ¥</p>
<ul>
<li>Doc fix ï¼š<a href="https://github.com/antvis/G6/pull/4554">Fix issue#4552, another 404 not found and typo errors #4554</a></li>
<li>Bug fix ï¼š<a href="https://github.com/antvis/G6/pull/4608">Fix: â€œNode not foundâ€ error from â€˜getNode()â€™#4608</a></li>
</ul>
<h3 id="Bug-é‡ç°"><a href="#Bug-é‡ç°" class="headerlink" title="Bug é‡ç°"></a>Bug é‡ç°</h3><p>è¿™æ˜¯æˆ‘åœ¨ç¼–å†™æµ‹è¯•demoæ—¶ï¼Œå‘ç°G6ä¸­å­˜åœ¨çš„ä¸€ä¸ªbugã€‚æŠ¥é”™ä¿¡æ¯æ˜¾ç¤ºï¼š<code>Node not found for id: 1</code>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202306082202885.png" alt="image"></p>
<p>æ ¹æ®å­—é¢æ„æ€ï¼ŒæŸä¸ªæ–¹æ³•æ”¶åˆ°äº†<code>id</code>ä¸º1çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯åœ¨æˆ‘ä¼ å…¥çš„æ•°æ®ä¸­å¹¶ä¸å­˜åœ¨è¿™ä¸ªèŠ‚ç‚¹ã€‚</p>
<h3 id="é—®é¢˜æ’æŸ¥"><a href="#é—®é¢˜æ’æŸ¥" class="headerlink" title="é—®é¢˜æ’æŸ¥"></a>é—®é¢˜æ’æŸ¥</h3><p>æˆ‘åœ¨<code>Graph.getNode()</code>è¿™ä¸ªæ–¹æ³•çš„å‰åè°ƒè¯•äº†å¾ˆä¹…ï¼Œæ›´å¥‡æ€ªçš„æ˜¯ï¼Œç›´æ¥è°ƒç”¨<code>Graph.getNode(1)</code>å±…ç„¶æ˜¯èƒ½å¤Ÿè¿”å›èŠ‚ç‚¹çš„ã€‚ç”±äºG6çš„ä»£ç ä¸­å†™çš„æ˜¯:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">id</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">  <span class="keyword">const</span> innerModel = graphCore.<span class="title function_">getNode</span>(id);</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æˆ‘åœ¨getNodeä¹‹å‰åœ¨æ§åˆ¶å°<code>console.log</code>äº†<code>id</code>, æ§åˆ¶å°è¾“å‡º<code>1</code>ã€‚è¿™å°±å¾ˆå¥‡æ€ªäº†ï¼Œæˆ‘ä¸€åº¦æ€€ç–‘æ˜¯<code>getNode</code>è¿™ä¸ªæ–¹æ³•å‡ºç°äº†é—®é¢˜ï¼Œä½†æ˜¯<code>getNode</code>æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œåº”è¯¥ä¸å¯èƒ½å‡ºé”™ã€‚</p>
<p>å¦‚æœç›´æ¥è°ƒç”¨<code>Graph.getNode(1)</code> èƒ½å¤Ÿè¿”å›èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯´æ˜idå°±ä¸æ˜¯1ï¼Œäºæ˜¯æˆ‘è¾“å‡ºäº†<code>id==1</code>ï¼Œæœä¸å…¶ç„¶æ§åˆ¶å°è¾“å‡º<code>false</code>ã€‚è¿›ä¸€æ­¥ä½¿ç”¨<code>typeof</code>æŸ¥çœ‹<code>id</code>çš„ç±»å‹ï¼Œæ‰å‘ç°idä¸çŸ¥é“æ€ä¹ˆå·²ç»å˜æˆäº†<code>string</code>ã€‚åŸæ¥ä½¿ç”¨<code>Object.keys()</code>ç”Ÿæˆçš„æ•°ç»„ï¼Œæ— è®º<code>key</code>çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œç»Ÿä¸€ç”Ÿæˆä¸º<code>string</code>æ•°ç»„ã€‚è¿™ä¸ª<code>bug</code>å¾ˆä¸¥é‡å•Šï¼Œå¦‚æœç”¨æˆ·åœ¨æ•°æ®ä¸­å®šä¹‰çš„<code>id</code>æ˜¯<code>number</code>ç±»å‹ï¼Œé‚£ä¹ˆå°†æ— æ³•è·å–åˆ°è¿™ä¸ª<code>Node</code>ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œé—®é¢˜å°±å®šä½å®Œæ¯•äº†ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å…¶å®è¦è§£å†³è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š</p>
<ul>
<li>åœ¨ç”¨æˆ·çš„idä¸º<code>number</code>ç±»å‹æ—¶ï¼Œä½¿ç”¨<code>Number(id)</code>è¿›è¡Œä¸€æ¬¡è½¬æ¢ï¼Œè€Œåœ¨ç”¨æˆ·<code>id</code>ä¸º<code>string</code>ç±»å‹æ—¶ï¼Œä¸åšä»»ä½•å¤„ç†</li>
<li>ä¿®æ”¹<code>getNode()</code>ï¼Œä½¿ä»–èƒ½å¤Ÿè¯†åˆ«ç”¨æˆ·ä¼ å…¥æ•°æ®ä¸­<code>id</code>çš„ç±»å‹</li>
<li>åœ¨æ–‡æ¡£ä¸­å¼ºåˆ¶é™åˆ¶ç”¨æˆ·è¾“å…¥<code>string</code>ç±»å‹ï¼Œå¹¶ä¸”ä½¿ç”¨ç±»å‹æ£€æŸ¥å°†ç”¨æˆ·è¾“å…¥çš„dataé™åˆ¶ä¸ºstring</li>
</ul>
<p>ä¸‰ç§æ–¹æ³•é¦–å…ˆæ’é™¤ç¬¬äºŒç§ï¼Œå› ä¸º<code>getNode()</code>æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œæ˜¯ä»<code>antv</code>çš„æ ¸å¿ƒä»£ç ä»“ä¸­<code>import</code>è¿‡æ¥çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰¾ä¸åˆ°ä¿®æ”¹çš„å…¥å£</p>
<p>æˆ‘è¿™é‡Œé€‰æ‹©äº†ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå¹¶åœ¨PRä¸­æç¤ºäº†ï¼Œå¦‚æœä¸åšä¿®æ”¹çš„è¯éœ€è¦åœ¨æ–‡æ¡£ä¸­æ˜ç¡®æ ‡æ³¨<code>id</code>å¿…é¡»ä¸º<code>string</code>ç±»å‹</p>
<p>åœ¨è§£å†³è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘è¿˜è€ƒè™‘åˆ°äº†ä¸€ç§æƒ…å†µï¼Œå¦‚æœç”¨æˆ·æ¯”è¾ƒè°ƒçš®ï¼Œ<strong>è¾“å…¥çš„<code>id</code>ä¸­åˆæœ‰<code>string</code>ç±»å‹ï¼Œåˆæœ‰<code>number</code>ç±»å‹</strong>åº”è¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿè¿™é‡Œæˆ‘é‡‡ç”¨äº†æ·»åŠ <code>try-catch</code>ä»£ç å—æ¥è¿›è¡Œè§£å†³ã€‚</p>
<h4 id="old-version"><a href="#old-version" class="headerlink" title="old version"></a>old version</h4><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &#x27;id&#x27; variable is always string in here, but one in user data is number, possibly.    </span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">id</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> innerModel = graphCore.<span class="title function_">getNode</span>(id);</span><br><span class="line">	<span class="keyword">const</span> relatedEdgeInnerModels = graphCore.<span class="title function_">getRelatedEdges</span>(id);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="new-version"><a href="#new-version" class="headerlink" title="new version"></a>new version</h4><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Object</span>.<span class="title function_">keys</span>(data).<span class="title function_">forEach</span>(<span class="function">(<span class="params">id</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> innerModel</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    innerModel = graphCore.<span class="title function_">getNode</span>(id);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    innerModel = graphCore.<span class="title function_">getNode</span>(<span class="title class_">Number</span>(id))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> relatedEdgeInnerModels;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    relatedEdgeInnerModels = graphCore.<span class="title function_">getRelatedEdges</span>(id);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    relatedEdgeInnerModels = graphCore.<span class="title function_">getRelatedEdges</span>(<span class="title class_">Number</span>(id));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”æˆ‘åœ¨æˆ‘çš„PRåº•ä¸‹ï¼Œåšäº†å¦‚ä¸‹è¯´æ˜ï¼Œæ¥è¯¢é—®è¿™ä¹ˆåšæ˜¯å¦åˆç†ï¼š</p>
<blockquote>
<p>An error is throwed from this function â€˜getNode()â€™; msg: â€œNode not found for id: 1â€<br>After testing, I found that â€˜idâ€™ variable is always string after <code>Object.keys(update).forEach((id)=&gt;&#123;...&#125;)</code>, but one in user data is number, possibly.<br>I tried adding a <code>try-catch</code> block to fix this bug, but <strong>it doesnâ€™t seem very reasonable to do so</strong>. I guess you can restrict the user to set the <code>id</code> to a string type in the document, or force the <code>id</code> to a string type in the <code>transformer data</code> layer to avoid this error.</p>
<hr>
<p><code>getNode()</code>æ–¹æ³•æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼› æŠ¥é”™ä¿¡æ¯ä¸ºï¼šâ€œæ‰¾ä¸åˆ° idä¸º1çš„èŠ‚ç‚¹â€œ<br>ç»è¿‡æµ‹è¯•ï¼Œæˆ‘å‘ç°<code>id</code>å˜é‡åœ¨<code>Object.keys(update).forEach((id)=&gt;&#123;...&#125;)</code>ä¹‹åæ€»æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä½†æ˜¯è¿™ä¸ª<code>id</code>å˜é‡åœ¨ç”¨æˆ·æ•°æ®ä¸­å¾ˆæœ‰å¯èƒ½æ˜¯æ•°å­—ç±»å‹ã€‚<br>æˆ‘å°è¯•æ·»åŠ ä¸€ä¸ª <code>try-catch</code> å—æ¥ä¿®å¤è¿™ä¸ªé”™è¯¯ï¼Œä½†<strong>è¿™æ ·åšä¼¼ä¹ä¸å¤ªåˆç†</strong>ã€‚ æˆ‘æƒ³ä½ ä»¬å¯ä»¥åœ¨æ–‡æ¡£ä¸­è¯´æ˜ï¼šé™åˆ¶ <code>id</code> ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œæˆ–è€…åœ¨ <code>transformer data</code> å±‚å¼ºåˆ¶å°† <code>id</code> è®¾ç½®ä¸ºå­—ç¬¦ä¸²ç±»å‹æ¥é¿å…è¿™ä¸ªé”™è¯¯ã€‚</p>
</blockquote>
<h4 id="æ”¶åˆ°å›å¤"><a href="#æ”¶åˆ°å›å¤" class="headerlink" title="æ”¶åˆ°å›å¤"></a>æ”¶åˆ°å›å¤</h4><p>å¾ˆå¿«ï¼Œæˆ‘æ”¶åˆ°äº†ä»“åº“ç®¡ç†å‘˜<strong>åå¾</strong>çš„å›å¤ï¼Œå¥¹å›å¤äº†ä¸€ä¸ªğŸ‘ï¼Œæˆ‘å¥½å¼€å¿ƒï¼Œæˆ‘é—®å¥¹è¿™æ˜¯å¯ä»¥æ¥å—çš„å—ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œéœ€ä¸éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªPRæ¥è¿›è¡Œæäº¤ï¼ˆå› ä¸ºæˆ‘ä¸€å¼€å§‹æäº¤çš„PRæœ‰å…¶ä»–ä¿®æ”¹ï¼Œä½†æ˜¯å¦å¤–çš„ä¿®æ”¹æ— æ³•è¢«mergeï¼‰ã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202306082202026.png" alt="image-20230608213348021"></p>
<h3 id="PRæäº¤å®Œæ•´è¿‡ç¨‹"><a href="#PRæäº¤å®Œæ•´è¿‡ç¨‹" class="headerlink" title="PRæäº¤å®Œæ•´è¿‡ç¨‹"></a>PRæäº¤å®Œæ•´è¿‡ç¨‹</h3><p>è¿™ä¸€éƒ¨åˆ†è®°å½•å®Œæ•´çš„PRæäº¤è¿‡ç¨‹ï¼Œå…¶ä¸­åŒ…å«äº†æˆ‘é‡åˆ°çš„é—®é¢˜ï¼Œä¸€å¹¶åšé™ˆè¿°å¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆã€‚å› ä¸ºè¿™æ˜¯æˆ‘ç¬¬äºŒæ¬¡ç»™å¼€æºä»“åº“åšè´¡çŒ®ï¼Œæ‰€ä»¥ä¸€äº›çœ‹èµ·æ¥å¾ˆç®€å•çš„ç»†èŠ‚æˆ‘ä¹Ÿè®°å½•åœ¨è¿™é‡Œï¼Œå¸®åé¢çš„åŒå­¦å°‘è¸©ä¸€äº›å‘ã€‚</p>
<h4 id="forkä»“åº“-amp-cloneä»£ç ä»“"><a href="#forkä»“åº“-amp-cloneä»£ç ä»“" class="headerlink" title="forkä»“åº“ &amp; cloneä»£ç ä»“"></a>forkä»“åº“ &amp; cloneä»£ç ä»“</h4><p>ç›´æ¥forkï¼Œé€‰ä»…forké»˜è®¤åˆ†æ”¯å³å¯ã€‚forkä»“åº“åï¼Œåœ¨è‡ªå·±çš„githubä¸»é¡µå°±èƒ½çœ‹åˆ°ä¸€ä¸ªä¸€æ‘¸ä¸€æ ·çš„ä»£ç ä»“äº†ã€‚è¿™ä¸€æ­¥æ³¨æ„ï¼Œæ˜¯è¦cloneè‡ªå·±forkåçš„ä»£ç ä»“ï¼Œæ¯”å¦‚æˆ‘éœ€è¦cloneçš„åœ°å€æ˜¯ï¼š<code>https://github.com/zqqcee/G6.git</code>,è¿™é‡Œ<code>zqqcee</code>æ˜¯è‡ªå·±çš„ç”¨æˆ·åï¼Œä¸è¦cloneé”™äº†ã€‚</p>
<h4 id="æ·»åŠ upstream"><a href="#æ·»åŠ upstream" class="headerlink" title="æ·»åŠ upstream"></a>æ·»åŠ upstream</h4><p>è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯å°†<code>antvis</code>çš„æºä»“åº“æ·»åŠ ä¸ºä¸Šæ¸¸ä»“åº“ï¼Œä¸ç„¶æˆ‘ä»¬æ— æ³•åŒæ­¥å®ƒä»¬çš„æ›´æ–°ã€‚è¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git remote add upstream &quot;https://github.com/antvis/G6.git&quot;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œå®Œæ¯•åï¼Œè¾“å…¥<code>git remote -v</code> ï¼Œèƒ½å¤Ÿçœ‹åˆ°</p>
<blockquote>
<p>origin:xxxx<br>origin:xxxx<br>upstream:xxxx<br>upstream:xxxx</p>
</blockquote>
<h4 id="fetch-æ–°åˆ†æ”¯"><a href="#fetch-æ–°åˆ†æ”¯" class="headerlink" title="fetch æ–°åˆ†æ”¯"></a>fetch æ–°åˆ†æ”¯</h4><p>ç”±äºæˆ‘æ˜¯ç»™<strong>v5åˆ†æ”¯</strong>æçš„PRï¼Œå› æ­¤æˆ‘éœ€è¦å…ˆ<strong>fetch v5åˆ†æ”¯</strong>ã€‚è¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git fetch upstream/v5</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥<code>git branch -a</code>å°±å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªçº¢è‰²çš„åˆ†æ”¯<code>upstream/v5</code>ï¼Œè¿™è¯´æ˜å·²ç»fetchæˆåŠŸäº†</p>
<p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠè¿™ä¸ªåˆ†æ”¯çš„å†…å®¹åœ¨æœ¬åœ°åˆ›å»ºï¼Œå¹¶è¿›è¡Œä¿®æ”¹ã€‚</p>
<h4 id="åˆ›å»ºæ–°åˆ†æ”¯"><a href="#åˆ›å»ºæ–°åˆ†æ”¯" class="headerlink" title="åˆ›å»ºæ–°åˆ†æ”¯"></a>åˆ›å»ºæ–°åˆ†æ”¯</h4><p>è¿™ä¸€æ­¥åœ¨æˆ‘æ‰§è¡Œçš„æ—¶å€™æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å‘ï¼šæˆ‘åœ¨masteråˆ†æ”¯ä¸Šç›´æ¥è¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git checkout -b v5</span><br><span class="line">git rebase xxx</span><br></pre></td></tr></table></figure>
<p>ç»“æœå‡ºäº†<strong>ä¸€å †å†²çª</strong>ï¼Œåæ¥æ‰çŸ¥é“æ˜¯<strong>æˆ‘çš„v5åˆ†æ”¯æ˜¯ä»masteråˆ†æ”¯ä¸Šåˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯ä»è¿œç¨‹æ‹‰è¿‡æ¥çš„</strong>ã€‚</p>
<p>åº”è¯¥è¾“å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git checkout -b origin/v5 upstream/v5</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ­¥çš„æ„æ€æ˜¯ä»<code>upstream/v5</code>åˆ†æ”¯åˆ›å»ºä¸€ä¸ª<code>origin/v5</code>åˆ†æ”¯ã€‚</p>
<p>åˆ°è¿™é‡Œè¿˜æ²¡ç»“æŸï¼Œå› ä¸ºè¿™ä¸ª<code>origin/v5</code>åˆ†æ”¯æ˜¯æˆ‘ä»¬ä»upstreamä¸­æ‹‰å–å‡ºæ¥çš„ï¼Œæˆ‘çš„ä¹ æƒ¯æ˜¯è¦åœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šå†æ–°å»ºä¸€ä¸ªåˆ†æ”¯åšå¼€å‘ï¼Œåˆ†æ”¯åä¹Ÿæœ‰ä¸€äº›å«ä¹‰ï¼Œäºæ˜¯æ¥ç€è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git checkout -b v5-fix#NodeNotFound</span><br></pre></td></tr></table></figure>
<h4 id="å®Œæˆä¿®æ”¹ï¼ˆæ³¨æ„commitè§„èŒƒï¼‰"><a href="#å®Œæˆä¿®æ”¹ï¼ˆæ³¨æ„commitè§„èŒƒï¼‰" class="headerlink" title="å®Œæˆä¿®æ”¹ï¼ˆæ³¨æ„commitè§„èŒƒï¼‰"></a>å®Œæˆä¿®æ”¹ï¼ˆæ³¨æ„commitè§„èŒƒï¼‰</h4><p>å†™å®Œä»£ç åæ³¨æ„è‡ªå·±çš„commitè§„èŒƒï¼Œæ¯ä¸€ä¸ªcommitéƒ½è¦è®©åˆ«äººèƒ½çœ‹æ‡‚ï¼Œä¸è¦å…¨éƒ¨ä¿®æ”¹å®Œå†åšæäº¤ã€‚è¿™é‡Œæˆ‘æŠŠæ¯ä¸€ä¸ªä¿®æ”¹çš„å«ä¹‰éƒ½åˆ†å¾—æ¯”è¾ƒæ¸…æ¥šï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>bug é‡ç° commit</li>
<li>bug ä¿®å¤ commit</li>
</ul>
<h4 id="pushåˆ°ä¸ªäººä»“åº“"><a href="#pushåˆ°ä¸ªäººä»“åº“" class="headerlink" title="pushåˆ°ä¸ªäººä»“åº“"></a>pushåˆ°ä¸ªäººä»“åº“</h4><p>åœ¨è¿™ä¸€æ­¥æˆ‘é‡åˆ°äº†å¤§éº»çƒ¦ï¼Œç”±äºG6å‘å¸ƒäº†<code>issue hunt</code>,å› æ­¤è¿™é‡Œæˆ‘pushåˆ°ä¸ªäººä»“åº“æ—¶ï¼Œç”±äºæˆ‘çš„<strong><code>personal token</code>æ²¡æœ‰åŒ…å«workflowï¼Œ</strong>å› æ­¤pushä¸æˆåŠŸã€‚æŠ¥é”™ï¼š<strong>â€œrefusing to allow a Personal Access Token to create or update workflow <code>.github/workflows/build.yml</code> without <code>workflow</code> scopeâ€</strong></p>
<p>è¿™ä¸€æ­¥æ­£ç¡®çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡æ–°åˆ›å»ºä¸€ä¸ªTokenå¹¶pushï¼Œä½†æ˜¯æˆ‘ä¸ºäº†çœäº‹ï¼Œç›´æ¥æŠŠworkflowåˆ æ‰äº†ã€‚ç»“æœPRå°±æ²¡æœ‰è¢«åˆï¼Œå¹¶ä¸”æ”¶åˆ°äº†è¿™ä¸ªcommentï¼š</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202306082202094.png" alt="image-20230608215157196"></p>
<p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆæˆ‘ä¹Ÿè®°å½•åœ¨æ­¤å¤„ï¼š</p>
<ul>
<li><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªtoken,å‹¾é€‰workflowï¼Œè¿™ä¸€æ­¥åœ¨ç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œè·Ÿç€åšå°±å¥½äº†ï¼Œè¿™é‡Œä¸åšè¿‡å¤šèµ˜è¿°</p>
</li>
<li><p>æ¥ç€ï¼Œé‡æ–°è®¾ç½®<code>origin</code>ã€‚è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git remote remove origin </span><br><span class="line">git remote add origin https://&#123;token&#125;@github.com/zqqcee/G6.git</span><br></pre></td></tr></table></figure>
<p>å°†<code>&#123;token&#125;</code>æ›¿æ¢ä¸ºåˆšåˆšåˆ›å»ºçš„å¸¦workflowçš„token</p>
</li>
<li><p>æœ€åï¼Œé‡æ–°pushå°±èƒ½æˆåŠŸäº†</p>
</li>
</ul>
<h4 id="åˆ›å»ºPull-Request"><a href="#åˆ›å»ºPull-Request" class="headerlink" title="åˆ›å»ºPull Request"></a>åˆ›å»ºPull Request</h4><p>åˆ°forkçš„ä»“åº“ä¸­ï¼ŒpushæˆåŠŸåï¼Œä»“åº“ä¸­ä¼šæ˜¾ç¤ºæœ‰ä¸€ä¸ªæ–°çš„åˆ†æ”¯ã€‚ç„¶åç‚¹å‡»<code>Pull Request</code></p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„<code>Pull Request</code></p>
<p>è¿™ä¸€æ­¥æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œé‡ç‚¹æ˜¯è¦é€‰å¯¹ä½ è¦ä¿®æ”¹çš„åˆ†æ”¯</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202306082202467.png" alt="image-20230608215845380"></p>
<h4 id="å¡«å†™PRä¿¡æ¯"><a href="#å¡«å†™PRä¿¡æ¯" class="headerlink" title="å¡«å†™PRä¿¡æ¯"></a>å¡«å†™PRä¿¡æ¯</h4><p>PRä¿¡æ¯éå¸¸å…³é”®ï¼Œå¿…é¡»éå¸¸æ¸…æ¥šåœ°è¯´æ˜ä½ ä¸ºä»€ä¹ˆè¦åˆ›å»ºè¿™ä¸ªPR ï¼Œä»¥åŠè¿™ä¸ªPRä¿®å¤äº†ä»€ä¹ˆé—®é¢˜ã€‚è¿™é‡Œç›´æ¥è´´ä¸Šæˆ‘çš„PR è¯´æ˜ï¼Œä¾›å‚è€ƒã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202306082203170.png" alt="iShot_2023-06-08_21.59.51"></p>
<hr>
<p><strong>ä»¥ä¸Šå°±æ˜¯å…¨éƒ¨çš„è§£å†³è¿‡ç¨‹äº†ï¼Œå¾ˆå¼€å¿ƒèƒ½ä¸ºG6åšäº†è´¡çŒ®ï¼Œå¸Œæœ›æœ‰æœºä¼šèƒ½åŠ å…¥AntVå›¢é˜Ÿï¼Œä¹Ÿå¸Œæœ›è‡ªå·±èƒ½ä¸ºæ›´å¤šä»“åº“åˆ›å»ºæ›´ä¼˜ç§€çš„PRï½ï¼</strong></p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€D3.js å­¦ä¹ è®°å½•ï¼ˆå®æˆ˜ï¼‰ã€‘Force åŠ›å¯¼å›¾æ•°æ®å¯è§†åŒ–</title>
    <url>/2022/08/03/aab110ab011c/</url>
    <content><![CDATA[<h2 id="Force-Simulation-åŠ›å¯¼å›¾å®æˆ˜-D3-js"><a href="#Force-Simulation-åŠ›å¯¼å›¾å®æˆ˜-D3-js" class="headerlink" title="Force Simulation åŠ›å¯¼å›¾å®æˆ˜  @ D3.js"></a>Force Simulation åŠ›å¯¼å›¾å®æˆ˜  @ D3.js</h2><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>åšåŠ›å¯¼å›¾ä½¿ç”¨åˆ°çš„æ•°æ®ä¸ºjsonæ•°æ®ï¼Œä¸€èˆ¬é‡‡ç”¨jsonæ•°æ®æ¥è¡¨è¾¾å›¾ç»“æ„ã€‚æœ¬æ¬¡å®éªŒé€‰ç”¨çš„jsonæ•°æ®æ•°æ®ç»“æ„å¦‚ä¸‹ï¼ˆå›¾ç‰‡ä¸­ä¸ºç»è¿‡äº†åŠ›æ¨¡æ‹Ÿåçš„ï¼‰ï¼š</p>
<ul>
<li>linksè‡³å°‘è¦ç”±<code>target</code>, <code>source</code>ç»„æˆ<ul>
<li>è¿™è¿ä¸ªå±æ€§æ ‡è®°äº†èµ·å§‹nodeå’Œç»ˆæ­¢nodeï¼Œå…¶å€¼é€š<img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202307060008078.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å¸¸ä¸º<strong>nodeçš„idã€‚</strong></li>
</ul>
</li>
<li>nodeç”±<code>group</code>å’Œ<code>id</code>æ„æˆ<ul>
<li>groupè¡¨ç¤ºnodeå±äºå“ªä¸€ç±»ï¼ˆæ–¹ä¾¿ç€è‰²ï¼‰</li>
<li>idæ˜¯nodeçš„å”¯ä¸€æ ‡è¯†ç¬¦</li>
</ul>
</li>
</ul>
<h3 id="æ€è·¯åˆ†æ"><a href="#æ€è·¯åˆ†æ" class="headerlink" title="æ€è·¯åˆ†æ"></a>æ€è·¯åˆ†æ</h3><ul>
<li>ç”»å¸ƒåˆå§‹åŒ–ï¼Œå…¨å±€å˜é‡å®šä¹‰</li>
<li>æ•°æ®è¯»å–</li>
<li>åŠ›æ¨¡æ‹Ÿ</li>
<li>æ•°æ®ç»‘å®š datajoin<ul>
<li>ç»“ç‚¹nodeï¼ˆ<circle>å’Œ<text>ï¼‰</li>
<li>è¿è¾¹link</li>
</ul>
</li>
<li><code>simulation.on(&quot;tick&quot;,tick)</code>ï¼Œtickå‡½æ•°ç¼–å†™</li>
<li>drag æ‹–æ›³äº¤äº’è®¾è®¡</li>
</ul>
<h3 id="ç”»å¸ƒåˆå§‹åŒ–ï¼Œå…¨å±€å˜é‡å®šä¹‰"><a href="#ç”»å¸ƒåˆå§‹åŒ–ï¼Œå…¨å±€å˜é‡å®šä¹‰" class="headerlink" title="ç”»å¸ƒåˆå§‹åŒ–ï¼Œå…¨å±€å˜é‡å®šä¹‰"></a>ç”»å¸ƒåˆå§‹åŒ–ï¼Œå…¨å±€å˜é‡å®šä¹‰</h3><p>è¿™æ­¥æ¯”è¾ƒåŸºç¡€ï¼Œç›´æ¥è´´ä¸Šä»£ç </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;svg&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> height = +(svg.<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> width = +(svg.<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> margin = &#123;</span><br><span class="line">    <span class="attr">top</span>:<span class="number">150</span>,</span><br><span class="line">    <span class="attr">left</span>:<span class="number">50</span>,</span><br><span class="line">    <span class="attr">right</span>:<span class="number">50</span>,</span><br><span class="line">    <span class="attr">bottom</span>:<span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> innerHeight = height-margin.<span class="property">top</span>-margin.<span class="property">bottom</span>;</span><br><span class="line"><span class="keyword">const</span> innerWidth = width - margin.<span class="property">left</span> - margin.<span class="property">right</span>;</span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="title function_">scaleOrdinal</span>(d3.<span class="property">schemeCategory10</span>);</span><br><span class="line"><span class="keyword">let</span> link;</span><br><span class="line"><span class="keyword">let</span> nodes;</span><br><span class="line"><span class="keyword">let</span> simulation;</span><br><span class="line"><span class="keyword">const</span> render_init = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    svg.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;font-size&#x27;</span>,<span class="string">&#x27;2em&#x27;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>,margin.<span class="property">left</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;y&#x27;</span>, margin.<span class="property">top</span>/<span class="number">2</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">`translate(0,-40)`</span> )</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;font-weight&#x27;</span>, <span class="string">&#x27;bold&#x27;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>,<span class="string">&#x27;blue&#x27;</span> )</span><br><span class="line">        .<span class="title function_">html</span>(<span class="string">&quot;Force  Simulation&quot;</span>)</span><br><span class="line"></span><br><span class="line">    svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;maingroup&#x27;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>, margin.<span class="property">left</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;y&#x27;</span>, margin.<span class="property">top</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>,<span class="subst">$&#123;margin.top&#125;</span>)`</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,innerWidth )</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,innerHeight )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®è¯»å–"><a href="#æ•°æ®è¯»å–" class="headerlink" title="æ•°æ®è¯»å–"></a>æ•°æ®è¯»å–</h3><p>é€šå¸¸è¯»å–è¿›æ¥çš„æ•°æ®è¦è¿›è¡Œé¢„å¤„ç†ï¼Œä½†æ˜¯å›¾æ•°æ®æœ‰äº›ä¸åŒã€‚<strong>é€šå¸¸æˆ‘ä»¬æ‹¿åˆ°çš„æ•°æ®éƒ½æ˜¯ä¸ç¬¦åˆd3åŠ›å¯¼å›¾æ•°æ®ç»“æ„è¦æ±‚çš„</strong>ã€‚ä¸€èˆ¬ç”¨pythonç­‰è¯­è¨€å†™çš„<strong>è„šæœ¬æ–‡ä»¶è¿›è¡Œæ•°æ®é¢„å¤„ç†</strong>æ•´ç†æˆç¬¦åˆè¦æ±‚çš„æ•°æ®ç»“æ„ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">d3.<span class="title function_">json</span>(<span class="string">&#x27;./data/miserables.json&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">render_init</span>();<span class="comment">//ç”»å¸ƒåˆå§‹åŒ–</span></span><br><span class="line">    <span class="comment">//force simulation åŠ›æ¨¡æ‹Ÿ</span></span><br><span class="line">    <span class="comment">//data join æ•°æ®ç»‘å®š</span></span><br><span class="line">    <span class="comment">//drag  äº¤äº’äº‹ä»¶</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="åŠ›æ¨¡æ‹Ÿ"><a href="#åŠ›æ¨¡æ‹Ÿ" class="headerlink" title="åŠ›æ¨¡æ‹Ÿ"></a>åŠ›æ¨¡æ‹Ÿ</h3><p>æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p>
<ul>
<li>forceLinkè¿™é‡Œè¦å¤„ç†ä¸€ä¸‹ï¼Œç»‘å®š<code>node.id</code>ã€‚ä¸ç„¶ä¼šæŒ‰ç…§nodeçš„ç´¢å¼•æ¥è¿›è¡Œï¼Œè¿™æ ·è®¾ç½®tickçš„æ—¶å€™ä¼šéå¸¸ä¸æ–¹ä¾¿</li>
<li>ä»…è¿›è¡ŒåŠ›æ¨¡æ‹Ÿç»“ç‚¹çš„ä½ç½®ä¸ä¼šè¿›è¡Œå®æ—¶æ›´æ–°ï¼Œå¿…é¡»è¦æœ‰<code>simulation.on(tick)</code>æ‰ä¼šæŠŠåŠ›æ¨¡æ‹Ÿçš„ç»“æœåæ˜ åˆ°å›¾å…ƒä¸Š     </li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">simulation = d3.<span class="title function_">forceSimulation</span>()</span><br><span class="line">    .<span class="title function_">nodes</span>(data.<span class="property">nodes</span>)</span><br><span class="line">    .<span class="title function_">force</span>(<span class="string">&quot;link&quot;</span>,d3.<span class="title function_">forceLink</span>(data.<span class="property">links</span>).<span class="title function_">id</span>(<span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">id</span>))</span><br><span class="line">    .<span class="title function_">force</span>(<span class="string">&quot;manyBody&quot;</span>,d3.<span class="title function_">forceManyBody</span>())</span><br><span class="line">    .<span class="title function_">force</span>(<span class="string">&quot;center&quot;</span>,d3.<span class="title function_">forceCenter</span>(innerWidth/<span class="number">2</span>,innerHeight/<span class="number">2</span>))  </span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;tick&quot;</span>,tick)</span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®ç»‘å®š-datajoin"><a href="#æ•°æ®ç»‘å®š-datajoin" class="headerlink" title="æ•°æ®ç»‘å®š datajoin"></a>æ•°æ®ç»‘å®š datajoin</h3><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ç»‘å®šçš„ä¸‰ä¸ªå…ƒç´ ä¸ºï¼š <strong>ç»“ç‚¹ï¼Œç»“ç‚¹åç§°ï¼Œé“¾æ¥</strong></p>
<h4 id="ç»“ç‚¹ä¸ç»“ç‚¹åç§°"><a href="#ç»“ç‚¹ä¸ç»“ç‚¹åç§°" class="headerlink" title="ç»“ç‚¹ä¸ç»“ç‚¹åç§°"></a>ç»“ç‚¹ä¸ç»“ç‚¹åç§°</h4><p>ä¸€ä¸ªä¼ ç»Ÿçš„æ–¹æ³•æ˜¯<code>circle</code>å’Œ<code>text</code>åˆ†å¼€ç»‘å®šï¼Œä½†æ˜¯è¿™é‡Œé‡‡ç”¨ä¸€ä¸ªæ›´åŠ é«˜æ•ˆçš„åŠæ³•ï¼šå°±æ˜¯åˆ›å»ºä¸€ä¸ª<g>, æ¯ä¸ªgæ ‡ç­¾ä»£è¡¨ä¸€ä¸ªç»“ç‚¹ï¼Œå…¶ä¸­åŒ…å«<code>circle</code>å’Œ<code>text</code>ä¸¤ä¸ªå›¾å…ƒ</p>
<ul>
<li>åˆ›å»ºç»“ç‚¹group <g></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">nodes = group.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;nodegroup&quot;</span>)</span><br><span class="line"><span class="comment">//å…ˆåˆ›å»ºä¸€ä¸ªgroupï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰ç»“ç‚¹ï¼ˆè¿™æ­¥å¯æœ‰å¯æ— ï¼‰</span></span><br><span class="line">    .<span class="title function_">selectAll</span>(<span class="string">&#x27;.node&#x27;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(data.<span class="property">nodes</span>)</span><br><span class="line">    .<span class="title function_">join</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;class&#x27;</span>,<span class="string">&#x27;node&#x27;</span> )</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ç»“ç‚¹ç»‘å®š(circle)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> circle = nodes.<span class="title function_">append</span>(<span class="string">&#x27;circle&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;r&#x27;</span>, <span class="number">5</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> <span class="title function_">color</span>(d.<span class="property">group</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»“ç‚¹åç§°ç»‘å®š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> label = nodes.<span class="title function_">append</span>(<span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>, <span class="number">6</span>)</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;y&#x27;</span>, <span class="number">3</span> )</span><br><span class="line">.<span class="title function_">html</span>(<span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">id</span> )</span><br><span class="line">.<span class="title function_">attr</span>(<span class="string">&#x27;font-size&#x27;</span>, <span class="string">&#x27;12px&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h4><p>è¿™é‡Œæœ‰ä¸ªå‘ï¼Œlineæ ‡ç­¾æ˜¯ä¸èƒ½è®¾ç½®<code>fill</code>çš„ï¼Œåº”è¯¥é€šè¿‡è®¾ç½®<code>stroke</code>å±æ€§æ¥è®¾ç½®lineçš„é¢œè‰²ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ³¨æ„è®¾ç½®stroke</span></span><br><span class="line">link = group.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;class&#x27;</span>,<span class="string">&#x27;linkgroup&#x27;</span>).<span class="title function_">selectAll</span>(<span class="string">&#x27;line&#x27;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(data.<span class="property">links</span>)</span><br><span class="line">    .<span class="title function_">enter</span>().<span class="title function_">append</span>(<span class="string">&#x27;line&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;stroke-width&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(d.<span class="property">value</span>))</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;stroke&#x27;</span>, <span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&#x27;stroke-opacity&#x27;</span>,<span class="number">0.6</span> )</span><br></pre></td></tr></table></figure>
<h3 id="tickå‡½æ•°ç¼–å†™"><a href="#tickå‡½æ•°ç¼–å†™" class="headerlink" title="tickå‡½æ•°ç¼–å†™"></a>tickå‡½æ•°ç¼–å†™</h3><p>åœ¨tickå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è¦æ›´æ–°<strong>nodeçš„ä½ç½®</strong>å’Œ<strong>linkçš„èµ·ç‚¹å’Œç»ˆç‚¹</strong></p>
<p><strong>æ³¨æ„</strong>ï¼šnodeæŒ‡åŒ…å«äº†circleå’Œtextçš„é‚£ä¸ªgroupï¼Œè¿™é‡Œåªéœ€è¦æ›´æ–°é‚£ä¸ªgroupçš„ä½ç½®ï¼Œ<circle>å’Œ<text>å°±ä¼šä¸€èµ·æ›´æ–°ã€‚è¿™å°±æ˜¯ä¸Šé¢æå‡ºä¸ºä»€ä¹ˆè¦æŠŠ<circle>å’Œ<text>æ”¾åœ¨ä¸€ä¸ª<g>ä¸­ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> tick = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    link</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;x1&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">source</span>.<span class="property">x</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;y1&#x27;</span>, <span class="function"><span class="params">d</span>  =&gt;</span> d.<span class="property">source</span>.<span class="property">y</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;x2&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">target</span>.<span class="property">x</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;y2&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">target</span>.<span class="property">y</span>)</span><br><span class="line"></span><br><span class="line">    nodes</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> <span class="string">`translate(<span class="subst">$&#123;d.x&#125;</span>,<span class="subst">$&#123;d.y&#125;</span>)`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="drag-æ‹–æ›³äº¤äº’è®¾è®¡"><a href="#drag-æ‹–æ›³äº¤äº’è®¾è®¡" class="headerlink" title="drag æ‹–æ›³äº¤äº’è®¾è®¡"></a>drag æ‹–æ›³äº¤äº’è®¾è®¡</h3><p>ç°åœ¨ç»™å›¾åŠ ä¸€äº›äº¤äº’æ•ˆæœï¼šè®©ç»“ç‚¹èƒ½å¤Ÿè¢«é¼ æ ‡é€‰ä¸­å¹¶æ‹–æ‹½</p>
<h4 id="d3-drag-å‡½æ•°"><a href="#d3-drag-å‡½æ•°" class="headerlink" title="d3.drag()å‡½æ•°"></a><code>d3.drag()</code>å‡½æ•°</h4><p>dragå‡½æ•°æœ‰ä¸‰ä¸ªéœ€è¦é…ç½®çš„ï¼Œåˆ†åˆ«æ˜¯æ‹–æ›³å¼€å§‹ï¼Œæ‹–æ›³è¿‡ç¨‹å’Œæ‹–æ›³ç»“æŸ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dragFunc = d3.<span class="title function_">drag</span>()</span><br><span class="line">.<span class="title function_">on</span>(<span class="string">&#x27;start&#x27;</span>,dragstarted)</span><br><span class="line">.<span class="title function_">on</span>(<span class="string">&#x27;drag&#x27;</span>,dragged)</span><br><span class="line">.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>,dragended)</span><br></pre></td></tr></table></figure>
<h4 id="dragstarted-æ‹–æ›³å¼€å§‹"><a href="#dragstarted-æ‹–æ›³å¼€å§‹" class="headerlink" title="dragstarted æ‹–æ›³å¼€å§‹"></a>dragstarted æ‹–æ›³å¼€å§‹</h4><ul>
<li><code>alphaTarget</code>ï¼šè¡°å‡ç³»æ•°ï¼Œå¯¹èŠ‚ç‚¹ä½ç½®ç§»åŠ¨è¿‡ç¨‹çš„æ¨¡æ‹Ÿï¼Œæ•°å€¼è¶Šé«˜ç§»åŠ¨è¶Šå¿«ï¼Œæ•°å€¼èŒƒå›´[0ï¼Œ1]</li>
<li><code>restart()</code>ï¼š <strong>é‡æ–°å¯åŠ¨ä»¿çœŸçš„å†…éƒ¨å®šæ—¶å™¨å¹¶ä¸”è¿”å›ä»¿çœŸ</strong>ã€‚ä¸ <code>simulation*.alphaTarget</code>æˆ– <code>simulation*.alpha</code>ç»“åˆä½¿ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥åœ¨äº¤äº’æœŸé—´å†æ¬¡æ¿€æ´»ä»¿çœŸï¼Œæ¯”å¦‚æ‹–æ‹½èŠ‚ç‚¹æˆ–è€…åœ¨ä½¿ç”¨ <code>simulation.stop</code>ä¸´æ—¶æš‚åœä»¿çœŸåä½¿ç”¨ã€‚</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dragstarted</span>(<span class="params">d</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!d3.<span class="property">event</span>.<span class="property">active</span>) simulation.<span class="title function_">alphaTarget</span>(<span class="number">0.3</span>).<span class="title function_">restart</span>();</span><br><span class="line">    d.<span class="property">fx</span> = d.<span class="property">x</span>;</span><br><span class="line">    d.<span class="property">fy</span> = d.<span class="property">y</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="dragged-æ‹–æ›³è¿‡ç¨‹"><a href="#dragged-æ‹–æ›³è¿‡ç¨‹" class="headerlink" title="dragged æ‹–æ›³è¿‡ç¨‹"></a>dragged æ‹–æ›³è¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">```js</span><br><span class="line">const dragged = function(d)&#123;</span><br><span class="line">    d.fx = d3.event.x;</span><br><span class="line">    d.fy = d3.event.y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="dragended-æ‹–æ›³ç»“æŸ"><a href="#dragended-æ‹–æ›³ç»“æŸ" class="headerlink" title="dragended æ‹–æ›³ç»“æŸ"></a>dragended æ‹–æ›³ç»“æŸ</h4><p>æœ€åå°†fxå’Œfyè®¾ç½®æˆnullï¼Œè¡¨ç¤ºæ‹–æ›³ç»“æŸåè®©ç»“ç‚¹å›åˆ°åŠ›æ¨¡æ‹Ÿçš„ä½ç½®ï¼Œè€Œä¸æ˜¯åœç•™åœ¨æ‹–æ›³çš„ä½ç½®</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dragended = <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (!d3.<span class="property">event</span>.<span class="property">active</span>) &#123;</span><br><span class="line">        simulation.<span class="title function_">alphaTarget</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è®©å®ƒå›åˆ°åŸæ¥çš„ä½ç½®</span></span><br><span class="line">    d.<span class="property">fx</span> = <span class="literal">null</span>;</span><br><span class="line">    d.<span class="property">fy</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è°ƒç”¨æ–¹å¼"><a href="#è°ƒç”¨æ–¹å¼" class="headerlink" title="è°ƒç”¨æ–¹å¼"></a>è°ƒç”¨æ–¹å¼</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">dragFunc</span>(nodes)<span class="comment">//paramï¼šæ‹–æ›³å¯¹è±¡</span></span><br></pre></td></tr></table></figure>
<h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>force<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/d3.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;1200&quot;</span> <span class="attr">height</span> = <span class="string">&quot;650&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> &gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;svg&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> height = +(svg.<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>))</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> width = +(svg.<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>))</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> margin = &#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">top</span>:<span class="number">150</span>,</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">left</span>:<span class="number">50</span>,</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">right</span>:<span class="number">50</span>,</span></span><br><span class="line"><span class="language-javascript">		<span class="attr">bottom</span>:<span class="number">0</span></span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> innerHeight = height-margin.<span class="property">top</span>-margin.<span class="property">bottom</span>;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> innerWidth = width - margin.<span class="property">left</span> - margin.<span class="property">right</span>;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">var</span> color = d3.<span class="title function_">scaleOrdinal</span>(d3.<span class="property">schemeCategory10</span>);</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">let</span> link;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">let</span> nodes;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">let</span> simulation;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> render_init = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">		svg.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;title&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;font-size&#x27;</span>,<span class="string">&#x27;2em&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>,margin.<span class="property">left</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;y&#x27;</span>, margin.<span class="property">top</span>/<span class="number">2</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">`translate(0,-40)`</span> )</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;font-weight&#x27;</span>, <span class="string">&#x27;bold&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>,<span class="string">&#x27;blue&#x27;</span> )</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">html</span>(<span class="string">&quot;Force  Simulation&quot;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;maingroup&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>, margin.<span class="property">left</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;y&#x27;</span>, margin.<span class="property">top</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>,<span class="subst">$&#123;margin.top&#125;</span>)`</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>,innerWidth )</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>,innerHeight )</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> tick = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">		link</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;x1&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">source</span>.<span class="property">x</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;y1&#x27;</span>, <span class="function"><span class="params">d</span>  =&gt;</span> d.<span class="property">source</span>.<span class="property">y</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;x2&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">target</span>.<span class="property">x</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;y2&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">target</span>.<span class="property">y</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		nodes</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> <span class="string">`translate(<span class="subst">$&#123;d.x&#125;</span>,<span class="subst">$&#123;d.y&#125;</span>)`</span>)</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> dragstarted = <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">if</span>(!d3.<span class="property">event</span>.<span class="property">active</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">			<span class="comment">//// è®¾ç½®è¡°å‡ç³»æ•°ï¼Œå¯¹èŠ‚ç‚¹ä½ç½®ç§»åŠ¨è¿‡ç¨‹çš„æ¨¡æ‹Ÿï¼Œæ•°å€¼è¶Šé«˜ç§»åŠ¨è¶Šå¿«ï¼Œæ•°å€¼èŒƒå›´[0ï¼Œ1]</span></span></span><br><span class="line"><span class="language-javascript">			simulation.<span class="title function_">alphaTarget</span>(<span class="number">0.3</span>)</span></span><br><span class="line"><span class="language-javascript">			.<span class="title function_">restart</span>();</span></span><br><span class="line"><span class="language-javascript">			d.<span class="property">fx</span> = d.<span class="property">x</span>;</span></span><br><span class="line"><span class="language-javascript">			d.<span class="property">fy</span> = d.<span class="property">y</span>;</span></span><br><span class="line"><span class="language-javascript">		&#125;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> dragged = <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">		d.<span class="property">fx</span> = d3.<span class="property">event</span>.<span class="property">x</span>;</span></span><br><span class="line"><span class="language-javascript">		d.<span class="property">fy</span> = d3.<span class="property">event</span>.<span class="property">y</span>;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">const</span> dragended = <span class="keyword">function</span>(<span class="params">d</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">if</span> (!d3.<span class="property">event</span>.<span class="property">active</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">			simulation.<span class="title function_">alphaTarget</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">		&#125;</span></span><br><span class="line"><span class="language-javascript">		<span class="comment">//è®©å®ƒå›åˆ°åŸæ¥çš„ä½ç½®</span></span></span><br><span class="line"><span class="language-javascript">		d.<span class="property">fx</span> = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">  		d.<span class="property">fy</span> = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">	&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	d3.<span class="title function_">json</span>(<span class="string">&#x27;./data/miserables.json&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">		<span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span></span><br><span class="line"><span class="language-javascript">		<span class="title function_">render_init</span>();</span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">const</span> group = d3.<span class="title function_">select</span>(<span class="string">&#x27;#maingroup&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		simulation = d3.<span class="title function_">forceSimulation</span>()</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">nodes</span>(data.<span class="property">nodes</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">force</span>(<span class="string">&quot;link&quot;</span>,d3.<span class="title function_">forceLink</span>(data.<span class="property">links</span>).<span class="title function_">id</span>(<span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">id</span>))</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">force</span>(<span class="string">&quot;manyBody&quot;</span>,d3.<span class="title function_">forceManyBody</span>())</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">force</span>(<span class="string">&quot;center&quot;</span>,d3.<span class="title function_">forceCenter</span>(innerWidth/<span class="number">2</span>,innerHeight/<span class="number">2</span>))  </span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">on</span>(<span class="string">&quot;tick&quot;</span>,tick)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="comment">//æ³¨æ„è®¾ç½®stroke</span></span></span><br><span class="line"><span class="language-javascript">		link = group.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;class&#x27;</span>,<span class="string">&#x27;linkgroup&#x27;</span>).<span class="title function_">selectAll</span>(<span class="string">&#x27;line&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">data</span>(data.<span class="property">links</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">enter</span>().<span class="title function_">append</span>(<span class="string">&#x27;line&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;stroke-width&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(d.<span class="property">value</span>))</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;stroke&#x27;</span>, <span class="string">&#x27;green&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;stroke-opacity&#x27;</span>,<span class="number">0.6</span> )</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		nodes = group.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>, <span class="string">&quot;nodegroup&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">selectAll</span>(<span class="string">&#x27;.node&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">data</span>(data.<span class="property">nodes</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">join</span>(<span class="string">&#x27;g&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;class&#x27;</span>,<span class="string">&#x27;node&#x27;</span> )</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> circle = nodes.<span class="title function_">append</span>(<span class="string">&#x27;circle&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;r&#x27;</span>, <span class="number">5</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;fill&#x27;</span>, <span class="function"><span class="params">d</span> =&gt;</span> <span class="title function_">color</span>(d.<span class="property">group</span>))</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> label = nodes.<span class="title function_">append</span>(<span class="string">&#x27;text&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;x&#x27;</span>, <span class="number">6</span>)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;y&#x27;</span>, <span class="number">3</span> )</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">html</span>(<span class="function"><span class="params">d</span> =&gt;</span> d.<span class="property">id</span> )</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">attr</span>(<span class="string">&#x27;font-size&#x27;</span>, <span class="string">&#x27;12px&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">const</span> dragFunc = d3.<span class="title function_">drag</span>()</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">on</span>(<span class="string">&#x27;start&#x27;</span>,dragstarted)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">on</span>(<span class="string">&#x27;drag&#x27;</span>,dragged)</span></span><br><span class="line"><span class="language-javascript">		.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>,dragended)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="title function_">dragFunc</span>(nodes)<span class="comment">//æ‹–æ›³å¯¹è±¡</span></span></span><br><span class="line"><span class="language-javascript">	</span></span><br><span class="line"><span class="language-javascript">	&#125;)</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><h3 id="åˆå§‹"><a href="#åˆå§‹" class="headerlink" title="åˆå§‹"></a>åˆå§‹</h3><p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202307060008684.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="æ‹–æ›³"><a href="#æ‹–æ›³" class="headerlink" title="æ‹–æ›³"></a>æ‹–æ›³</h3><p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202307060008035.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
]]></content>
      <categories>
        <category>others</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>JAVAçš„è½¬å‹ä¸åŠ¨æ€ç»‘å®š</title>
    <url>/2022/08/03/64294984be89/</url>
    <content><![CDATA[<h3 id="ä¸Šè½¬å‹ä¸ä¸‹è½¬å‹"><a href="#ä¸Šè½¬å‹ä¸ä¸‹è½¬å‹" class="headerlink" title="ä¸Šè½¬å‹ä¸ä¸‹è½¬å‹"></a>ä¸Šè½¬å‹ä¸ä¸‹è½¬å‹</h3><p>æƒ³è¦ç†è§£javaä¸­çš„è½¬å‹åªéœ€è¦è®°ä½ä¸€å¥è¯:</p>
<p><font color = "red" size="5">çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡</font><br>è¿™å¥è¯æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Father</span> <span class="variable">f1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Son</span>();   <span class="comment">// è¿™å°±å« upcasting ï¼ˆå‘ä¸Šè½¬å‹)</span></span><br><span class="line"><span class="comment">// ç°åœ¨ f1 å¼•ç”¨æŒ‡å‘ä¸€ä¸ªSonå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="type">Son</span> <span class="variable">s1</span> <span class="operator">=</span> (Son)f1;   <span class="comment">// è¿™å°±å« downcasting (å‘ä¸‹è½¬å‹)</span></span><br><span class="line"><span class="comment">// ç°åœ¨f1 è¿˜æ˜¯æŒ‡å‘ Sonå¯¹è±¡</span></span><br></pre></td></tr></table></figure><br>ä½†æ˜¯ä»¥ä¸‹ä»£ç å°±ä¼šå‡ºé”™ï¼š<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Father</span> <span class="variable">f1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Father</span>();</span><br><span class="line"><span class="type">Son</span> <span class="variable">s1</span> <span class="operator">=</span> (Son)f1;<span class="comment">//ERROR!!</span></span><br></pre></td></tr></table></figure><br>å› ä¸ºf1æ˜¯çˆ¶ç±»çš„å¼•ç”¨ï¼ŒæŒ‡å‘äº†çˆ¶ç±»å¯¹è±¡ï¼Œçˆ¶ç±»å¯¹è±¡ä¸èƒ½å¤ŸæŒ‡å‘å­ç±»å¼•ç”¨ã€‚</p>
<h3 id="ä¸Šè½¬å‹çš„ç‰¹ç‚¹"><a href="#ä¸Šè½¬å‹çš„ç‰¹ç‚¹" class="headerlink" title="ä¸Šè½¬å‹çš„ç‰¹ç‚¹"></a>ä¸Šè½¬å‹çš„ç‰¹ç‚¹</h3><ol>
<li>ä¸Šè½¬å‹å¯¹è±¡ä¸èƒ½æ“ä½œå­ç±»æ–°å¢åŠ çš„æˆå‘˜å˜é‡ï¼Œ<strong>ä¸èƒ½ä½¿ç”¨å­ç±»æ–°å¢çš„æ–¹æ³•</strong>ã€‚å³ä¸ºè¾ƒå­ç±»Bå¤±å»ä¸€äº›å±æ€§å’ŒåŠŸèƒ½ï¼Œè¿™äº›å±æ€§å’ŒåŠŸèƒ½æ˜¯æ–°å¢çš„ã€‚<ol>
<li>ä¸Šè½¬å‹å¯¹è±¡å¯ä»¥æ“ä½œå­ç±»ç»§æ‰¿æˆ–éšè—çš„æˆå‘˜å˜é‡ï¼Œä¹Ÿ<strong>å¯ä»¥ä½¿ç”¨å­ç±»ç»§æ‰¿çš„æˆ–é‡å†™çš„æ–¹æ³•</strong>ã€‚å³ä¸ºä¸Šè½¬å‹å¯¹è±¡<strong>å¯ä»¥æ“çºµçˆ¶ç±»åŸæœ‰çš„å±æ€§å’ŒåŠŸèƒ½ï¼Œæ— è®ºè¿™äº›æ–¹æ³•æ˜¯å¦è¢«é‡å†™</strong>ã€‚</li>
<li>ä¸Šè½¬å‹å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œå°±æ˜¯è°ƒç”¨<strong>å­ç±»ç»§æ‰¿å’Œé‡å†™è¿‡</strong>çš„æ–¹æ³•ã€‚è€Œä¸ä¼šæ˜¯æ–°å¢çš„æ–¹æ³•ï¼Œä¹Ÿä¸æ˜¯çˆ¶ç±»åŸæœ‰çš„æ–¹æ³•ã€‚</li>
<li>å¯ä»¥å°†å¯¹è±¡çš„ä¸Šè½¬å‹å¯¹è±¡å†å¼ºåˆ¶è½¬æ¢åˆ°ä¸€ä¸ªå­ç±»å¯¹è±¡<strong>ï¼ˆä¸‹è½¬å‹ï¼‰</strong>ï¼Œå¼ºåˆ¶è½¬æ¢è¿‡çš„å¯¹è±¡å…·æœ‰å­ç±»æ‰€æœ‰å±æ€§å’ŒåŠŸèƒ½ã€‚</li>
</ol>
</li>
</ol>
<h3 id="ä¸Šè½¬å‹çš„ä¼˜ç‚¹"><a href="#ä¸Šè½¬å‹çš„ä¼˜ç‚¹" class="headerlink" title="ä¸Šè½¬å‹çš„ä¼˜ç‚¹"></a>ä¸Šè½¬å‹çš„ä¼˜ç‚¹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dosleep</span><span class="params">(Human h)</span> &#123;</span><br><span class="line">	<span class="comment">//è¿™é‡Œçš„Human hæ˜¯ä¼ å…¥çˆ¶ç±»ï¼Œå¦‚æœä¼ å…¥å­ç±»å¯ä»¥å°†å…¶ä¸Šè½¬å‹ä¸ºçˆ¶ç±»</span></span><br><span class="line">    h.sleep();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä»¥çˆ¶ç±»ä¸ºå‚æ•°ï¼Œè°ƒç”¨æœ‰æ—¶ç”¨å­ç±»ä½œä¸ºå‚æ•°ï¼Œå°±æ˜¯åˆ©ç”¨äº†å‘ä¸Šè½¬å‹ã€‚è¿™æ ·ä½¿ä»£ç å˜å¾—ç®€æ´ã€‚ä¸ç„¶çš„è¯ï¼Œå¦‚æœ dosleep ä»¥å­ç±»å¯¹è±¡ä¸ºå‚æ•°ï¼Œåˆ™æœ‰å¤šå°‘ä¸ªå­ç±»å°±éœ€è¦å†™å¤šå°‘ä¸ªå‡½æ•°ã€‚è¿™ä¹Ÿä½“ç°äº† JAVA çš„æŠ½è±¡ç¼–ç¨‹æ€æƒ³ã€‚</p>
<h3 id="åŠ¨æ€ç»‘å®š"><a href="#åŠ¨æ€ç»‘å®š" class="headerlink" title="åŠ¨æ€ç»‘å®š"></a>åŠ¨æ€ç»‘å®š</h3><p><strong>æ¦‚å¿µ</strong><br>æ–¹æ³•å¯ä»¥åœ¨æ²¿ç€ç»§æ‰¿é“¾çš„å¤šä¸ªç±»ä¸­å®ç°ï¼Œå­ç±»å¯ä»¥é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚JVMå†³å®šè¿è¡Œæ—¶è°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚è¿™å°±æ˜¯åŠ¨æ€ç»‘å®šã€‚<br><strong>åŸç†</strong><br>å‡è®¾ï¼Œå¯¹è±¡oæ˜¯ç±»C1çš„å®ä¾‹ï¼Œå…¶ä¸­C1æ˜¯C2çš„å­ç±»ï¼ŒC2æ˜¯C3çš„å­ç±»ï¼Œé‚£ä¹ˆoä¹Ÿæ˜¯C2ï¼ŒC3çš„å®ä¾‹ã€‚å¦‚æœå¯¹è±¡oè°ƒç”¨ä¸€ä¸ªæ–¹æ³•pï¼ŒJVMä¼šä¾æ¬¡åœ¨ç±»C1ï¼ŒC2ï¼ŒC3ä¸­æŸ¥æ‰¾æ–¹æ³•pçš„å®ç°<strong>ï¼ˆé¦–å…ˆçœ‹å‚æ•°ç±»å‹ï¼Œæ‰¾åˆ°æœ€åˆé€‚çš„å‚æ•°ç±»å‹ã€‚å†åœ¨å‚æ•°ç±»å‹ç¬¦åˆçš„ç±»æ–¹æ³•ä¸­æŒ‰ç…§C1,C2,C3çš„é¡ºåºæ¥æŸ¥æ‰¾pï¼‰</strong>ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯javaä¸­å¤šæ€çš„ä¸€ç§ä½“ç°å½¢å¼<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class äººï½›</span><br><span class="line">  åƒé¥­();</span><br><span class="line">ï½</span><br><span class="line"></span><br><span class="line">class ç¨‹åºå‘˜ extends äºº&#123;</span><br><span class="line">  åƒé¥­();</span><br><span class="line">  ç¼–ç ();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">å¦å¤–æœ‰ä¸ªå‡½æ•°:</span><br><span class="line"></span><br><span class="line">void doSomething(äºº)&#123;</span><br><span class="line">   ä¸€ä¸ªäºº.ç¼–ç ();//è¿™é‡Œå°±ä¼šç¼–è¯‘å‡ºé”™ï¼Œå› ä¸ºç¼–è¯‘å™¨åªçŸ¥é“å‚æ•°ç±»å‹æ˜¯äººï¼Œè€Œäººçš„é€šç”¨è¡Œä¸ºé‡Œåªæœ‰åƒé¥­,æ²¡æœ‰ç¼–ç </span><br><span class="line">   ä¸€ä¸ªäºº.åƒé¥­();//è¿™é‡Œæ²¡æœ‰ç¼–è¯‘é”™ï¼Œå› ä¸ºç¼–è¯‘å™¨çŸ¥é“äººæœ‰åƒé¥­çš„è¡Œä¸ºã€‚å…·ä½“çš„è¡Œä¸ºæ˜¯ç¨‹åºå‘˜åƒé¥­è¿˜æ˜¯å·¥äººåƒé¥­ï¼Œå°±çœ‹ä¼ çš„æ˜¯ä»€ä¹ˆäººäº†ï¼Œé è¿è¡Œæ—¶å‡½æ•°çš„æ™šç»‘å®šå®ç°ã€‚</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»¿Jfinal ä¸ºäº†æä¾›æ•°æ®ç»“æ„æ™®é€‚æ€§è€Œé‡å†™æ•°æ®åˆ†é¡µå·¥å…·</title>
    <url>/2022/08/02/2aaad364c9c0/</url>
    <content><![CDATA[<h3 id="æå‡ºç›®çš„"><a href="#æå‡ºç›®çš„" class="headerlink" title="æå‡ºç›®çš„"></a>æå‡ºç›®çš„</h3><p><strong>æ³¨</strong>ï¼šè¿™ç§æ–¹æ³•æ— æ³•ä½“ç°åˆ†é¡µçš„æœ¬è´¨ï¼Œé‡å†™åˆ†é¡µç®—æ³•çš„ç›®çš„æ˜¯ä¸ºäº†è®©åˆ†é¡µç®—æ³•èƒ½å¤Ÿæ™®é€‚å„ç§æ•°æ®ç±»å‹ã€‚å³å‘åˆ†é¡µç®—æ³•ä¸­æŠ•å…¥ä»»ä½•æ•°æ®ç»“æ„éƒ½å¯ä»¥è¿›è¡Œåˆ†é¡µ</p>
<h3 id="åˆ†é¡µå·¥å…·ç±»ä»£ç "><a href="#åˆ†é¡µå·¥å…·ç±»ä»£ç " class="headerlink" title="åˆ†é¡µå·¥å…·ç±»ä»£ç "></a>åˆ†é¡µå·¥å…·ç±»ä»£ç </h3><p><strong>æ³¨ï¼šæœ¬æ–‡ä»…è´´å‡ºä»£ç ï¼Œä¸ä»‹ç»é€»è¾‘ã€‚ å…·ä½“åˆ†é¡µé€»è¾‘å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ä»£ç è¿›è¡Œç†è§£</strong></p>
<ul>
<li>1.PageMe.java <strong>(ç»§æ‰¿JFinalå°è£…çš„Pageç±»ï¼Œæ˜¯åˆ†ç±»æ–¹æ³•è¿”å›çš„æ•°æ®ç±»å‹ã€‚è¯¥ç±»ä½¿ç”¨javaæ³›å‹ç±»æœºåˆ¶ï¼Œè®©åˆ†ç±»ç®—æ³•æ™®é€‚äºä»»ä½•æ•°æ®ç»“æ„)</strong><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> cc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageMe</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Page</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">boolean</span> firstPage;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFirstPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> firstPage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFirstPage</span><span class="params">(<span class="type">boolean</span> firstPage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.firstPage = firstPage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLastPage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lastPage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLastPage</span><span class="params">(<span class="type">boolean</span> lastPage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.lastPage = lastPage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> lastPage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>2.PageKit.java <strong>ï¼ˆåˆ†é¡µå·¥å…·ç±»ï¼Œå†…æœ‰åˆ†é¡µæ–¹æ³•paginate() ï¼‰</strong><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> cc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageKit</span>&lt;T&gt; &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> PageMe&lt;T&gt; </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="keyword">public</span> PageMe&lt;T&gt; <span class="title function_">paginate</span><span class="params">(<span class="type">int</span> pageNumber, <span class="type">int</span> pageSize, List&lt;T&gt; data)</span> &#123;</span><br><span class="line">        PageMe&lt;T&gt; page = <span class="keyword">new</span> <span class="title class_">PageMe</span>&lt;&gt;();</span><br><span class="line">        page.setTotalRow(data.size());</span><br><span class="line">        page.setTotalPage(pageSize == <span class="number">0</span> ? <span class="number">1</span> : (<span class="type">int</span>) Math.ceil((data.size() / pageSize)));</span><br><span class="line">        <span class="comment">//åŸºç¡€æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (pageNumber &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœpageNumberä¸ç¬¦åˆè§„èŒƒï¼Œè¿”å›å…¨éƒ¨æ•°æ®</span></span><br><span class="line">            page.setList(data);</span><br><span class="line">            <span class="keyword">return</span> page;</span><br><span class="line">        &#125;</span><br><span class="line">        page.setFirstPage(pageNumber &lt;= <span class="number">1</span>);</span><br><span class="line">        page.setLastPage(pageNumber == page.getTotalPage());</span><br><span class="line">        page.setPageNumber(pageNumber);</span><br><span class="line">        page.setPageSize(pageSize);</span><br><span class="line">        <span class="comment">//æ ¹æ®å‰ç«¯ä¼ è¿‡æ¥çš„æ•°æ®é…ç½®</span></span><br><span class="line">        <span class="keyword">if</span> (data.size()==<span class="number">0</span>)&#123;</span><br><span class="line">            page.setList(Collections.emptyList());</span><br><span class="line">            <span class="keyword">return</span> page;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">beginIndex</span> <span class="operator">=</span> (pageNumber - <span class="number">1</span>) * pageSize;</span><br><span class="line">        <span class="type">int</span> <span class="variable">endIndex</span> <span class="operator">=</span> pageNumber * pageSize;</span><br><span class="line">        endIndex = Math.min(endIndex, data.size());</span><br><span class="line">        beginIndex = Math.min(beginIndex, data.size());</span><br><span class="line">        <span class="comment">//case1: beginIndexåœ¨èŒƒå›´å†…ï¼ŒendIndexåœ¨èŒƒå›´å¤–</span></span><br><span class="line">        List&lt;T&gt; renderData;</span><br><span class="line">        <span class="keyword">if</span> (beginIndex &lt; data.size() &amp;&amp; endIndex &gt; data.size()) &#123;</span><br><span class="line">            renderData = data.subList(beginIndex, endIndex);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//case2: beginIndexåœ¨èŒƒå›´å¤–</span></span><br><span class="line">            <span class="keyword">if</span> (beginIndex &gt;= data.size()) &#123;</span><br><span class="line">                renderData = <span class="literal">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//case3ï¼šå–ä¸­é—´æ•°æ®</span></span><br><span class="line">                renderData = data.subList(beginIndex, endIndex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        page.setList(renderData);</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><strong>æ³¨ï¼špageNumberå’ŒpageSizeä¸€èˆ¬ç”±å‰ç«¯ç»™ï¼Œåç«¯è´Ÿè´£æ¥å—è¿™ä¸¤ä¸ªå€¼ã€‚è¿™é‡Œç¤ºä¾‹ä¸ºäº†æ–¹ä¾¿ç›´æ¥å®šä¹‰</strong><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">pageNumber</span> <span class="operator">=</span> <span class="number">1</span> ; <span class="comment">//ç¬¬ä¸€é¡µ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">8</span>	;<span class="comment">//ä¸€é¡µå…«æ¡æ•°æ®</span></span><br><span class="line"></span><br><span class="line">List&lt;Record&gt; data; <span class="comment">// ä¸€ä¸ªè£…ç€å…ƒç´ ç±»å‹ä¸ºRecordçš„List</span></span><br><span class="line">PageKit&lt;Record&gt; pageKit = <span class="keyword">new</span> <span class="title class_">PageKit</span>&lt;&gt;(); <span class="comment">// æ¯ä¸€æ¡æ•°æ®ç±»å‹ä¸ºRecord</span></span><br><span class="line">PageMe&lt;Record&gt; data = pageKit.paginate(pageNumber, pageSize, data);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æœ€åç›´æ¥æŠŠdataè¿”å›ç»™å‰ç«¯å³å¯</p>
<h3 id="é€‚ç”¨èŒƒå›´"><a href="#é€‚ç”¨èŒƒå›´" class="headerlink" title="é€‚ç”¨èŒƒå›´"></a>é€‚ç”¨èŒƒå›´</h3><p>â€‹    ç”±äºè¡¨è®¾è®¡æœ‰é—®é¢˜ï¼Œå¯¼è‡´ä¸€æ¡sqlè¯­å¥å¾ˆéš¾å°†è¡¨è¿æ¥èµ·æ¥ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨Jfianlè‡ªå¸¦çš„åˆ†é¡µæ–¹æ³•æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¿™ç§ã€‚ æœ¬æ–‡ç»™å‡ºçš„åˆ†é¡µæ€æƒ³æ˜¯ï¼š<strong>å…ˆå°†æ•°æ®åº“ä¸­çš„æ•°æ®æŸ¥å‡ºæ¥ï¼Œå¹¶æ‹¼æ¥æˆå‰ç«¯éœ€è¦çš„æ•°æ®ç±»å‹</strong>ï¼ˆå¦‚å‰ç«¯éœ€è¦å­¦ç”Ÿåå­—ï¼Œå­¦ç”Ÿç­çº§ï¼Œè¯­æ–‡æˆç»©ï¼Œ<strong>ä½†æ˜¯ä»–ä»¬åœ¨ä¸åŒçš„è¡¨ä¸­åˆå¾ˆéš¾ä½¿ç”¨ä¸€æ¡sqlè¯­å¥è¿›è¡Œæ‹¼æ¥</strong>ï¼‰ã€‚<br>ä½†æ˜¯ï¼Œåˆ†é¡µçš„ç›®çš„æœ¬åº”æ˜¯æé«˜æŸ¥æ‰¾æ•ˆç‡ï¼Œæœ¬æ–‡æå‡ºçš„åˆ†é¡µæ²¡æœ‰æé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚</p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€è§£é¢˜ç¬”è®°ã€‘ leetcodeå¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°</title>
    <url>/2022/07/29/024b948f3297/</url>
    <content><![CDATA[<h2 id="é—®é¢˜è½¬åŒ–"><a href="#é—®é¢˜è½¬åŒ–" class="headerlink" title="é—®é¢˜è½¬åŒ–"></a>é—®é¢˜è½¬åŒ–</h2><p>é¦–å…ˆï¼Œè€ƒè™‘åªæœ‰ä¸€ä¸ªæœ‰åºæ•°ç»„çš„æƒ…å†µï¼šå¯»æ‰¾ä¸­ä½æ•°çš„é—®é¢˜å¯ä»¥è½¬åŒ–ä¸ºå¯»æ‰¾ä¸€æ¡åˆ†å‰²çº¿ï¼Œæ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>è¿™æ¡åˆ†å‰²çº¿åœ¨æ•°ç»„å…ƒç´ ä¸ªç´ ä¸ºå¥‡æ•°çš„æ—¶å€™ï¼Œåˆ†å‰²çº¿å·¦è¾¹çš„å…ƒç´ æ¯”å³è¾¹å¤šä¸€ä¸ªï¼Œä¸­ä½æ•°å°±æ˜¯åˆ†å‰²çº¿å·¦è¾¹çš„å…ƒç´ ã€‚</li>
<li>æ•°ç»„å…ƒç´ ä¸ªæ•°ä¸ºå¶æ•°çš„æ—¶å€™ï¼Œåˆ†å‰²çº¿å·¦è¾¹çš„å…ƒç´ ä¸å³è¾¹çš„å…ƒç´ ä¸€æ ·å¤šã€‚ä¸­ä½æ•°æ˜¯åˆ†å‰²çº¿å·¦å³ä¸¤ä¸ªå…ƒç´ çš„å¹³å‡å€¼ã€‚</li>
</ul>
<p>ä¸‹é¢è€ƒè™‘ä¸¤ä¸ªæœ‰åºæ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ä¸ªæ•°ç»„ä¸Šéƒ½åˆ’åˆ†ä¸€æ¡åˆ†å‰²çº¿ï¼Œè¿™ä¸¤æ¡åˆ†å‰²çº¿æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ ï¼š</p>
<ul>
<li>ä¸¤æ¡åˆ†å‰²çº¿å·¦è¾¹çš„å…ƒç´ ä¸ªæ•° = ä¸¤æ¡åˆ†å‰²çº¿å³è¾¹çš„å…ƒç´ ä¸ªæ•°</li>
<li>ä¸¤æ¡åˆ†å‰²çº¿å·¦è¾¹çš„å…ƒç´ å‡å°äºå³è¾¹çš„å…ƒç´ <br>æ­¤æ—¶ï¼Œè¿™é“é¢˜å°±ä»å¯»æ‰¾ä¸­ä½æ•°è½¬åŒ–ä¸ºäº†å¯»æ‰¾æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶çš„åˆ†å‰²çº¿ã€‚é¢˜ç›®è¦æ±‚æ—¶é—´å¤æ‚åº¦ä¸º<code>O(log (m+n))</code>ï¼Œå› æ­¤èƒ½å¤Ÿç›´æ¥è”æƒ³åˆ°ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•æ¥æ‰¾åˆ†å‰²çº¿ã€‚<h2 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h2>å¯»æ‰¾æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶çš„åˆ†å‰²çº¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±<strong>å›´ç»•ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶</strong>æ¥ç¼–ç ï¼šä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œå°†nums1è®¾ç½®ä¸ºé•¿åº¦è¾ƒçŸ­çš„æ•°ç»„ï¼Œnums2è®¾ç½®ä¸ºé•¿åº¦è¾ƒé•¿çš„æ•°ç»„ã€‚<h3 id="ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼š"><a href="#ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼š" class="headerlink" title="ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼š"></a>ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼š</h3>è¦è€ƒè™‘å¥‡æ•°å’Œå¶æ•°çš„æƒ…å†µï¼Œå¦‚æœä¸¤ä¸ªæ•°ç»„é•¿åº¦ä¹‹å’Œä¸ºå¥‡æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è§„å®šå·¦è¾¹å…ƒç´ æ¯”å³è¾¹å…ƒç´ å¤šï¼›å¦‚æœä¸¤ä¸ªæ•°ç»„é•¿åº¦ä¹‹å’Œä¸ºå¶æ•°ï¼Œé‚£ä¹ˆä¸¤è¾¹å…ƒç´ ç›¸ç­‰ã€‚ç”±äºJavaçš„é™¤æ³•æ˜¯å‘ä¸‹å–æ•´ï¼ˆå³5/2=2ï¼‰ï¼Œå› æ­¤å¯ä»¥è®²å¥‡å¶ä¸¤ç§æƒ…å†µåˆå¹¶ï¼Œå¾—åˆ°å·¦è¾¹å…ƒç´ çš„æ€»ä¸ªæ•°<script type="math/tex; mode=display">
totalLeft = \frac{m+n+1}{2}~~~~~~~~//å…¶ä¸­mï¼Œnåˆ†åˆ«ä»£è¡¨ä¸¤ä¸ªæ•°ç»„çš„é•¿åº¦</script></li>
</ul>
<h3 id="ç¬¬äºŒä¸ªæ¡ä»¶ï¼š"><a href="#ç¬¬äºŒä¸ªæ¡ä»¶ï¼š" class="headerlink" title="ç¬¬äºŒä¸ªæ¡ä»¶ï¼š"></a>ç¬¬äºŒä¸ªæ¡ä»¶ï¼š</h3><p>è¦ä½¿åˆ†å‰²çº¿å·¦è¾¹å…ƒç´ å‡å°äºå³è¾¹çš„å…ƒç´ ï¼Œå› ä¸ºä¸¤ä¸ªæ•°ç»„å‡ä¸ºæœ‰åºæ•°ç»„ï¼Œé‚£ä¹ˆæ»¡è¶³ä»¥ä¸‹æ¡ä»¶å³å¯ï¼š<br>è®¾<code>i</code>ä¸ºnums1åˆ†å‰²çº¿å³è¾¹çš„å…ƒç´ ï¼Œ<code>j</code>ä¸ºnums2åˆ†å‰²çº¿å³è¾¹çš„å…ƒç´ ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">nums1[i-<span class="number">1</span>]&lt;=nums2[j] &amp;&amp; nums2[j-<span class="number">1</span>]&lt;=nums1[i]</span><br></pre></td></tr></table></figure>
<h3 id="æ ¹æ®ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ç¼–ç ï¼š"><a href="#æ ¹æ®ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ç¼–ç ï¼š" class="headerlink" title="æ ¹æ®ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ç¼–ç ï¼š"></a>æ ¹æ®ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ç¼–ç ï¼š</h3><ul>
<li><p>æ®æ­¤ï¼Œæ ¹æ®ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“<code>i</code>å’Œ<code>j</code>çš„ç­‰é‡å…³ç³»ï¼Œå³<code>i+j=totalLeft</code>ã€‚çŸ¥é“è¿™ä¸ªç­‰é‡å…³ç³»ä»¥åå°±å¾ˆå¥½åŠäº†ï¼Œæˆ‘ä»¬æ¯æ¬¡åªéœ€è¦ç§»åŠ¨<code>i</code>ï¼Œè®©<code>j=totalLeft-i</code>å³å¯ã€‚</p>
</li>
<li><p>æ ¹æ®ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ¯”è¾ƒ<code>nums1[i-1]</code>ä¸<code>nums2[j]</code>çš„å¤§å°å…³ç³»å³å¯ã€‚å¦‚æœå‰è€…å¤§ï¼Œè¯´æ˜åˆ†å‰²çº¿å¤ªé å³äº†ï¼›åä¹‹ï¼Œç»§ç»­å‘å³å¯»æ‰¾çœ‹è¿˜æœ‰æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„ã€‚<br>å¦‚ä¸‹å›¾ï¼šæ­¤æ—¶<code>i</code>æŒ‡å‘å…ƒç´ 2ï¼Œ<code>j</code>æŒ‡å‘å…ƒç´ 4ã€‚<code>1&lt;4</code>ï¼Œå› æ­¤<code>nums1</code>çš„åˆ†å‰²çº¿å³ç§»ã€‚ç”±<code>j=totalLeft-i</code>å¾—ï¼Œ<code>nums2</code>çš„åˆ†å‰²çº¿å·¦ç§»ã€‚</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181521495.png" alt=""><br>ç”¨<strong>äºŒåˆ†æŸ¥æ‰¾æ³•</strong>ç¼–ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç¬¬ä¸€æ­¥ï¼šå°†é•¿åº¦æœ€çŸ­çš„æ•°ç»„è®¾ç½®ä¸ºnums1</span></span><br><span class="line"><span class="keyword">if</span> (nums2.length &lt; nums1.length) &#123;</span><br><span class="line">  <span class="type">int</span>[] temp = nums1;</span><br><span class="line">  nums1 = nums2;</span><br><span class="line">  nums2 = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒæ­¥ï¼šè®¾ç½®åˆ†å‰²çº¿å·¦è¾¹å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> nums1.length;</span><br><span class="line"><span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums2.length;</span><br><span class="line"><span class="type">int</span> <span class="variable">totalLeft</span> <span class="operator">=</span> (m + n + <span class="number">1</span>) / <span class="number">2</span>; <span class="comment">//åˆå¹¶å¥‡æ•°å’Œå¶æ•°çš„æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬ä¸‰æ­¥ï¼Œè®¾ç½®leftä¸rightï¼Œä»£è¡¨nums1åˆ†å‰²çº¿çš„æŸ¥æ‰¾åŒºé—´ã€‚æ³¨ï¼šrightéœ€è¦è®¾ç½®ä¸ºnums1.lengthï¼Œå› ä¸ºiå¯ä»¥ä¸ºnums1.length,æ­¤æ—¶åˆ†å‰²çº¿å°±åœ¨nums1çš„æœ€å³è¾¹</span></span><br><span class="line"><span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums1.length;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ä¸¤ä¸ªæ¡ä»¶ï¼š</span></span><br><span class="line"><span class="comment">        1. åˆ†éš”çº¿å·¦è¾¹çš„å…ƒç´ ä¸ªæ•°ç­‰äºåˆ†éš”çº¿å³è¾¹çš„å…ƒç´ ä¸ªç´ </span></span><br><span class="line"><span class="comment">        2. åˆ†éš”çº¿å·¦è¾¹çš„æ‰€æœ‰å…ƒç´ å‡å°äºåˆ†éš”çº¿å³è¾¹çš„å…ƒç´ ä¸ªç´ </span></span><br><span class="line"><span class="comment">        å³nums1[i-1] &lt;= nums2[j] &amp;&amp; nums2[j-1] &lt;= num1[i]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        æ³¨ï¼šiæ˜¯nums1åˆ†å‰²çº¿å³è¾¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒçš„ä¸‹æ ‡ = åˆ†éš”çº¿å·¦è¾¹å…ƒç´ çš„ä¸ªæ•°ï¼›</span></span><br><span class="line"><span class="comment">        jåŒç†ï¼Œå› æ­¤: i + j = totalLeftï¼Œå¯ä»¥æ ¹æ®è¯¥è¡¨è¾¾å¼ï¼Œç”±iç¡®å®šjã€‚</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"><span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left + (right - left + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">  <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> totalLeft - i;</span><br><span class="line">  <span class="keyword">if</span> (nums1[i - <span class="number">1</span>] &gt; nums2[j]) &#123;</span><br><span class="line">    <span class="comment">//è¯´æ˜nums1çš„åˆ†éš”çº¿å¤ªé å³äº†ï¼Œéœ€è¦åœ¨[left,i-1å¤„ç»§ç»­å¯»æ‰¾]</span></span><br><span class="line">    right = i - <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//éœ€è¦åœ¨[i,right]å¤„ç»§ç»­å¯»æ‰¾</span></span><br><span class="line">    left = i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬å››æ­¥ï¼šåˆ†å‰²çº¿åˆ’åˆ†å®Œæ¯•ï¼Œç¡®å®šä¸¤ä¸ªæ•°ç»„åˆ†å‰²çº¿å³è¾¹çš„ä½ç½®iï¼Œjã€‚æ­¤æ—¶leftæ‰€æŒ‡å‘çš„å…ƒç´ æ˜¯nums1åˆ†å‰²çº¿å³è¾¹çš„å…ƒç´ </span></span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left;</span><br><span class="line"><span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> totalLeft - i;</span><br></pre></td></tr></table></figure>
<h3 id="æç«¯æƒ…å†µï¼š"><a href="#æç«¯æƒ…å†µï¼š" class="headerlink" title="æç«¯æƒ…å†µï¼š"></a>æç«¯æƒ…å†µï¼š</h3><p>ä¸‹é¢è®¨è®ºå››ç§åˆ†å‰²çº¿åˆ’åˆ†çš„æç«¯æƒ…å†µï¼Œä»…ä»¥ä¸¤ç§æƒ…å†µä¸¾ä¾‹è¯´æ˜</p>
<ul>
<li><p><code>nums1</code>çš„åˆ†å‰²çº¿åœ¨æ•°ç»„æœ€å·¦è¾¹<br><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181521620.png" alt="åˆ†å‰²çº¿åœ¨æ•°ç»„æœ€å·¦è¾¹">    </p>
<ul>
<li>å› ä¸º<code>nums1</code>åˆ†éš”çº¿å·¦è¾¹æ²¡æœ‰å…ƒç´ ï¼Œå› æ­¤å¯ä»¥å¾—å‡ºä¸¤ä¸ªæ•°ç»„åˆ†å‰²çº¿å·¦è¾¹çš„æœ€å¤§å€¼è‚¯å®šåœ¨<code>nums2</code>ä¸­ã€‚</li>
<li>æ­¤æ—¶è¦æŠŠ<code>nums1[i-1]</code>è®¾ç½®ä¸ºæ— é™å°çš„å€¼ï¼Œä½¿å¾—æœ€åé€‰æ‹©å·¦è¾¹å…ƒç´ æœ€å¤§å€¼çš„æ—¶å€™ä¸è¦é€‰ä¸­å®ƒã€‚</li>
</ul>
</li>
<li><p><code>nums1</code>çš„åˆ†å‰²çº¿åœ¨æ•°ç»„æœ€å³è¾¹<br>  <img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181521338.png" alt="åˆ†å‰²çº¿åœ¨æ•°ç»„æœ€å³è¾¹"></p>
<ul>
<li>å› ä¸º<code>nums1</code>åˆ†éš”çº¿å³è¾¹æ²¡æœ‰å…ƒç´ ï¼Œå› æ­¤å¯ä»¥å¾—å‡ºä¸¤ä¸ªæ•°ç»„åˆ†å‰²çº¿å³è¾¹çš„æœ€å°å€¼è‚¯å®šåœ¨<code>nums2</code>ä¸­ã€‚</li>
<li>æ­¤æ—¶è¦æŠŠ<code>nums1[i]</code>è®¾ç½®ä¸ºæ— é™å¤§çš„å€¼ï¼Œä½¿å¾—æœ€åé€‰æ‹©å³è¾¹å…ƒç´ æœ€å°å€¼çš„æ—¶å€™ä¸è¦é€‰ä¸­å®ƒã€‚</li>
</ul>
</li>
<li><code>nums2</code>çš„åˆ†å‰²çº¿åœ¨æ•°ç»„æœ€å·¦è¾¹</li>
<li><code>nums2</code>çš„åˆ†å‰²çº¿åœ¨æ•°ç»„æœ€å·¦è¾¹<br>å› æ­¤ï¼Œè€ƒè™‘åˆ°å››ç§æç«¯æƒ…å†µï¼Œè¦åœ¨è·å¾—ä¸­ä½æ•°å‰åŠ ä¸Šä»¥ä¸‹ä»£ç ï¼š<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">nums1LeftMax</span> <span class="operator">=</span> i == <span class="number">0</span> ? Integer.MIN_VALUE : nums1[i - <span class="number">1</span>];</span><br><span class="line"><span class="comment">//æ­¤æ—¶nums1åˆ†å‰²çº¿å·¦è¾¹æ²¡æœ‰å…ƒç´ äº†ï¼Œå› æ­¤nums1åˆ†å‰²çº¿å·¦è¾¹å…ƒç´ çš„æœ€å¤§å€¼è¦è®¾ç½®æˆæ— é™å°ï¼Œåœ¨æ¯”è¾ƒæ—¶ç›´æ¥é€‰ä¸­nums2åˆ†å‰²çº¿çš„å·¦è¾¹å…ƒç´ ï¼Œå…¶ä½™åŒç†</span></span><br><span class="line"><span class="type">int</span> <span class="variable">nums1RightMin</span> <span class="operator">=</span> i == m ? Integer.MAX_VALUE : nums1[i];</span><br><span class="line"><span class="type">int</span> <span class="variable">nums2LeftMax</span> <span class="operator">=</span> j == <span class="number">0</span> ? Integer.MIN_VALUE : nums2[j - <span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">nums2RightMin</span> <span class="operator">=</span> j == n ? Integer.MAX_VALUE : nums2[j];</span><br></pre></td></tr></table></figure>
<h3 id="å¾—åˆ°ä¸­ä½æ•°"><a href="#å¾—åˆ°ä¸­ä½æ•°" class="headerlink" title="å¾—åˆ°ä¸­ä½æ•°"></a>å¾—åˆ°ä¸­ä½æ•°</h3>åˆ†å‰²çº¿åˆ’åˆ†å®Œæ¯•åï¼Œå³å¯æ±‚å¾—ä¸­ä½æ•°ï¼š</li>
<li>æ•°ç»„é•¿åº¦å’Œä¸ºå¥‡æ•°ï¼šä¸¤æ¡åˆ†å‰²çº¿å·¦è¾¹å…ƒç´ çš„æœ€å¤§å€¼</li>
<li>æ•°ç»„é•¿åº¦å’Œä¸ºå¶æ•°ï¼šä¸¤æ¡åˆ†å‰²çº¿å·¦è¾¹å…ƒç´ æœ€å¤§å€¼ä¸å³è¾¹å…ƒç´ æœ€å°å€¼çš„å¹³å‡å€¼<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æœ€åä¸€æ­¥ï¼šä¸­ä½æ•°</span></span><br><span class="line"><span class="keyword">if</span> ((m + n) % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="comment">//å¶æ•°</span></span><br><span class="line">  <span class="keyword">return</span> (<span class="type">double</span>)(Math.max(nums1LeftMax, nums2LeftMax) + Math.min(nums1RightMin, nums2RightMin)) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> Math.max(nums1LeftMax, nums2LeftMax);</span><br></pre></td></tr></table></figure>
<h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2>åœ¨å†™äºŒåˆ†æŸ¥æ‰¾æ³•æ—¶ï¼Œå¦‚æœ<strong>æŸ¥æ‰¾åˆ°å³åŒºé—´æ—¶</strong>ä½¿ç”¨<code>left=middle</code>çš„æ–¹å¼ç¼–ç ï¼Œé‚£ä¹ˆéœ€è¦æ³¨æ„é¿å…<strong>æ­»å¾ªç¯</strong>çš„æƒ…å†µã€‚<br>æ¯”å¦‚æŸä¸ªåŒºé—´åªæœ‰ä¸¤ä¸ªæ•°<code>[i,j]</code>ï¼Œå¦‚æœ<code>left=i</code>ï¼Œ<code>right=j</code>ï¼Œé‚£ä¹ˆè‹¥ä¸­é—´å€¼ä¸€ç›´ä¸åŠ¨ï¼Œå°±ä¼šé™·å…¥æ­»å¾ªç¯ã€‚å› æ­¤ç¡®å®šä¸­é—´å€¼çš„æ—¶å€™åº”è¯¥ä½¿ç”¨<code>left + (right - left + 1) / 2</code>,è¿™æ ·å°±èƒ½ä¿è¯å¦‚æœäºŒåˆ†æŸ¥æ‰¾æŸ¥åˆ°äº†å³åŒºé—´ï¼Œå·¦è¾¹ç•ŒåŠ ä¸€ã€‚è¯¦æƒ…å¯è§ä»£ç </li>
</ul>
<h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">findMedianSortedArrays</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¬¬ä¸€æ­¥ï¼šå°†é•¿åº¦æœ€çŸ­çš„æ•°ç»„è®¾ç½®ä¸ºnums1</span></span><br><span class="line">    <span class="keyword">if</span> (nums2.length &lt; nums1.length) &#123;</span><br><span class="line">      <span class="type">int</span>[] temp = nums1;</span><br><span class="line">      nums1 = nums2;</span><br><span class="line">      nums2 = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¬¬äºŒæ­¥ï¼šè®¾ç½®åˆ†å‰²çº¿å·¦è¾¹å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> nums1.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums2.length;</span><br><span class="line">    <span class="type">int</span> <span class="variable">totalLeft</span> <span class="operator">=</span> (m + n + <span class="number">1</span>) / <span class="number">2</span>; <span class="comment">//åˆå¹¶å¥‡æ•°å’Œå¶æ•°çš„æƒ…å†µ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¬¬ä¸‰æ­¥ï¼Œè®¾ç½®leftä¸rightï¼Œä»£è¡¨nums1åˆ†å‰²çº¿çš„æŸ¥æ‰¾åŒºé—´ã€‚æ³¨ï¼šrightéœ€è¦è®¾ç½®ä¸ºnums1.lengthï¼Œå› ä¸ºiå¯ä»¥ä¸ºnums1.length,æ­¤æ—¶åˆ†å‰²çº¿å°±åœ¨nums1çš„æœ€å³è¾¹</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums1.length;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*ä¸¤ä¸ªæ¡ä»¶ï¼š</span></span><br><span class="line"><span class="comment">        1. åˆ†éš”çº¿å·¦è¾¹çš„å…ƒç´ ä¸ªæ•°ç­‰äºåˆ†éš”çº¿å³è¾¹çš„å…ƒç´ ä¸ªç´ </span></span><br><span class="line"><span class="comment">        2. åˆ†éš”çº¿å·¦è¾¹çš„æ‰€æœ‰å…ƒç´ å‡å°äºåˆ†éš”çº¿å³è¾¹çš„å…ƒç´ ä¸ªç´ </span></span><br><span class="line"><span class="comment">        å³nums1[i-1] &lt;= nums2[j] &amp;&amp; nums2[j-1] &lt;= num1[i]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        æ³¨ï¼šiæ˜¯nums1åˆ†å‰²çº¿å³è¾¹çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒçš„ä¸‹æ ‡ = åˆ†éš”çº¿å·¦è¾¹å…ƒç´ çš„ä¸ªæ•°ï¼›</span></span><br><span class="line"><span class="comment">        jåŒç†ï¼Œå› æ­¤: i + j = totalLeftï¼Œå¯ä»¥æ ¹æ®è¯¥è¡¨è¾¾å¼ï¼Œç”±iç¡®å®šjã€‚</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left + (right - left + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">      <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> totalLeft - i;</span><br><span class="line">      <span class="keyword">if</span> (nums1[i - <span class="number">1</span>] &gt; nums2[j]) &#123;</span><br><span class="line">        <span class="comment">//è¯´æ˜nums1çš„åˆ†éš”çº¿å¤ªé å³äº†ï¼Œéœ€è¦åœ¨[left,i-1å¤„ç»§ç»­å¯»æ‰¾]</span></span><br><span class="line">        right = i - <span class="number">1</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//éœ€è¦åœ¨[i,right]å¤„ç»§ç»­å¯»æ‰¾</span></span><br><span class="line">        left = i;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ç¬¬å››æ­¥ï¼šåˆ†å‰²çº¿åˆ’åˆ†å®Œæ¯•ï¼Œç¡®å®šä¸¤ä¸ªæ•°ç»„åˆ†å‰²çº¿å³è¾¹çš„ä½ç½®iï¼Œjã€‚æ­¤æ—¶leftæ‰€æŒ‡å‘çš„å…ƒç´ æ˜¯nums1åˆ†å‰²çº¿å³è¾¹çš„å…ƒç´ </span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left;</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> totalLeft - i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç¬¬äº”æ­¥ï¼šç¡®å®šä¸­ä½æ•°ï¼Œæ— è®ºæ˜¯å¥‡æ•°è¿˜æ˜¯å¶æ•°ï¼Œä¸­ä½æ•°éƒ½åªä¸ä¸¤ä¸ªæ•°ç»„åˆ†å‰²çº¿å·¦è¾¹å…ƒç´ çš„æœ€å¤§å€¼x å’Œ å³è¾¹å…ƒç´ çš„æœ€å°å€¼y æœ‰å…³ã€‚</span></span><br><span class="line">    <span class="comment">//å› ä¸ºè®¾å®šåˆ†å‰²çº¿å·¦è¾¹å…ƒç´ ç­‰äºå³è¾¹å…ƒç´ ï¼Œæˆ–å¤§äºä¸€ï¼Œå› æ­¤ä¸­ä½æ•°=x æˆ–ä¸­ä½æ•°=ï¼ˆx+yï¼‰/2</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">nums1LeftMax</span> <span class="operator">=</span> i == <span class="number">0</span> ? Integer.MIN_VALUE : nums1[i - <span class="number">1</span>];</span><br><span class="line">    <span class="comment">//æ­¤æ—¶nums1åˆ†å‰²çº¿å·¦è¾¹æ²¡æœ‰å…ƒç´ äº†ï¼Œå› æ­¤nums1åˆ†å‰²çº¿å·¦è¾¹å…ƒç´ çš„æœ€å¤§å€¼è¦è®¾ç½®æˆæ— é™å°ï¼Œåœ¨æ¯”è¾ƒæ—¶ç›´æ¥é€‰ä¸­nums2åˆ†å‰²çº¿çš„å·¦è¾¹å…ƒç´ ï¼Œå…¶ä½™åŒç†</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">nums1RightMin</span> <span class="operator">=</span> i == m ? Integer.MAX_VALUE : nums1[i];</span><br><span class="line">    <span class="type">int</span> <span class="variable">nums2LeftMax</span> <span class="operator">=</span> j == <span class="number">0</span> ? Integer.MIN_VALUE : nums2[j - <span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">nums2RightMin</span> <span class="operator">=</span> j == n ? Integer.MAX_VALUE : nums2[j];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æœ€åä¸€æ­¥ï¼šä¸­ä½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> ((m + n) % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">//å¶æ•°</span></span><br><span class="line">      <span class="keyword">return</span> (<span class="type">double</span>)(Math.max(nums1LeftMax, nums2LeftMax) + Math.min(nums1RightMin, nums2RightMin)) / <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Math.max(nums1LeftMax, nums2LeftMax);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>note</category>
      </categories>
      <tags>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€è¶Ÿå‘è®°å½•ã€‘d3.zoom()çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿ @d3.v7</title>
    <url>/2023/07/20/065545eb7050/</url>
    <content><![CDATA[<h1 id="ã€è¶Ÿå‘è®°å½•ã€‘d3-zoom-çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿-d3-v7"><a href="#ã€è¶Ÿå‘è®°å½•ã€‘d3-zoom-çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿-d3-v7" class="headerlink" title="ã€è¶Ÿå‘è®°å½•ã€‘d3.zoom()çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿ @d3.v7"></a>ã€è¶Ÿå‘è®°å½•ã€‘<code>d3.zoom()</code>çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿ @d3.v7</h1><p>åœ¨å¼€å‘ä¸€ä¸ªD3åº”ç”¨çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ª<code>zoom</code>ç›¸å…³çš„é—®é¢˜ï¼Œè®°å½•è§£å†³æ€è·¯ä¸æ–¹æ¡ˆ</p>
<h3 id="é—®é¢˜é‡ç°"><a href="#é—®é¢˜é‡ç°" class="headerlink" title="é—®é¢˜é‡ç°"></a>é—®é¢˜é‡ç°</h3><p>æœ€è¿‘åœ¨å¼€å‘ä¸€ä¸ªD3åº”ç”¨çš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ª<code>zoom</code>ç›¸å…³çš„é—®é¢˜ï¼Œåº”ç”¨é‡Œæœ‰ä¸€ä¸ªåŠŸèƒ½å«<strong>å…¨æ™¯èšç„¦</strong>ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ç”»å¸ƒç”±ä¸¤ä¸ªæ ‡ç­¾ç»„æˆï¼ˆè§<a href="https://zqqcee.github.io/2023/03/24/3423a90bb58e/">å®ç°autoZoom(),ç”»å¸ƒè‡ªé€‚åº”æ”¾ç¼©å¹¶å±…ä¸­@D3.js-v5</a>ï¼‰ï¼Œæœ€å¤–å±‚çš„æ˜¯å›ºå®šè§†å£<code>&lt;svg&gt;</code>ï¼Œä¸€èˆ¬å°†<code>zoom</code>äº‹ä»¶ç»‘å®šåœ¨<code>&lt;svg&gt;</code>ä¸Šï¼›å†…å±‚æ˜¯å…·ä½“çš„ç”»å¸ƒï¼Œæ˜¯ä¸€ä¸ª<code>&lt;g&gt;</code>æ ‡ç­¾ï¼Œåœ¨<code>&lt;svg&gt;</code>ä¸­çš„æ”¾ç¼©ä¸å¹³ç§»æ“ä½œéƒ½ä½œç”¨åœ¨<code>&lt;g&gt;</code>ä¸Šï¼Œä¿®æ”¹<code>&lt;g&gt;</code>çš„<code>transform</code>å±æ€§ã€‚è¿™ä¹ˆåšæ˜¯ä¸ºäº†é¿å…ç”¨æˆ·å°†<code>&lt;svg&gt;</code>å…ƒç´ æ‹–åŠ¨åˆ°çª—å£ä¹‹å¤–åä¸¢å¤±æ‹–åŠ¨ç„¦ç‚¹ï¼Œæ— æ³•å°†å…¶æ‹–å›ã€‚è€Œå¦‚æœä½¿<code>&lt;svg&gt;</code>ä¸åŠ¨ï¼Œ<code>&lt;g&gt;</code>è¢«æ‹–åŠ¨ï¼Œé‚£ä¹ˆæ‹–åŠ¨ç„¦ç‚¹å°±ä¸ä¼šä¸¢å¤±ï¼Œç”¨æˆ·å°†<code>&lt;g&gt;</code>å…ƒç´ ç§»åŠ¨è‡³è§†å£å¤–åï¼Œè¿˜èƒ½å°†å…¶æ‹–å›æ¥ã€‚</p>
<p>æˆ‘ä¹‹å‰ä¹ æƒ¯è¿™ä¹ˆå†™æ‹–åŠ¨å¹³ç§»ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;#viewport&#x27;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>, width)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>, height)</span><br><span class="line"><span class="keyword">const</span> g = svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;container&#x27;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;width&#x27;</span>, width)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&#x27;height&#x27;</span>, height)</span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">call</span>(</span><br><span class="line">  d3.<span class="title function_">zoom</span>().<span class="title function_">on</span>(<span class="string">&#x27;zoom&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> transform = <span class="string">`translate(<span class="subst">$&#123;e.transform.x&#125;</span>,<span class="subst">$&#123;e.transform.y&#125;</span>) scale(<span class="subst">$&#123;e.transform.k&#125;</span>)`</span></span><br><span class="line">    g.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>, transform)</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹<code>&lt;g&gt;</code>å…ƒç´ è¿›è¡Œç‰¹å®šçš„å¹³ç§»ä¸æ”¾ç¼©ã€‚å¦‚ï¼šè‡ªåŠ¨ç¼©æ”¾è‡³è§†å£ä¸­å¤®ï¼Œæ”¾å¤§è‡³å½“å‰çš„1.5å€ã€‚ç„¶è€Œï¼Œåœ¨å…¶ä»–ç›´æ¥åœ°æ–¹ä¿®æ”¹äº†<code>&lt;g&gt;</code> çš„<code>â€˜transformâ€™</code>å±æ€§åï¼Œå¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> offsetX = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> offsetY = <span class="number">10</span>;</span><br><span class="line">g.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>,<span class="string">`translate(<span class="subst">$&#123;offsetX&#125;</span>,<span class="subst">$&#123;offsetY&#125;</span>)`</span></span><br></pre></td></tr></table></figure>
<p>ï¼Œé—®é¢˜å°±å‡ºç°äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202307200945951.gif" alt="bugreproduce"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è®¾ç½®äº†ç‰¹å®šçš„<code>&#39;transform&#39;</code>åï¼Œå†è¿›è¡Œæ‹–åŠ¨ï¼Œä¼šå‡ºç°ç¬ç§»ã€‚</p>
<h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>å› ä¸ºç›‘å¬çš„<code>zoom</code>äº‹ä»¶æ˜¯é€šè¿‡<code>e.transform</code>æ¥è¿›è¡Œæ”¾ç¼©çš„ã€‚è€Œåœ¨ä¿®æ”¹<code>&lt;g&gt;</code>å…ƒç´ çš„<code>â€˜transformâ€™</code>å±æ€§ä¸ºä¸€ä¸ªç‰¹å®šå€¼åï¼Œå†è¿›è¡Œæ‹–åŠ¨ï¼Œä¼šä»ä¸Šä¸€æ¬¡çš„<code>e.tranform</code>å€¼å¼€å§‹ä¿®æ”¹ï¼Œå› æ­¤ä¼šå‡ºç°é”™è¯¯ã€‚</p>
<p>ä¸¾ä¾‹è¯´æ˜ï¼š</p>
<ol>
<li>ç”¨æˆ·æ‹–åŠ¨ï¼Œ<code>e.transform</code>çš„æ•°å€¼ä¿®æ”¹ä¸ºäº†<code>transform_1</code></li>
<li>æœ‰ä¸€ä¸ªè‡ªåŠ¨æ”¾ç¼©å‡½æ•°<code>autoZoom</code>ï¼Œå°†<code>&lt;g&gt;</code>çš„<code>&#39;transform&#39;</code>ä¿®æ”¹ä¸ºäº†<code>transform_2</code></li>
<li>ç”¨æˆ·å†æ¬¡è¿›è¡Œæ‹–åŠ¨ï¼Œ<code>&lt;g&gt;</code>çš„<code>&#39;transform&#39;</code>ä¼šä»<code>transform_1</code>å¼€å§‹ä¿®æ”¹ï¼Œå› æ­¤ä¼šå‡ºç°ä»<code>transform_2</code>åˆ°<code>transform_1</code>çš„ç¬ç§»ã€‚</li>
</ol>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å¾—çŸ¥åŸå› ä¹‹åï¼Œè§£å†³æ–¹æ¡ˆä¹Ÿéå¸¸æ˜äº†ã€‚å°±æ˜¯åœ¨ä»»ä½•éœ€è¦è¿›è¡Œæ”¾ç¼©å¹³ç§»çš„åœ°æ–¹ï¼Œéƒ½å°†<code>transform</code>è¿›è¡Œç¼“å­˜ï¼Œä¸‹ä¸€æ¬¡å†éœ€è¦è¿›è¡Œæ”¾ç¼©å¹³ç§»æ“ä½œæ—¶ï¼Œä»ä¸Šä¸€æ¬¡çš„<code>transform</code>å¼€å§‹è¿›è¡Œæ›´æ”¹å³å¯ã€‚</p>
<p>ä¸€å¼€å§‹æˆ‘æƒ³çš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨æ¯æ¬¡é¼ æ ‡æ‹–åŠ¨æ—¶éƒ½è®°å½•ä¸€ä¸ªåç§»é‡ï¼Œä½†æ˜¯è¿™ä¸ªåç§»é‡æ¯”è¾ƒéš¾è·å–ï¼Œå¿ƒæƒ³<code>d3</code>è¿™ä¹ˆå¤§ä¸ªåº“åº”è¯¥ä¸è‡³äºç”¨è¿™ä¹ˆè ¢çš„åŠæ³•ï¼Œåº”è¯¥æœ‰æ›´å¥½ç”¨çš„æ–¹æ¡ˆã€‚</p>
<p>æŸ¥äº†ä¸€ä¸‹å®˜æ–¹çš„APIï¼Œå‘ç°äº†ä¸€ä¸ªå«<code>zoomTransform(node)</code>çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£ä¼ å…¥çš„æ˜¯ä¸€ä¸ª<code>HTML node</code>ï¼Œéœ€è¦ç”¨<code>d3.select(xx).node()</code>æ¥è·å¾—ï¼Œå¯ä»¥è·å–è¿™ä¸ª<code>node</code>çš„æ”¾ç¼©æ•°æ®ã€‚å®˜æ–¹æ–‡æ¡£æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p>
<blockquote>
<p>Internally, an elementâ€™s transform is stored as <em>element</em>.__zoom; however, you should use this method rather than accessing it directly. If the given <em>node</em> has no defined transform, returns the transform of the closest ancestor, or if none exists, the identity transformation</p>
<hr>
<p>åœ¨å†…éƒ¨ï¼Œå…ƒç´ çš„å˜æ¢å­˜å‚¨ä¸º <strong>element.__zoom</strong>ï¼›ä½†æ˜¯ï¼Œ<strong>æ‚¨åº”è¯¥ä½¿ç”¨æ­¤æ–¹æ³•ï¼ˆæŒ‡çš„æ˜¯zoomTransformï¼‰è€Œä¸æ˜¯ç›´æ¥è®¿é—®å®ƒ</strong>ã€‚å¦‚æœç»™å®šèŠ‚ç‚¹æ²¡æœ‰å®šä¹‰çš„å˜æ¢ï¼Œåˆ™è¿”å›æœ€è¿‘ç¥–å…ˆçš„å˜æ¢ï¼Œæˆ–è€…å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›æ’ç­‰å˜æ¢ã€‚è¿”å›çš„å˜æ¢è¡¨ç¤ºä»¥ä¸‹å½¢å¼çš„äºŒç»´å˜æ¢çŸ©é˜µ(ç•¥)ï¼š</p>
<p>These properties should be considered read-only; instead of mutating a transform, use <a href="https://d3js.org/d3-zoom#transform_scale"><em>transform</em>.scale</a> and <a href="https://d3js.org/d3-zoom#transform_translate"><em>transform</em>.translate</a> to derive a new transform.</p>
<hr>
<p>è¿™äº›å±æ€§åº”è¢«è§†ä¸ºåªè¯»ï¼›ä½¿ç”¨transform.scaleå’Œtransform.translateæ¥æ´¾ç”Ÿæ–°çš„å˜æ¢ï¼Œè€Œä¸æ˜¯æ”¹å˜å˜æ¢ã€‚ï¼ˆä¸‹æ–‡å°†ä»‹ç»å¦‚ä½•æ´¾ç”Ÿæ–°çš„å˜æ¢ï¼‰</p>
</blockquote>
<p>è¿›ä¸€æ­¥æŸ¥çœ‹äº†æºç ï¼Œå‘ç°åœ¨<code>svg.call(zoom)</code>è¿™ä¸ªæ“ä½œåï¼Œ<code>&lt;svg&gt;</code>è¿™ä¸ªHTML nodeå°±ä¼šç»‘ä¸Šä¸€ä¸ª<code>__zoom</code> å±æ€§ï¼Œè¿™ä¸ª<code>__zoom</code>å±æ€§è®°å½•çš„æ˜¯<code>transform</code>å‚æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¯¹<code>&lt;svg&gt;</code>è¿›è¡Œçš„æ”¾ç¼©å¹³ç§»å˜æ¢ã€‚ä¸ºæ­¤æˆ‘è¿˜ç‰¹å®šæ‰“å°äº†ä¸€ä¸‹ï¼Œå‘ç°ç¡®å®å¦‚æ­¤ï¼š</p>
<p><img src="/Users/zqqcee/Library/Application Support/typora-user-images/image-20230720100136154.png" alt="logçš„ç»“æœ"></p>
<p>é‚£ç°åœ¨äº‹æƒ…å°±å˜å¾—å¾ˆç®€å•äº†ï¼Œå¯ä»¥è½¬å˜ä¸€ä¸‹æ€è·¯ã€‚ä¹‹å‰æˆ‘ä¸€ç›´å¸Œæœ›èƒ½å¤Ÿåœ¨<code>autoZoom()</code>ä¹‹åï¼Œè·å¾—<code>&quot;zoom&quot;</code>äº‹ä»¶çš„åç§»é‡ï¼Œä½¿å¾—æˆ‘èƒ½å¤Ÿæ¥ç€è¿™ä¸ª<code>&#39;transform&#39;</code>å€¼ä¿®æ”¹ã€‚é‚£ä¹ˆæ—¢ç„¶æˆ‘æ— æ³•è·å¾—åç§»é‡ï¼Œå¯ä»¥å°è¯•åœ¨<code>autoZoom()</code>æ–¹æ³•ä¸­ä¸è¦ç›´æ¥ä¿®æ”¹<code>&lt;g&gt;</code>çš„<code>&#39;transform&#39;</code>å±æ€§ï¼Œè€Œå»ä¿®æ”¹<code>&lt;svg&gt;.__zoom</code>å€¼ã€‚</p>
<h4 id="æ”¾ç¼©å¹³ç§»å†™æ³•"><a href="#æ”¾ç¼©å¹³ç§»å†™æ³•" class="headerlink" title="æ”¾ç¼©å¹³ç§»å†™æ³•"></a>æ”¾ç¼©å¹³ç§»å†™æ³•</h4><p>åœ¨ä¸€å¼€å§‹æ—¶ï¼Œä½¿ç”¨d3.zoom()åˆ›å»ºæ”¾ç¼©å¯¹è±¡<code>zoom</code>ï¼Œå¹¶åœ¨ä»»ä½•æ—¶åˆ»éƒ½ä½¿ç”¨<code>&lt;svg&gt;</code>æ¥<code>call(zoom)</code>ä¿®æ”¹æ”¾ç¼©å€¼ã€‚åœ¨ç»‘å®š<code>&quot;zoom&quot;</code>äº‹ä»¶æ—¶ï¼Œå› ä¸º<code>&lt;svg&gt;</code> <code>call</code>äº†<code>zoom</code>ï¼Œå› æ­¤ä»»ä½•åç§»é‡éƒ½ä¼šè®°å½•åœ¨<code>&lt;svg&gt;</code>ï¼Œåœ¨ä¿®æ”¹<code>&lt;g&gt;</code>çš„<code>&#39;transform&#39;</code>å±æ€§æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨<code>d3.zoomTransform(svg.node())</code>æ¥è·å¾—<code>&lt;svg&gt;.__zoom</code>æ¥è¿›è¡Œåº”ç”¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> g = svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> zoom = d3.<span class="title function_">zoom</span>().<span class="title function_">on</span>(<span class="string">&#x27;zoom&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  g.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>, d3.<span class="title function_">zoomTransform</span>(svg.<span class="title function_">node</span>()));</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="ç‰¹æ®Šä¿®æ”¹-39-transform-39-å‡½æ•°çš„å†™æ³•"><a href="#ç‰¹æ®Šä¿®æ”¹-39-transform-39-å‡½æ•°çš„å†™æ³•" class="headerlink" title="ç‰¹æ®Šä¿®æ”¹&#39;transform&#39;å‡½æ•°çš„å†™æ³•"></a>ç‰¹æ®Šä¿®æ”¹<code>&#39;transform&#39;</code>å‡½æ•°çš„å†™æ³•</h4><p>è¿™é‡Œéœ€è¦è¯´æ˜ä¸€ä¸‹<code>autoZoom()</code>çš„å†™æ³•ï¼Œå‡è®¾æˆ‘ä»¬ç°åœ¨å·²ç»è®¡ç®—å‡ºäº†<code>&#39;transform&#39;</code>æ•°å€¼<code>transformX</code>ï¼Œ<code>transformY</code>ï¼Œ<code>k</code>ã€‚ç°åœ¨éœ€è¦ä¿®æ”¹<code>&lt;svg&gt;</code>çš„<code>__zoom</code>å±æ€§ä¸ºå½“å‰çš„<code>&#39;transform&#39;</code>æ•°å€¼ã€‚</p>
<p>æŸ¥é˜…äº†å®˜æ–¹æ–‡æ¡£ï¼Œæ‰¾åˆ°äº†å¯ä»¥ä½¿ç”¨çš„APIï¼š</p>
<ul>
<li><code>d3.zoomIdentity</code>ã€‚è¿™ä¸ªAPIå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„<code>&#39;transform&#39;:&#123;x:0,y:0,k:1&#125;</code>ï¼Œå¹¶å…è®¸ä½¿ç”¨<code>transform.translate(x,y), transform.scale(k)</code>å¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚</li>
<li><code>selection.call(zoom.transform,new_transform);</code>ä½¿ç”¨è¿™ä¸ªæ¥å£èƒ½å¤Ÿå°†<code>&lt;svg&gt;.__zoom</code>ä¿®æ”¹ä¸º<code>new_transform</code></li>
</ul>
<p>ç»¼ä¸Šï¼Œä»£ç ä¸ºï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> new_transform = d3.<span class="property">zoomIdentity</span>.<span class="title function_">translate</span>(transformX, transformY).<span class="title function_">scale</span>(k);</span><br><span class="line">d3.<span class="title function_">select</span>(<span class="string">&#x27;svg&#x27;</span>).<span class="title function_">call</span>(zoom.<span class="property">transform</span>,new_transform);</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç®€è€Œè¨€ä¹‹ï¼Œä»»ä½•å¯¹<code>&lt;g&gt;</code>çš„æ”¾ç¼©ä¸å¹³ç§»æ“ä½œï¼Œéƒ½éœ€è¦ä½œç”¨åœ¨<code>&lt;svg&gt;</code>ä¸Šï¼Œå¹¶ä¸”ä½¿ç”¨<code>&lt;svg&gt;.__zoom()</code>æ¥ä¿®æ”¹ã€‚</p>
<p>å®Œæ•´ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//zoomäº‹ä»¶ç»‘å®š</span></span><br><span class="line"><span class="keyword">const</span> svg = d3.<span class="title function_">select</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;svg&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> g = svg.<span class="title function_">append</span>(<span class="string">&#x27;g&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> zoom = d3.<span class="title function_">zoom</span>().<span class="title function_">on</span>(<span class="string">&#x27;zoom&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  g.<span class="title function_">attr</span>(<span class="string">&#x27;transform&#x27;</span>, d3.<span class="title function_">zoomTransform</span>(svg.<span class="title function_">node</span>()));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//éœ€è¦ä¿®æ”¹ç‰¹å®štransformçš„å‡½æ•°ï¼Œä»¥autoZoomä¸ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">autoZoom</span> = (<span class="params">transformX,transformY,k</span>) =&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> new_transform = d3.<span class="property">zoomIdentity</span>.<span class="title function_">translate</span>(transformX, transformY).<span class="title function_">scale</span>(k);</span><br><span class="line">	d3.<span class="title function_">select</span>(<span class="string">&#x27;svg&#x27;</span>).<span class="title function_">call</span>(zoom.<span class="property">transform</span>,new_transform);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>visual analytics</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>å®ç°autoZoom(),ç”»å¸ƒè‡ªé€‚åº”æ”¾ç¼©å¹¶å±…ä¸­@D3.js-v5</title>
    <url>/2023/03/24/3423a90bb58e/</url>
    <content><![CDATA[<h1 id="å®ç°autoZoom-ç”»å¸ƒè‡ªé€‚åº”æ”¾ç¼©å¹¶å±…ä¸­-D3-js-v5"><a href="#å®ç°autoZoom-ç”»å¸ƒè‡ªé€‚åº”æ”¾ç¼©å¹¶å±…ä¸­-D3-js-v5" class="headerlink" title="å®ç°autoZoom(),ç”»å¸ƒè‡ªé€‚åº”æ”¾ç¼©å¹¶å±…ä¸­ @D3.js-v5"></a>å®ç°<code>autoZoom()</code>,ç”»å¸ƒè‡ªé€‚åº”æ”¾ç¼©å¹¶å±…ä¸­ @D3.js-v5</h1><h3 id="éœ€æ±‚é™ˆè¿°ï¼š"><a href="#éœ€æ±‚é™ˆè¿°ï¼š" class="headerlink" title="éœ€æ±‚é™ˆè¿°ï¼š"></a>éœ€æ±‚é™ˆè¿°ï¼š</h3><p>â€‹    ç”»å‡ºäº†ä¸€å¼ èŠ‚ç‚¹é“¾æ¥å›¾ï¼Œè™½ç„¶å¯ä»¥å›ºå®šå¸ƒå±€ä¸­å¿ƒï¼Œä½†æ¯æ¬¡ä½¿ç”¨ä¸åŒå±å¹•æ—¶ï¼Œè¿™ä¸ªå¸ƒå±€ä¸­å¿ƒæ€»æ˜¯ä¼šæ”¹å˜ï¼Œå¯¼è‡´èŠ‚ç‚¹é“¾æ¥å›¾æ— æ³•ä½äºç”»å¸ƒä¸­å¤®ï¼Œä¸”å¤§å°ä¸é€‚å®œï¼Œå› æ­¤éœ€è¦å®ç°ä¸€ä¸ªè‡ªé€‚åº”æ”¾ç¼©æ–¹æ³•ï¼Œä½¿ç”»å¸ƒæŒ‰ç…§å±å¹•çš„å°ºå¯¸è¿›è¡Œæ”¾ç¼©ï¼Œå¹¶å°†å…ƒç´ å±…ä¸­å±•ç¤ºã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202303241514591.png" alt="image-20230324144012412"></p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>â€‹    è¿™æ˜¯ä¸€ä¸ªç”»å¸ƒçš„åµŒå¥—æ–¹å¼ã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202303241514564.png" alt=""></p>
<ul>
<li>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª<code>&lt;svg&gt;</code>æ ‡ç­¾ï¼ˆå›¾ä¸­ä¸ºç°ç»¿è‰²ï¼‰ï¼Œé•¿å®½ä¸ç”¨æˆ·ç•Œé¢/ç»„ä»¶çš„é•¿å®½ç›¸åŒã€‚è¿™ä¸ª<code>&lt;svg&gt;</code>åªæ˜¯ä¸€ä¸ªåŒ…è£¹çš„å®¹å™¨ï¼Œä¸€èˆ¬æ˜¯ä¸ç›´æ¥åœ¨å…¶ä¸­æ”¾ç½®å›¾å…ƒçš„ã€‚</li>
<li>æ¥ç€ï¼Œåœ¨<code>&lt;svg&gt;</code>å†…éƒ¨åˆ›å»ºä¸€ä¸ª<code>&lt;g&gt;</code>æ ‡ç­¾ï¼ˆå›¾ä¸­ä¸ºé»‘è‰²ï¼‰ï¼Œæˆ‘ä»¬çœŸæ­£éœ€è¦ç»˜åˆ¶çš„å›¾å…ƒï¼Œéƒ½ä¼šæ”¾ç½®åœ¨è¿™ä¸ª<code>&lt;g&gt;</code>æ ‡ç­¾ä¸­ã€‚</li>
<li>ä¸º<code>&lt;svg&gt;</code>æ ‡ç­¾ç»‘å®š<code>d3.zoom()</code>äº‹ä»¶ï¼Œå¹¶å°†è¿™ä¸ª<code>zoom</code>äº‹ä»¶çš„<code>transform</code>å¯¹è±¡ï¼Œåº”ç”¨åœ¨<g>ä¸­</li>
</ul>
<p>â€‹    åªè¦ç†è§£äº†æœ€åä¸€æ­¥ï¼Œå°±ç†è§£äº†è¿™æ•´ä¸ªæµç¨‹ã€‚ä¸ºä»€ä¹ˆè¦æŠŠ<code>d3.zoom()</code>ç»‘å®šåœ¨å¤–éƒ¨çš„<code>&lt;svg&gt;</code>æ ‡ç­¾ä¸Šå‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦è®¾æƒ³ä¸€ä¸ªåœºæ™¯ï¼šå‡è®¾æˆ‘ä»¬æŠŠzoomäº‹ä»¶ç»‘å®šåœ¨äº†å†…éƒ¨çš„<code>&lt;g&gt;</code>æ ‡ç­¾ä¸Šï¼Œé‚£ä¹ˆå½“ç”¨æˆ·å°†<g>æ ‡ç­¾å…¨éƒ¨æ‹–åŠ¨åˆ°<svg>å¤–éƒ¨æ—¶ï¼Œå°±æ²¡åŠæ³•æ‹–å›æ¥äº†ã€‚å› ä¸ºæ­¤æ—¶ç”¨æˆ·é¼ æ ‡å·²ç»æ— æ³•é€‰ä¸­<g>æ ‡ç­¾äº†ã€‚æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼š</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202303241517212.png" alt="image-20230324145631127"></p>
<p>â€‹    å› æ­¤ï¼Œä¸ºäº†é¿å…ç”¨æˆ·å°†ç”»å¸ƒæ‹–èµ°åæ— æ³•æ‹–å›æ¥ï¼Œæˆ‘ä»¬åº”è¯¥è®¾ç½®ä¸€ä¸ªâ€œé™æ­¢â€çš„çª—å£ï¼Œå°†æ‹–åŠ¨å’Œæ”¾ç¼©äº‹ä»¶ç»‘å®šåœ¨è¿™ä¸Šé¢ï¼Œå¹¶ä¸”å°†è¿™ä¸ªäº‹ä»¶ä½œç”¨æ¥è¿™ä¸ªé™æ­¢çª—å£å†…éƒ¨çš„å…ƒç´ ä¸Šã€‚è¿™é‡Œçš„é™æ­¢çª—å£å°±æ˜¯<code>&lt;svg&gt;</code>,è€Œäº‹ä»¶ä½œç”¨çš„å…ƒç´ å°±æ˜¯<code>&lt;g&gt;</code>ï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆè¦é€‰ç”¨è¿™ç§åµŒå¥—çš„å½¢å¼ã€‚</p>
<p>â€‹    ç†è§£äº†è¿™ç‚¹ï¼Œä»£ç å°±å¾ˆå¥½å†™äº†ã€‚æˆ‘ä»¬åªéœ€è¦å‘æ”¾ç¼©çš„å‡½æ•°ä¸­ä¼ å…¥å¤–éƒ¨<svg>çš„idï¼Œå†…éƒ¨<g>çš„idï¼Œ<code>zoomObj</code>å³å¯ã€‚è¿™é‡Œè¿˜å¯ä»¥ä¼ å…¥<code>padding</code>ï¼Œå’Œ<code>duration</code>ï¼Œè®¾ç½®ç”»å¸ƒçš„å·¦å³é—´éš™å’Œè¡¥é—´åŠ¨æ•ˆã€‚</p>
<h3 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h3><h5 id="è®¾ç½®ç”¨æˆ·æ‘ä¸‹ctrlé”®ï¼Œå°±è‡ªé€‚åº”æ”¾ç¼©å¹¶å±…ä¸­"><a href="#è®¾ç½®ç”¨æˆ·æ‘ä¸‹ctrlé”®ï¼Œå°±è‡ªé€‚åº”æ”¾ç¼©å¹¶å±…ä¸­" class="headerlink" title="è®¾ç½®ç”¨æˆ·æ‘ä¸‹ctrlé”®ï¼Œå°±è‡ªé€‚åº”æ”¾ç¼©å¹¶å±…ä¸­"></a>è®¾ç½®ç”¨æˆ·æ‘ä¸‹<code>ctrl</code>é”®ï¼Œå°±è‡ªé€‚åº”æ”¾ç¼©å¹¶å±…ä¸­</h5><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> zoomObj = d3.<span class="title function_">zoom</span>().<span class="title function_">scaleExtent</span>([<span class="number">1</span> / <span class="number">50</span>, <span class="number">2</span>]);</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">onkeydown</span> = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (e.<span class="property">keyCode</span> === <span class="number">17</span>) &#123;</span><br><span class="line">    <span class="title function_">autoZoom</span>(</span><br><span class="line">      zoomObj,<span class="comment">//ä¼ å…¥zoomObj</span></span><br><span class="line">      <span class="string">&#x27;svgContainer&#x27;</span>,<span class="comment">//&lt;svg&gt;çš„id</span></span><br><span class="line">      <span class="string">&#x27;svg&#x27;</span>,<span class="comment">//&lt;g&gt;çš„id</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">row</span>: <span class="number">20</span>,</span><br><span class="line">        <span class="attr">col</span>: <span class="number">10</span></span><br><span class="line">      &#125;,<span class="comment">//é—´éš™å‚æ•°ï¼ˆè‡ªå®šï¼‰</span></span><br><span class="line">      <span class="number">1000</span> <span class="comment">// è¡¥é—´æ—¶é•¿ï¼ˆè‡ªå®šï¼‰</span></span><br><span class="line">    )</span><br><span class="line">  s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="autoZoom-å‡½æ•°å®ç°"><a href="#autoZoom-å‡½æ•°å®ç°" class="headerlink" title="autoZoom()å‡½æ•°å®ç°"></a><code>autoZoom()</code>å‡½æ•°å®ç°</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//autoZoom() function body</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  <span class="doctag">@param</span> zoomObj: æ”¾ç¼©å¯¹è±¡ï¼Œè®¾ç½®äº†æ”¾ç¼©æ¯”ç‡</span></span><br><span class="line"><span class="comment">  <span class="doctag">@param</span> svgContainerId: å®¹å™¨ &lt;svg&gt;</span></span><br><span class="line"><span class="comment">  <span class="doctag">@param</span> svgBodyId: ç”»å¸ƒ &lt;g&gt;</span></span><br><span class="line"><span class="comment">  <span class="doctag">@param</span> marginParam: é—´éš™å‚æ•°ï¼ˆè‡ªå®šä¹‰ï¼‰</span></span><br><span class="line"><span class="comment">  <span class="doctag">@param</span> duration: è¡¥é—´æ—¶é•¿</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">autoZoom</span> = (<span class="params">zoomObj, svgContainerId, svgBodyId, marginParam, duration</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> svgContainer = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">`#<span class="subst">$&#123;svgContainerId&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">const</span> svgBody = d3.<span class="title function_">select</span>(<span class="string">`#<span class="subst">$&#123;svgBodyId&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">if</span> (!svgContainer) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> viewBox = svgBody.<span class="title function_">node</span>().<span class="title function_">getBBox</span>();<span class="comment">//å¿…é¡»ç”¨d3.select,æ‰æœ‰getBoxï¼Œè·å–åˆ°é•¿å’Œå®½</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//svgï¼ˆå®ƒæ˜¯é™æ­¢çš„ï¼‰</span></span><br><span class="line">  <span class="keyword">const</span> containerWidth = svgContainer.<span class="property">clientWidth</span><span class="comment">//svgæ ‡ç­¾çš„å®½</span></span><br><span class="line">  <span class="keyword">const</span> containerHeight = svgContainer.<span class="property">clientHeight</span><span class="comment">//svgæ ‡ç­¾çš„é«˜</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// margin setting</span></span><br><span class="line">  <span class="keyword">const</span> rowMargin = marginParam.<span class="property">row</span></span><br><span class="line">  <span class="keyword">const</span> colMargin = marginParam.<span class="property">col</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//è®¡ç®—æ”¾ç¼©å€æ•°</span></span><br><span class="line">  <span class="keyword">const</span> scale = <span class="title class_">Math</span>.<span class="title function_">min</span>((containerWidth - rowMargin) / viewBox.<span class="property">width</span>, (containerHeight - colMargin) / viewBox.<span class="property">height</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//è®¡ç®—å¦‚æœè¦å±…ä¸­ï¼Œç”»å¸ƒéœ€è¦çš„åç§»é‡</span></span><br><span class="line">  <span class="keyword">const</span> offsetX = (containerWidth - rowMargin) / <span class="number">2</span> - (viewBox.<span class="property">x</span> + viewBox.<span class="property">width</span> / <span class="number">2</span>) * scale</span><br><span class="line">  <span class="keyword">const</span> offsetY = (containerHeight - colMargin) / <span class="number">2</span> - (viewBox.<span class="property">y</span> + viewBox.<span class="property">height</span> / <span class="number">2</span>) * scale</span><br><span class="line"></span><br><span class="line">  <span class="comment">// d3.zoomIdentity:ç¼©æ”¾å‚æ•°ï¼Œè¿”å›Transform&#123;k:1,x:0,y:0&#125;</span></span><br><span class="line">  <span class="keyword">const</span> t = d3.<span class="property">zoomIdentity</span>.<span class="title function_">translate</span>(offsetX + rowMargin / <span class="number">2</span>, offsetY).<span class="title function_">scale</span>(scale)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//è®¡ç®—å®Œæ¯•å¾—åˆ°æ”¾ç¼©å‚æ•°tï¼Œ&lt;svg&gt;æ ‡ç­¾è°ƒç”¨zoomObjå’Œè®¡ç®—å¥½çš„t</span></span><br><span class="line">  d3.<span class="title function_">select</span>(<span class="string">`#<span class="subst">$&#123;svgContainerId&#125;</span>`</span>).<span class="title function_">transition</span>().<span class="title function_">duration</span>(duration).<span class="title function_">call</span>(zoomObj.<span class="property">transform</span>, t)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>visual analytics</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤§å‹èŠ‚ç‚¹é“¾æ¥å›¾å¿«é€Ÿæ¸²æŸ“æ–¹æ¡ˆ @web workerçš„ä½¿ç”¨ä¸æ”¹è¿›</title>
    <url>/2022/08/02/773f2fecc59b/</url>
    <content><![CDATA[<h1 id="å¤§å‹èŠ‚ç‚¹é“¾æ¥å›¾å¿«é€Ÿæ¸²æŸ“æ–¹æ¡ˆ"><a href="#å¤§å‹èŠ‚ç‚¹é“¾æ¥å›¾å¿«é€Ÿæ¸²æŸ“æ–¹æ¡ˆ" class="headerlink" title="å¤§å‹èŠ‚ç‚¹é“¾æ¥å›¾å¿«é€Ÿæ¸²æŸ“æ–¹æ¡ˆ"></a>å¤§å‹èŠ‚ç‚¹é“¾æ¥å›¾å¿«é€Ÿæ¸²æŸ“æ–¹æ¡ˆ</h1><p>â€‹    è™½ç„¶Canvaså¯ä»¥ç”¨äºæ¸²æŸ“ä¸‡çº§æ•°æ®é‡ï¼Œä½†æ˜¯å½“èŠ‚ç‚¹æ•°è¶…è¿‡1wæ—¶ï¼Œå°½ç®¡ä¸€æ¬¡æ¸²æŸ“çš„æ—¶é—´å¾ˆçŸ­ï¼Œä½†è¿˜æ˜¯ä¼šäº§ç”Ÿè§†è§‰ä¸Šçš„å¡é¡¿ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ç»§ç»­è°ƒç ”äº†ä¸€äº›ä¼˜åŒ–æ–¹æ¡ˆï¼ŒåŒ…æ‹¬</p>
<ul>
<li>åŸºäºWeb Workerè®¡ç®—å’Œæ¸²æŸ“å¹¶è¡ŒæŠ€æœ¯ã€å®ç°å¹¶ä¼˜åŒ–ã€‘</li>
<li>åŸºäºCanvasçš„ç¦»å±æ¸²æŸ“æŠ€æœ¯ã€å®ç°ã€‘</li>
<li>ä»¥åŠåŸºäºCanvasçš„3Dæ¡†æ¶â€”WebGLæŠ€æœ¯ã€‚ã€æœªå°è¯•ã€‘</li>
</ul>
<h2 id="1-åŸºäºWeb-Workerçš„è®¡ç®—ä¸æ¸²æŸ“çš„å¹¶è¡Œæ–¹æ³•"><a href="#1-åŸºäºWeb-Workerçš„è®¡ç®—ä¸æ¸²æŸ“çš„å¹¶è¡Œæ–¹æ³•" class="headerlink" title="1   åŸºäºWeb Workerçš„è®¡ç®—ä¸æ¸²æŸ“çš„å¹¶è¡Œæ–¹æ³•"></a>1   åŸºäºWeb Workerçš„è®¡ç®—ä¸æ¸²æŸ“çš„å¹¶è¡Œæ–¹æ³•</h2><p>â€‹    æµè§ˆå™¨æ¸²æŸ“é¡µé¢æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œå› ä¸ºæµè§ˆå™¨å†…æ ¸æ˜¯å¤šçº¿ç¨‹çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦æ¶‰åŠåˆ°å¤šä¸ªçº¿ç¨‹ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯JSå¼•æ“çº¿ç¨‹å’ŒGUIæ¸²æŸ“çº¿ç¨‹ï¼Œå…¶ä¸­JSå¼•æ“çº¿ç¨‹ç”¨æ¥æ‰§è¡Œè„šæœ¬æ–‡ä»¶ï¼Œä¾ç…§ä»£ç é€»è¾‘è®¡ç®—é¡µé¢å…ƒç´ çš„ä½ç½®ï¼›è€ŒGUIçº¿ç¨‹åˆ™å°†è¿™äº›å¯¹åº”çš„é¡µé¢å…ƒç´ æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚ä¸ºäº†é˜²æ­¢åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å› å…ƒç´ çš„ä½ç½®å‘ç”Ÿå˜åŒ–è€Œå¯¼è‡´æ¸²æŸ“å‡ºé”™ï¼Œ<strong>æµè§ˆå™¨å°†GUIæ¸²æŸ“çº¿ç¨‹ä¸JSå¼•æ“è®¾ç½®ä¸ºäº’æ–¥çš„å…³ç³»</strong>ï¼Œå³å½“JSå¼•æ“æ‰§è¡Œæ—¶GUIçº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼ŒGUIæ›´æ–°ä¼šè¢«ä¿å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­ç­‰åˆ°JSå¼•æ“ç©ºé—²æ—¶è¢«æ‰§è¡Œã€‚åœ¨å¯¹ä¸€ä¸ªå›¾è¿›è¡Œå¸ƒå±€çš„æ—¶å€™ï¼Œéœ€è¦å¤šæ¬¡è¿­ä»£ä»¥è‡³äºå›¾ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„ä½ç½®è¾¾åˆ°ç¨³å®šï¼Œé‚£ä¹ˆå°±<strong>éœ€è¦JSå¼•æ“çº¿ç¨‹å’ŒGUIçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œ</strong>ï¼Œå…ˆåˆ©ç”¨JSå¼•æ“çº¿ç¨‹è®¡ç®—å‡ºä¸‹ä¸€æ¬¡å¸ƒå±€æ‰€æœ‰å…ƒç´ çš„ä½ç½®ï¼Œç„¶åå†åˆ©ç”¨GUIçº¿ç¨‹å°†æ‰€æœ‰å…ƒç´ æ¸²æŸ“è‡³é¡µé¢ä¸Šï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰€æœ‰çš„è¿­ä»£éƒ½å®Œæˆã€‚æˆ‘ä»¬çŒœæµ‹è¿™æ˜¯å¯¼è‡´å¤§è§„æ¨¡æ•°æ®åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­äº§ç”Ÿå¡é¡¿çš„åŸå› ï¼Œå› ä¸ºè®¡ç®—èŠ‚ç‚¹ä¸‹ä¸€æ¬¡è¿­ä»£çš„è¿‡ç¨‹éœ€è¦è€—æ—¶ï¼Œæ— æ³•ç›´æ¥è¿›è¡Œè¿ç»­æ¸²æŸ“ã€‚</p>
<p>â€‹    <strong>Web Worker</strong>æ˜¯ä¸€ç§å¯ä¸ºJavaScriptåˆ›é€ å¤šçº¿ç¨‹ç¯å¢ƒï¼Œå¹¶å°†ä¸€äº›é«˜å¯†åº¦è®¡ç®—ä»»åŠ¡åˆ†é…ç»™å­çº¿ç¨‹è¿è¡Œçš„æ–¹æ³•,å…¶å…·ä½“å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æˆ‘ä»¬å°è¯•ä½¿ç”¨Web Workerå°†å¯è§†åŒ–å·¥ä½œæµå¹¶è¡ŒåŒ–æ¥è§£å†³æ¸²æŸ“å¡é¡¿çš„é—®é¢˜ã€‚æˆ‘ä»¬å°†æ¸²æŸ“å·¥ä½œä¸å¸ƒå±€å·¥ä½œåˆ†å¼€ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼šå£°æ˜ä¸€ä¸ªWorkerå­çº¿ç¨‹æ¥æ‰§è¡Œé«˜æ—¶é—´å¤æ‚åº¦çš„å¸ƒå±€è¿­ä»£è®¡ç®—å·¥ä½œï¼Œå¹¶å°†æ¯ä¸€æ¬¡è¿­ä»£åçš„è®¡ç®—ç»“æœè¿”å›ç»™ä¸»çº¿ç¨‹ã€‚è€Œä¸»çº¿ç¨‹é€šè¿‡æ¥æ”¶å­çº¿ç¨‹çš„è®¡ç®—ç»“æœï¼Œè¿›è¡Œæ¯æ¬¡è¿­ä»£çš„å¸ƒå±€æ¸²æŸ“ã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/image-20220802200137368.png" alt="image-20220802200137368"></p>
<p>ç”±äºå¸ƒå±€æ¸²æŸ“çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«ä¸ºåŸºäºçŸ¢é‡çš„<strong>SVG</strong>å¸ƒå±€æ¸²æŸ“æ–¹æ³•ä»¥åŠåŸºäºä½å›¾çš„<strong>Canvas</strong>å¸ƒå±€æ¸²æŸ“æ–¹æ³•ï¼Œæˆ‘åŒæ—¶åˆ©ç”¨Web Workerè¿›è¡Œè®¡ç®—ä¸æ¸²æŸ“çš„å¹¶è¡Œè®¡ç®—ä¼˜åŒ–ï¼Œå®éªŒWeb Workerçš„æœ‰æ•ˆæ€§ã€‚</p>
<h4 id="å®éªŒæ•°æ®è§„æ¨¡ï¼š"><a href="#å®éªŒæ•°æ®è§„æ¨¡ï¼š" class="headerlink" title="å®éªŒæ•°æ®è§„æ¨¡ï¼š"></a><strong>å®éªŒæ•°æ®è§„æ¨¡ï¼š</strong></h4><ul>
<li><strong>case1:</strong> node(114),link(183)</li>
<li><strong>case2:</strong> node(121),link(334)</li>
<li><strong>case3:</strong> node(207),link(458)</li>
<li><strong>case4:</strong> node(368),link(617)</li>
<li><strong>case5:</strong> node(589),link(1057)</li>
<li><strong>case6:</strong> node(1079),link(2345)</li>
<li><strong>case7:</strong> node(301),link(480)</li>
<li><strong>case8:</strong> node(385),link(144)</li>
<li><strong>case9:</strong> node(429),link(910)</li>
<li><strong>case10:</strong> node(2345),link(5217)</li>
<li><strong>case11:</strong> node(1589),link(5217)</li>
</ul>
<h3 id="1-1-åŸºäºWeb-Workerè®¡ç®—ä¸æ¸²æŸ“å¹¶è¡Œçš„SVGå¸ƒå±€æ¸²æŸ“æ–¹æ³•"><a href="#1-1-åŸºäºWeb-Workerè®¡ç®—ä¸æ¸²æŸ“å¹¶è¡Œçš„SVGå¸ƒå±€æ¸²æŸ“æ–¹æ³•" class="headerlink" title="1.1   åŸºäºWeb Workerè®¡ç®—ä¸æ¸²æŸ“å¹¶è¡Œçš„SVGå¸ƒå±€æ¸²æŸ“æ–¹æ³•"></a>1.1   åŸºäºWeb Workerè®¡ç®—ä¸æ¸²æŸ“å¹¶è¡Œçš„SVGå¸ƒå±€æ¸²æŸ“æ–¹æ³•</h3><h4 id="å®éªŒç»“æœï¼š"><a href="#å®éªŒç»“æœï¼š" class="headerlink" title="å®éªŒç»“æœï¼š"></a>å®éªŒç»“æœï¼š</h4><div class="table-container">
<table>
<thead>
<tr>
<th><strong>æ¡ˆä¾‹</strong></th>
<th><strong>Case1</strong></th>
<th><strong>Case2</strong></th>
<th><strong>Case3</strong></th>
<th><strong>Case4</strong></th>
<th><strong>Case5</strong></th>
<th><strong>Case6</strong></th>
<th><strong>Case7</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>èŠ‚ç‚¹æ•°</td>
<td>114</td>
<td>121</td>
<td>207</td>
<td>384</td>
<td>589</td>
<td>1079</td>
<td>301</td>
</tr>
<tr>
<td>æœªä½¿ç”¨Web Worker</td>
<td>1877</td>
<td>1705</td>
<td>2001</td>
<td>2757</td>
<td>4934</td>
<td>7336</td>
<td>2247</td>
</tr>
<tr>
<td>ä½¿ç”¨Web Worker</td>
<td>1001</td>
<td>2544</td>
<td>2460</td>
<td>3037</td>
<td>5460</td>
<td>11509</td>
<td>3830</td>
</tr>
<tr>
<td>é€Ÿåº¦æå‡(ms)</td>
<td>87.51%</td>
<td>-32.98%</td>
<td>-18.66%</td>
<td>-9.22%</td>
<td>-9.63%</td>
<td>-36.26%</td>
<td>-41.33%</td>
</tr>
<tr>
<td><strong>æ¡ˆä¾‹</strong></td>
<td><strong>Case8</strong></td>
<td><strong>Case9</strong></td>
<td><strong>Case10</strong></td>
<td><strong>Case11</strong></td>
<td><strong>3-1(3k)</strong></td>
<td><strong>1-1(6k)</strong></td>
<td><strong>6-1(1w)</strong></td>
</tr>
<tr>
<td>èŠ‚ç‚¹æ•°</td>
<td>114</td>
<td>429</td>
<td>2345</td>
<td>1589</td>
<td>3228</td>
<td>7987</td>
<td>18460</td>
</tr>
<tr>
<td>æœªä½¿ç”¨Web Worker</td>
<td>1869</td>
<td>4148</td>
<td>16431</td>
<td>11954</td>
<td>23276</td>
<td>50808</td>
<td>201359</td>
</tr>
<tr>
<td>ä½¿ç”¨Web Worker</td>
<td>2753</td>
<td>5344</td>
<td>29163</td>
<td>20176</td>
<td>29797</td>
<td>98663</td>
<td>â€”</td>
</tr>
<tr>
<td>é€Ÿåº¦æå‡(ms)</td>
<td>-32.11%</td>
<td>-22.38%</td>
<td>-43.66%</td>
<td>-40.75%</td>
<td>-21.88%</td>
<td>-48.50%</td>
<td>â€”</td>
</tr>
</tbody>
</table>
</div>
<p>â€‹    åœ¨åŸºäºçŸ¢é‡çš„SVGå¸ƒå±€æ¸²æŸ“æ–¹æ³•çš„åŸºç¡€ä¸Šï¼Œç»è¿‡Web Workerè®¡ç®—ä¸æ¸²æŸ“å¹¶è¡Œçš„ä¼˜åŒ–å®éªŒå¯çŸ¥ï¼Œåªæœ‰åœ¨æ¡ˆä¾‹1ä¸­ä½¿ç”¨Web Workerçš„è€—æ—¶æ¯”ä¸ä½¿ç”¨Web Workeræœ‰æ‰€æå‡ï¼Œä½†åœ¨å…¶ä»–çš„æ¡ˆä¾‹ä¸­ï¼Œé€šè¿‡å°†è®¡ç®—å’Œæ¸²æŸ“åˆ†ä¸ºä¸¤ä¸ªçº¿ç¨‹åè€Œä¼šé€ æˆè€—æ—¶æˆæœ¬å¢åŠ ã€‚æˆ‘ä»¬åˆ†æå¯¼è‡´è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼š<strong>åœ¨è®¡ç®—å’Œæ¸²æŸ“ä¸­ï¼Œä¸€æ¬¡æ¸²æŸ“çš„æ—¶é—´è¿œè¿œå¤§äºä¸€æ¬¡å¸ƒå±€è¿­ä»£è®¡ç®—çš„æ—¶é—´</strong>ã€‚è¿™æ ·å°±ä¼šå‡ºç°å­çº¿ç¨‹çš„å¸ƒå±€ç»“æœæ—©å·²è®¡ç®—å®Œæ¯•ï¼Œä½†ä¸»çº¿ç¨‹çš„æ¸²æŸ“å·¥ä½œè¿˜æœªå®Œæˆçš„æƒ…å†µï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šå› æ­¤å †ç§¯å¤§é‡å­çº¿ç¨‹å‘é€çš„å¸ƒå±€ç»“æœ ï¼Œè€Œæ¯æ¬¡éƒ½éœ€è¦ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®å­˜åœ¨çš„è€—æ—¶æ¯”åœ¨ä¸»çº¿ç¨‹ä¸Šå®Œæˆå¸ƒå±€è¿­ä»£è®¡ç®—çš„æ—¶é—´æˆæœ¬è¿˜é«˜ã€‚å› æ­¤ï¼Œç»è¿‡å®éªŒå¯çŸ¥ï¼Œ<strong>å¦‚æœé€‰æ‹©SVGä½œä¸ºæ¸²æŸ“æ–¹æ³•ï¼Œä½¿ç”¨Web Workeræ— æ³•ç»™ç”¨æˆ·å¸¦æ¥è‰¯å¥½çš„è§†è§‰ä½“éªŒ</strong>ã€‚</p>
<blockquote>
<p>å®Œæ•´ä»£ç è§<a href="https://github.com/zqqcee/large_scale_Vis/blob/main/src/svgWorker.html">github -&gt; svgWorker</a></p>
</blockquote>
<h3 id="1-2-åŸºäºWeb-Workerè®¡ç®—ä¸æ¸²æŸ“å¹¶è¡Œçš„Canvaså¸ƒå±€æ¸²æŸ“æ–¹æ³•"><a href="#1-2-åŸºäºWeb-Workerè®¡ç®—ä¸æ¸²æŸ“å¹¶è¡Œçš„Canvaså¸ƒå±€æ¸²æŸ“æ–¹æ³•" class="headerlink" title="1.2     åŸºäºWeb Workerè®¡ç®—ä¸æ¸²æŸ“å¹¶è¡Œçš„Canvaså¸ƒå±€æ¸²æŸ“æ–¹æ³•"></a>1.2     åŸºäºWeb Workerè®¡ç®—ä¸æ¸²æŸ“å¹¶è¡Œçš„Canvaså¸ƒå±€æ¸²æŸ“æ–¹æ³•</h3><p>â€‹    å½“é€‰æ‹©ä½¿ç”¨Canvasä½œä¸ºæ¸²æŸ“æ–¹æ³•çš„æ—¶å€™ï¼Œç”±äºCanvaså•æ¬¡æ¸²æŸ“çš„æ—¶é—´å¾ˆçŸ­ï¼Œä¸ä¼šå‡ºç°æ¶ˆæ¯é˜Ÿåˆ—å¤§é‡å †ç§¯å­çº¿ç¨‹å‘é€çš„å¸ƒå±€ç»“æœã€‚æˆ‘ä»¬çŒœæƒ³ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨Web Workerå¯¹æ¸²æŸ“æ€§èƒ½çš„æå‡æ˜¯æœ‰æ•ˆçš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯¹Canvaså¼€å±•äº†è®¡ç®—ä¸æ¸²æŸ“å¹¶è¡Œå¯¹å®éªŒã€‚å…·ä½“çš„å®éªŒï¼ˆ<strong>æ•°æ®è§„æ¨¡åŒä¸Š</strong>ï¼‰å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>æ¡ˆä¾‹</strong></th>
<th><strong>Case1</strong></th>
<th><strong>Case2</strong></th>
<th><strong>Case3</strong></th>
<th><strong>Case4</strong></th>
<th><strong>Case5</strong></th>
<th><strong>Case6</strong></th>
<th><strong>Case7</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>èŠ‚ç‚¹æ•°</td>
<td>114</td>
<td>121</td>
<td>207</td>
<td>384</td>
<td>589</td>
<td>1079</td>
<td>301</td>
</tr>
<tr>
<td>æœªä½¿ç”¨Web Worker</td>
<td>56</td>
<td>76</td>
<td>103</td>
<td>169</td>
<td>267</td>
<td>516</td>
<td>160</td>
</tr>
<tr>
<td>ä½¿ç”¨Web Worker</td>
<td>121</td>
<td>122</td>
<td>143</td>
<td>256</td>
<td>452</td>
<td>576</td>
<td>213</td>
</tr>
<tr>
<td>é€Ÿåº¦æå‡(ms)</td>
<td>-53.72%</td>
<td>-37.70%</td>
<td>-27.97%</td>
<td>-33.98%</td>
<td>-40.9%</td>
<td>-10.4%</td>
<td>-24.88%</td>
</tr>
<tr>
<td><strong>æ¡ˆä¾‹</strong></td>
<td><strong>Case8</strong></td>
<td><strong>Case9</strong></td>
<td><strong>Case10</strong></td>
<td><strong>Case11</strong></td>
<td><strong>3-1</strong></td>
<td><strong>1-1</strong></td>
<td><strong>6-1</strong></td>
</tr>
<tr>
<td>èŠ‚ç‚¹æ•°</td>
<td>114</td>
<td>429</td>
<td>2345</td>
<td>1589</td>
<td>3228</td>
<td>7987</td>
<td>18460</td>
</tr>
<tr>
<td>æœªä½¿ç”¨Web Worker</td>
<td>88</td>
<td>197</td>
<td>1333</td>
<td>1346</td>
<td>1739</td>
<td>5120</td>
<td>12337</td>
</tr>
<tr>
<td>ä½¿ç”¨Web Worker</td>
<td>183</td>
<td>244</td>
<td>1908</td>
<td>1390</td>
<td>1755</td>
<td>5072</td>
<td>13837</td>
</tr>
<tr>
<td>é€Ÿåº¦æå‡(ms)</td>
<td>-51.91%</td>
<td>-19.26%</td>
<td>-30.14%</td>
<td>-3.17%</td>
<td>-0.91%</td>
<td>0.95%</td>
<td>-10.84%</td>
</tr>
</tbody>
</table>
</div>
<p>â€‹    å¯¹æ¯”èµ·svgæ¸²æŸ“ï¼Œä½¿ç”¨canvaså¯ä»¥æ˜æ˜¾åœ°æå‡æ¸²æŸ“æ€§èƒ½ã€‚ä¸»è¦åŸå› æ˜¯canvasçš„å•è¯æ¸²æŸ“è€—æ—¶å¤§å¹…ç¼©çŸ­ã€‚ä½†æ˜¯ç»è¿‡å¤šæ¬¡å®éªŒå¯¹æ¯”ï¼Œå‘ç°<strong>åœ¨èŠ‚ç‚¹æ•°é‡åœ¨è¶…è¿‡3kæ—¶ï¼Œä¼šå‡ºç°æ˜æ˜¾çš„å¡é¡¿ï¼Œæ¸²æŸ“æ•ˆæœä»å¹¶ä¸ç†æƒ³</strong>ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæ¯”èµ·ä¸ä½¿ç”¨Web Workerï¼Œä½¿ç”¨Web Workeræ—¶Canvasçš„æ¸²æŸ“è¡¨ç°åè€Œæ›´å·®åŠ²äº†ï¼Œç”¨æˆ·ç•Œé¢ä»ç„¶å­˜åœ¨éå¸¸æ˜æ˜¾çš„å¡é¡¿ã€‚</p>
<blockquote>
<p>å®Œæ•´ä»£ç è§ <a href="https://github.com/zqqcee/large_scale_Vis/blob/main/src/d3-canvas-worker.html">github -&gt; canvas worker</a></p>
</blockquote>
<h2 id="2-ä¼˜åŒ–I-OæŸè€—"><a href="#2-ä¼˜åŒ–I-OæŸè€—" class="headerlink" title="2     ä¼˜åŒ–I/OæŸè€—"></a>2     ä¼˜åŒ–I/OæŸè€—</h2><p>â€‹    åœ¨å®éªŒè¿‡ç¨‹ä¸­æˆ‘ä»¬å‘ç°ï¼Œå°½ç®¡ä½¿ç”¨Canvaså¯ä»¥ç¼©çŸ­å•æ¬¡æ¸²æŸ“çš„æ—¶é—´ï¼Œä¸ä¼šå‡ºç°æ¶ˆæ¯é˜Ÿåˆ—å¤§é‡å †ç§¯Workerçº¿ç¨‹å‘é€çš„å¸ƒå±€ç»“æœï¼Œä½†ç”¨æˆ·ç•Œé¢æ¸²æŸ“ä»å‡ºç°è¾ƒæ˜æ˜¾çš„å¡é¡¿ã€‚ç»è¿‡<strong>æ€§èƒ½åˆ†æ</strong>ï¼Œæˆ‘ä»¬å‘ç°<strong>ä¸»è¦æ˜¯ä¸»çº¿ç¨‹ä¸­çš„ä¸€ä¸ªæ•°æ®æ¥æ”¶å‡½æ•°å ç”¨äº†å¤§é‡æ—¶é—´</strong>ï¼Œè¿™ä¸ªå‡½æ•°åœ¨ä¸»çº¿ç¨‹ä¸­çš„ä½œç”¨æ˜¯æ¥æ”¶Workerçº¿ç¨‹å‘é€è¿‡æ¥çš„æ•°æ®ã€‚å½“èŠ‚ç‚¹æ•°é‡è¶…è¿‡1wæ—¶ï¼Œä¸»çº¿ç¨‹ä¸Workerçº¿ç¨‹çš„æ•°æ®äº¤æ¢ä¼šå ç”¨å¤§é‡æ—¶é—´ã€‚å› æ­¤ï¼Œéœ€è¦å°½å¯èƒ½ç¼©çŸ­ä¸»çº¿ç¨‹ä¸Workerçº¿ç¨‹çš„æ•°æ®äº¤æ¢çš„æ—¶é—´ä»¥è¾¾åˆ°æµç•…æ¸²æŸ“çš„ç›®çš„ã€‚</p>
<p>â€‹    è€ŒWorkerçº¿ç¨‹ä¸ä¸»çº¿ç¨‹ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ é€’çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯é€šè¿‡<strong>å¯¹è±¡æ‹·è´</strong>çš„æ–¹å¼ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡<strong>è½¬ç§»å¯¹è±¡å¼•ç”¨çš„æ‰€æœ‰æƒ</strong>çš„æ–¹å¼ã€‚ä½¿ç”¨å¯¹è±¡æ‹·è´çš„æ–¹å¼ï¼Œé€šè¿‡å†…éƒ¨çš„å…‹éš†ç®—æ³•ï¼Œå°†ä¸»çº¿ç¨‹çš„æ•°æ®æ‹·è´ä¸€ä»½ï¼Œä¼ ç»™workerã€‚è¿™æ ·workeræ”¹å˜æ•°æ®å¹¶ä¸ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/clip_image006.jpg" alt="img"></p>
<p>â€‹    å¦ä¸€ç§é€šè¿‡è½¬ç§»çš„æ–¹å¼ï¼ˆTransferrable Objectsï¼‰ï¼Œ<strong>ä¸åšä»»ä½•æ‹·è´ï¼Œè€Œæ˜¯ç›´æ¥å°†æ•°æ®å€¼çš„å¼•ç”¨æ‰€æœ‰æƒè½¬ç§»ç»™ workerã€‚</strong>å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æ‰€æœ‰æƒè¢«è½¬ç§»ï¼Œä¸»çº¿ç¨‹ä¸ä¼šå†æŒæœ‰è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡åœ¨å®ƒè¢«å‘é€çš„ä¸Šä¸‹æ–‡ä¸­å°†å˜å¾—ä¸å¯ç”¨ï¼Œå¹¶ä¸”åªå¯¹å®ƒè¢«è½¬ç§»åˆ°çš„Workerçº¿ç¨‹å¯ç”¨ã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/clip_image008.jpg" alt="img"></p>
<p>â€‹    æˆ‘ä»¬å®éªŒäº†è¿™ä¸¤ç§æ•°æ®ä¼ é€’æ–¹å¼çš„æ€§èƒ½æŒ‡æ ‡ï¼Œå‘ç°åœ¨å•æ¬¡æ•°æ®ä¼ é€’çš„è€—æ—¶ä¸Šï¼Œä½¿ç”¨è½¬ç§»çš„æ–¹å¼æ˜æ˜¾ä¼˜äºå¯¹è±¡æ‹·è´ã€‚ä¸‹å›¾æ˜¯åœ¨1wèŠ‚ç‚¹æ•°æ®é›†ä¸Šï¼Œä¸¤ç§æ•°æ®ä¼ é€’æ–¹å¼çš„å®éªŒç»“æœã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/clip_image010.jpg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/clip_image012.jpg" alt="img"></p>
<p>â€‹    å¯ä»¥çœ‹å‡ºæ€§èƒ½é¢æ¿ä¸Šï¼Œä½¿ç”¨å¯¹è±¡æ‹·è´æ–¹å¼ä¸€æ¬¡æ•°æ®ä¼ é€’çš„ä»»åŠ¡è€—æ—¶107.0msï¼Œè€Œä½¿ç”¨ä¼ é€’çš„æ–¹å¼ä»»åŠ¡è€—æ—¶ä»…æœ‰21.2msã€‚<strong>ä½¿ç”¨è½¬ç§»çš„æ–¹å¼è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œè¦æ±‚ä¼ é€’çš„å¯¹è±¡å¿…é¡»ä¸ºå¦‚ArrayBufferç­‰çš„æŒ‡å®šæ ¼å¼</strong>ï¼Œå› æ­¤è¿™<strong>ç‰ºç‰²äº†æ•°æ®çš„å¯è¯»æ€§</strong>ï¼Œä½†èƒ½å¤§å¹…æå‡æ•°æ®I/Oæ€§èƒ½ã€‚å¯¹æ­¤ï¼Œæˆ‘ä»¬è¿›è¡Œäº†æ•°æ®I/Oçš„æ€§èƒ½å®éªŒã€‚æˆ‘ä»¬æµ‹è¯•äº†ä¸»çº¿ç¨‹ä¸Workerçº¿ç¨‹å•æ¬¡I/Oçš„æ—¶é—´æŸè€—ï¼Œå®éªŒç»“æœå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<div class="table-container">
<table>
<thead>
<tr>
<th><strong>æ¡ˆä¾‹</strong></th>
<th><strong>Case1</strong></th>
<th><strong>Case2</strong></th>
<th><strong>Case3</strong></th>
<th><strong>Case4</strong></th>
<th><strong>Case5</strong></th>
<th><strong>Case6</strong></th>
<th><strong>Case7</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>èŠ‚ç‚¹æ•°</td>
<td>114</td>
<td>121</td>
<td>207</td>
<td>384</td>
<td>589</td>
<td>1079</td>
<td>301</td>
</tr>
<tr>
<td>æœªä½¿ç”¨Web Worker</td>
<td>56</td>
<td>76</td>
<td>103</td>
<td>169</td>
<td>267</td>
<td>516</td>
<td>160</td>
</tr>
<tr>
<td>ä½¿ç”¨å¯¹è±¡æ‹·è´</td>
<td>28</td>
<td>18</td>
<td>22</td>
<td>24</td>
<td>32</td>
<td>32</td>
<td>20</td>
</tr>
<tr>
<td>ä½¿ç”¨Transfer Object</td>
<td>34</td>
<td>26</td>
<td>30</td>
<td>30</td>
<td>43</td>
<td>74</td>
<td>35</td>
</tr>
<tr>
<td>é€Ÿåº¦æå‡(ms)</td>
<td>17.65%</td>
<td>30.77%</td>
<td>26.67%</td>
<td>20.00%</td>
<td>25.58%</td>
<td>56.76%</td>
<td>42.86%</td>
</tr>
<tr>
<td><strong>æ¡ˆä¾‹</strong></td>
<td><strong>Case8</strong></td>
<td><strong>Case9</strong></td>
<td><strong>Case10</strong></td>
<td><strong>Case11</strong></td>
<td><strong>3-1</strong></td>
<td><strong>1-1</strong></td>
<td><strong>6-1</strong></td>
</tr>
<tr>
<td>èŠ‚ç‚¹æ•°</td>
<td>114</td>
<td>429</td>
<td>2345</td>
<td>1589</td>
<td>3228</td>
<td>7987</td>
<td>18460</td>
</tr>
<tr>
<td>æœªä½¿ç”¨Web Worker</td>
<td>88</td>
<td>197</td>
<td>1333</td>
<td>1346</td>
<td>1739</td>
<td>5120</td>
<td>12337</td>
</tr>
<tr>
<td>ä½¿ç”¨å¯¹è±¡æ‹·è´</td>
<td>21</td>
<td>27</td>
<td>41</td>
<td>47</td>
<td>66</td>
<td>145</td>
<td>452</td>
</tr>
<tr>
<td>ä½¿ç”¨Transfer Object</td>
<td>28</td>
<td>35</td>
<td>117</td>
<td>126</td>
<td>151</td>
<td>483</td>
<td>1151</td>
</tr>
<tr>
<td>é€Ÿåº¦æå‡(ms)</td>
<td>25.00%</td>
<td>22.86%</td>
<td>64.96%</td>
<td>62.70%</td>
<td>56.29%</td>
<td>69.98%</td>
<td>60.73%</td>
</tr>
</tbody>
</table>
</div>
<p>â€‹    å¯¹å®éªŒç»“æœè¿›è¡Œåˆ†æï¼Œç”±è¡¨å¯ä»¥çœ‹å‡ºï¼Œéšç€èŠ‚ç‚¹æ•°çš„å¢åŠ ï¼Œä½¿ç”¨Transferrable Objectsçš„æ•°æ®ä¼ è¾“æ–¹å¼ï¼Œå¯¹æ•°æ®I/Oæ€§èƒ½çš„æå‡æ•ˆæœæ˜¾è‘—ã€‚å½“èŠ‚ç‚¹æ•°é‡è¶…è¿‡2kæ—¶ï¼Œæ•°æ®I/Oçš„é€Ÿåº¦å¹³å‡èƒ½å¤Ÿæå‡65%ã€‚</p>
<h3 id="2-1-å°†jsonè½¬ä¸ºArrayBufferå¤„ä»£ç å®ç°"><a href="#2-1-å°†jsonè½¬ä¸ºArrayBufferå¤„ä»£ç å®ç°" class="headerlink" title="2.1 å°†jsonè½¬ä¸ºArrayBufferå¤„ä»£ç å®ç°"></a>2.1 å°†jsonè½¬ä¸ºArrayBufferå¤„ä»£ç å®ç°</h3><p>â€‹    <strong>åªéœ€è¦å°†linksæ•°æ®å¤„ç†å¹¶ä¼ åˆ°workerçº¿ç¨‹ä¸­</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//DEFINE IN MAIN</span></span><br><span class="line">  <span class="keyword">let</span> nodeInfoMap = &#123;&#125;,</span><br><span class="line">      e = <span class="number">0</span>,</span><br><span class="line">      linkInfoMap = &#123;&#125;;</span><br><span class="line">  <span class="comment">//åˆ›å»ºnodeåœ°å›¾</span></span><br><span class="line">  data.<span class="property">nodes</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line">    nodeInfoMap[n.<span class="property">id</span>] || (nodeInfoMap[n.<span class="property">id</span>] = &#123;</span><br><span class="line">      <span class="attr">index</span>: e,</span><br><span class="line">      <span class="attr">id</span>: n.<span class="property">id</span></span><br><span class="line">    &#125;, e++)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//åˆ›å»ºiï¼Œlinkbufferçš„åŸå‹</span></span><br><span class="line">  <span class="keyword">let</span> i = [];</span><br><span class="line">  data.<span class="property">links</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> r = <span class="string">&quot;&quot;</span>.<span class="title function_">concat</span>(e.<span class="property">source</span>, <span class="string">&quot;-&quot;</span>).<span class="title function_">concat</span>(e.<span class="property">target</span>); <span class="comment">//æ¯æ¡è¾¹å¯¹åº”çš„å”¯ä¸€id</span></span><br><span class="line">    linkInfoMap[r] || (i.<span class="title function_">push</span>(nodeInfoMap[e.<span class="property">source</span>].<span class="property">index</span>, nodeInfoMap[e.<span class="property">target</span>].<span class="property">index</span>),</span><br><span class="line">                       linkInfoMap[r] = &#123;</span><br><span class="line">      <span class="attr">id</span>: r</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//å¾—åˆ°linkbuffer</span></span><br><span class="line">  <span class="keyword">let</span> linkBuffer = <span class="keyword">new</span> <span class="title class_">Int32Array</span>(i);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å®Œæ•´ä»£ç è§  <a href="https://github.com/zqqcee/large_scale_Vis/blob/main/src/d3-canvas-worker-transfer.html">github -&gt; worker-transfer</a></p>
</blockquote>
<h3 id="1-1-3-åŸºäºWeb-Worker-ç¦»å±æ¸²æŸ“çš„ä¼˜åŒ–æ–¹æ³•â€”zqcå®éªŒã€å·²å®Œæˆã€‘"><a href="#1-1-3-åŸºäºWeb-Worker-ç¦»å±æ¸²æŸ“çš„ä¼˜åŒ–æ–¹æ³•â€”zqcå®éªŒã€å·²å®Œæˆã€‘" class="headerlink" title="1.1.3     åŸºäºWeb Worker+ç¦»å±æ¸²æŸ“çš„ä¼˜åŒ–æ–¹æ³•â€”zqcå®éªŒã€å·²å®Œæˆã€‘"></a>1.1.3     åŸºäºWeb Worker+ç¦»å±æ¸²æŸ“çš„ä¼˜åŒ–æ–¹æ³•â€”zqcå®éªŒã€å·²å®Œæˆã€‘</h3><p>â€‹    åœ¨æ­£å¸¸çš„æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼ŒCPUä¼šå°†è®¡ç®—å¥½çš„å†…å®¹æäº¤åˆ°GPUï¼ŒGPUæ¸²æŸ“å®Œæˆåå°†æ¸²æŸ“ç»“æœæ”¾å…¥ç¼“å†²åŒºï¼Œéšåæ˜¾ç¤ºå™¨ä¼šæ˜¾ç¤ºç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚å…¶ä¸­GPUå±å¹•æ¸²æŸ“æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<p>ï¼ˆ1ï¼‰å½“å‰å±å¹•æ¸²æŸ“ï¼ˆOn-Screen Renderingï¼‰ï¼šæŒ‡çš„æ˜¯GPUçš„æ¸²æŸ“æ“ä½œä½œç”¨äºå½“å‰æ‰€æ˜¾ç¤ºçš„å±å¹•ç¼“å†²åŒºï¼›</p>
<p>ï¼ˆ2ï¼‰ç¦»å±æ¸²æŸ“ï¼ˆOff-Screen Renderingï¼‰ï¼šæŒ‡çš„æ˜¯GPUåœ¨å½“å‰å±å¹•ç¼“å†²åŒºä¹‹å¤–ï¼Œæ–°å¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“æ“ä½œã€‚æ¸²æŸ“çš„ç»“æœä¸ä¼šç›´æ¥å‘ˆç°åˆ°å½“å‰å±å¹•ä¸Šï¼Œè€Œæ˜¯ç­‰å¾…åˆé€‚çš„æ—¶æœºæ‰ä¼šæ˜¾ç¤ºã€‚ç›¸å½“äºåœ¨æŸä¸ªæ—¶é—´ç›´æ¥å°†å·²ç»æ¸²æŸ“å¥½çš„å›¾ç‰‡æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œåˆ™ä¸å¿…å†æ‰§è¡Œæ‰€æœ‰ç»˜å›¾æŒ‡ä»¤ã€‚</p>
<p>â€‹    å®ç°ç¦»å±æ¸²æŸ“çš„åŸºæœ¬æ€è·¯ï¼Œæ˜¯è¦å°†éœ€è¦é‡å¤æ¸²æŸ“çš„å›¾å½¢ç¼“å­˜ä¸ºå›¾ç‰‡ï¼Œåœ¨æ¸²æŸ“æ—¶å°†å›¾ç‰‡ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–è‡³å¦å¤–çš„ç”»å¸ƒä¸Šã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯å¸Œæœ›å‡å°‘åœ¨ä¸»ç”»å¸ƒä¸­åŸç”ŸCanvasæ¸²æŸ“æ¥å£çš„è°ƒç”¨æ¬¡æ•°ï¼Œä»¥æå‡æ¸²æŸ“æ•ˆç‡ã€‚ç”±äºåœ¨å¤§å›¾å¯è§†åŒ–ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¤§é‡é‡å¤åœ°ç»˜åˆ¶åœ†ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬å°è¯•å°†å®ƒä»¬ç¼“å­˜ä¸ºå›¾ç‰‡ï¼Œåœ¨æ¸²æŸ“æ—¶ç›´æ¥è¯»å–è‡³é™¤ä¸»ç”»å¸ƒå¤–çš„ç”»å¸ƒä¸Šå³å¯ã€‚</p>
<p>â€‹    ç”±äºæµè§ˆå™¨çš„ç¦»å±æ¸²æŸ“æŠ€æœ¯æ˜¯åŸºäºCanvasçš„ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬åªå¯¹Canvasé‡‡å–ç¦»å±æ¸²æŸ“ä¼˜åŒ–ã€‚å¤§å›¾å¯è§†åŒ–ä»»åŠ¡å¯åˆ†ä¸ºå¸ƒå±€ä¸æ¸²æŸ“ä¸¤ä¸ªå­ä»»åŠ¡ï¼Œç¦»å±æ¸²æŸ“æŠ€æœ¯åªèƒ½æå‡æ¸²æŸ“è¿™ä¸€å­ä»»åŠ¡çš„æ€§èƒ½ï¼Œè€Œå¯¹å¸ƒå±€è¿™ä¸€å­ä»»åŠ¡çš„æ€§èƒ½æ²¡æœ‰ä»»ä½•å½±å“ã€‚å› æ­¤ï¼Œå°†ç¦»å±æ¸²æŸ“åº”ç”¨äºå¤§å›¾å¯è§†åŒ–ä¸­å…·æœ‰ä¸€é¡¹å‰ææ¡ä»¶ï¼šè®¡ç®—å¸ƒå±€çš„Workerçº¿ç¨‹é€Ÿåº¦å¿«äºä¸»çº¿ç¨‹æ¸²æŸ“çš„é€Ÿåº¦ã€‚</p>
<p>â€‹    å¦‚ä¸‹å›¾å®éªŒç»“æœæ‰€ç¤ºï¼Œä½¿ç”¨canvasæ¸²æŸ“å¤§å›¾çš„è¿‡ç¨‹ä¸­ï¼Œè®¡ç®—å¸ƒå±€çš„Workerçº¿ç¨‹çš„æ—¶é—´å¼€é”€è¿œè¿œé«˜äºä¸»çº¿ç¨‹æ¸²æŸ“ã€‚å› æ­¤åœ¨åŸºäºCanvasçš„å¤§å›¾å¯è§†åŒ–ä»»åŠ¡ä¸­ï¼Œä½¿ç”¨ç¦»å±æ¸²æŸ“å¹¶ä¸ä¼šè¾¾åˆ°æå‡æ€§èƒ½çš„ç›®çš„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/clip_image016.jpg" alt="img"></p>
<blockquote>
<p>å®Œæ•´ä»£ç è§<a href="https://github.com/zqqcee/large_scale_Vis/blob/main/src/d3-canvas-worker-offscreen.html">github -&gt; offscreen</a></p>
</blockquote>
]]></content>
      <categories>
        <category>visual analytics</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>æµ…æDebounceä¸Throttleçš„åŒºåˆ«</title>
    <url>/2022/08/02/173a07e755e3/</url>
    <content><![CDATA[<p>è¿™ä¸¤å¤©åœ¨å­¦ä¹ å‰ç«¯çŸ¥è¯†ï¼Œåœ¨Vueçš„å®˜æ–¹æ•™ç¨‹ä¸­çœ‹åˆ°äº†è¿™ä¸¤ä¸ªæ¦‚å¿µï¼ŒæŸ¥é˜…ç›¸å…³èµ„æ–™åï¼Œåšä»¥ä¸‹æ•´ç†ã€‚</p>
<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><code>Debounce</code> å’Œ<code>Throttle</code>æ˜¯ä¸¤ä¸ªéå¸¸ç›¸ä¼¼ï¼Œä½†ä¸ç›¸åŒçš„æ–¹æ³•ï¼Œå®ƒä»¬éƒ½ç”¨æ¥æ§åˆ¶æˆ‘ä»¬å…è®¸ä¸€ä¸ªå‡½æ•°éšæ—¶é—´æ‰§è¡Œçš„æ¬¡æ•°ï¼Œç”¨å®˜æ–¹ä¸€ç‚¹çš„è¯´æ³•å°±æ˜¯ï¼š<strong>é˜²æ­¢æŠ–åŠ¨</strong>ã€‚ä½†æ˜¯å®ƒä»¬åˆæœ‰ä¸åŒï¼Œä»¥é¼ æ ‡ç‚¹å‡»äº‹ä»¶ç»‘å®šçš„å‡½æ•°<code>clickFunc()</code>ä¸ºä¾‹ï¼šå‡è®¾ç”¨æˆ·åœ¨10ç§’å†…ä¸é—´æ–­ç‚¹å‡»50ä¸‹é¼ æ ‡</p>
<ul>
<li><code>debounce(clickFunc(),delay)</code>æ˜¯å°†è¿™50æ¬¡é¼ æ ‡åœ¨ç”¨æˆ·åœæ­¢ç‚¹å‡»é¼ æ ‡ç‚¹å‡»åŠ¨ä½œçš„<code>delay</code>ç§’åï¼Œæ‰å“åº”ä¸€æ¬¡ã€‚</li>
<li>è€Œ<code>throttle(clickFunc(),delay)</code>æ˜¯åœ¨<code>delay</code>ç§’çš„æ—¶é—´é—´éš”å†…ã€‚æ— è®ºç”¨æˆ·ç‚¹å‡»å¤šå°‘æ¬¡ï¼Œåªå“åº”ä¸€æ¬¡ã€‚</li>
</ul>
<blockquote>
<p>è®²åˆ°è¿™é‡Œå¯èƒ½è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä½†æ²¡å…³ç³»ï¼Œæ¥ä¸‹æ¥è¿™ä¸ªä¾‹å­å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å®ƒä»¬çš„åŒºåˆ«</p>
<p>å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼šæ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå‡½æ•°éœ€è¦å“åº”ç”¨æˆ·çš„æ»šåŠ¨äº¤äº’ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡é¼ æ ‡æ»šè½®å’Œæ‹–åŠ¨ä¾§è¾¹çš„é•¿æ¡å½¢barè¿›è¡Œæ»šåŠ¨äº¤äº’ã€‚</p>
<ul>
<li>å¦‚æœæ»šåŠ¨ä¸€ä¸ªå•ä½ï¼Œæˆ‘ä»¬å°±éœ€è¦æ“ä½œä¸€æ¬¡DOMå…ƒç´ ã€‚é‚£ä¹ˆç”¨æˆ·å¦‚æœæ¯ç§’æ»šåŠ¨100ä¸ªå•ä½ï¼Œæ˜¯æ ¹æœ¬æ— æ³•å…¨éƒ¨å“åº”çš„ï¼Œè¿˜ä¼šé€ æˆæµè§ˆå™¨å¡æ­»ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>debounce()</code>ï¼Œè®©ç”¨æˆ·åœæ­¢æ»šåŠ¨åå†å“åº”ã€‚</li>
<li>ç»å¸¸åˆ·å¾®åšé€›çŸ¥ä¹çš„æœ‹å‹åº”è¯¥éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬å³å°†æ»‘åŠ¨åˆ°åº•éƒ¨çš„æ—¶å€™ï¼Œå‰ç«¯ä¼šè¯·æ±‚æ›´å¤šå†…å®¹ä»¥æ–¹ä¾¿æˆ‘ä»¬æŸ¥é˜…ã€‚è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿå…¶å®å°±æ˜¯ç”¨äº†<code>throttle(func()ï¼Œdelay)</code>å‡½æ•°ï¼Œå…¶ä¸­<code>func()</code>æ˜¯ä¸€ä¸ªæ£€æµ‹æ˜¯å¦å¿«åˆ°åº•éƒ¨çš„å‡½æ•°ï¼Œ<code>delay</code>ç”¨æ¥æ§åˆ¶å¤šé•¿æ—¶é—´é—´éš”å†…ï¼Œæµè§ˆå™¨å“åº”ä¸€æ¬¡ã€‚ç”¨æˆ·æ‰§è¡Œæ»šåŠ¨äº‹ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šåˆ¤å®šæ˜¯å¦é è¿‘åº•éƒ¨ï¼Œå¦‚æœé è¿‘åº•éƒ¨å°±å‘ä¸€ä¸ªAJAXè¯·æ±‚æ–°ä¸€æ‰¹å†…å®¹ã€‚è¿™ä¹Ÿé¿å…äº†è¿™ä¸ªå‡½æ•°ä¸€ç›´ç›‘å¬ï¼Œç”¨æˆ·é è¿‘åº•éƒ¨çš„æ¯ä¸€æ¬¡æ»‘åŠ¨éƒ½å»è¯·æ±‚æœåŠ¡å™¨ï¼Œç„¶åç»™æœåŠ¡å™¨å¸¦æ¥å¾ˆå¤šä¸å¿…è¦çš„è´Ÿæ‹…ã€‚</li>
</ul>
</blockquote>
<p><strong>è¿™ä¸¤ä¸ªå‡½æ•°åœ¨æˆ‘ä»¬å°†æŸä¸ªå‡½æ•°ç»‘å®šåˆ°æ“ä½œDOMå…ƒç´ çš„äº‹ä»¶ä¸Šéå¸¸æœ‰ç”¨</strong>ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ<br>è¿™ä¸¤ä¸ªå‡½æ•°çš„å‡ºç°ï¼Œå…¶å®ç›¸å½“äºæˆ‘ä»¬åœ¨äº‹ä»¶å“åº”å’Œå‡½æ•°æ‰§è¡Œé—´æ·»åŠ äº†ä¸€ä¸ªæ§åˆ¶å±‚ã€‚æ˜¾ç„¶è¿™æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œ<strong>å› ä¸ºæˆ‘ä»¬æ— æ³•æ§åˆ¶ç”¨æˆ·å¦‚ä½•è¿›è¡Œäº¤äº’ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶å‰ç«¯å¦‚ä½•å“åº”è¿™äº›ç”¨æˆ·çš„äº¤äº’ã€‚</strong></p>
<h3 id="Debounce"><a href="#Debounce" class="headerlink" title="Debounce"></a>Debounce</h3><p>å¯ä»¥ç†è§£æˆæŠŠä¸€äº›è¿ç»­çš„æ“ä½œè§†ä¸ºä¸€ç»„åºåˆ—ï¼Œæœ€ç»ˆæµè§ˆå™¨åªæŠŠè¿™ç»„åºåˆ—è§†ä¸ºä¸€ä¸ªäº‹ä»¶è¿›è¡Œå“åº”ã€‚<br>å¦‚å›¾ï¼Œç¬¬ä¸€æ’ä¸ºç”¨æˆ·çš„æ—¶é—´ï¼Œç¬¬äºŒæ’ä¸ºæµè§ˆå™¨çš„å“åº”<br><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202307042146601.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>â€œå½’ä¸ºä¸€ç»„å“åº”â€çš„ç†è§£ï¼š<br><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202307201031340.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸ºäº†æ–¹ä¾¿ç†è§£<code>debounce()</code>ï¼Œåœ¨è¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼šæƒ³åƒç°åœ¨æœ‰ä¸€ä¸ªç”µæ¢¯ï¼Œå¦‚æœæ£€æµ‹åˆ°å½“å‰æœ‰äººè¿›æ¥å°±å»¶è¿Ÿ5så…³é—¨ã€‚ç°åœ¨ç¬¬ä¸€ä¸ªäººèµ°è¿›ç”µæ¢¯ï¼Œè¿‡äº†3sï¼Œè¿˜å·®2så…³é—¨çš„æ—¶å€™ï¼Œç”µæ¢¯åˆèµ°è¿›æ¥äº†ä¸€ä¸ªäººã€‚é‚£ä¹ˆåœ¨ç¬¬äºŒä¸ªäººèµ°è¿›æ¥ä¹‹åï¼Œç”µæ¢¯ä¼šé‡è®¾è®¡æ—¶å™¨ï¼Œé‡æ–°è®¡æ—¶5så†å…³é—¨ã€‚åŒç†ï¼Œç¬¬ä¸‰ä¸ªäººå¦‚æœåœ¨è¿™5sé—´éš”å†…èµ°è¿›ç”µæ¢¯ï¼Œç”µæ¢¯åˆä¼šé‡æ–°è®¡æ—¶ã€‚</p>
<h4 id="ç¬æ—¶å“åº”orå»¶è¿Ÿå“åº”"><a href="#ç¬æ—¶å“åº”orå»¶è¿Ÿå“åº”" class="headerlink" title="ç¬æ—¶å“åº”orå»¶è¿Ÿå“åº”"></a>ç¬æ—¶å“åº”orå»¶è¿Ÿå“åº”</h4><p>å…¶å®è¿™å¾ˆå®¹æ˜“å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ç°åœ¨æˆ‘ä»¬ä»‹ç»çš„<code>debounce()</code>å‡½æ•°äº‹å®ä¸Šæ˜¯å»¶è¿Ÿå“åº”çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬è¿›è¡Œè¿ç»­çš„äº¤äº’åï¼Œè¦è¿‡ä¸€å®šæ—¶é—´æ‰ä¼šå“åº”æˆ‘ä»¬çš„äº¤äº’äº‹ä»¶ã€‚é‚£å¦‚æœæˆ‘ä»¬è¦è®©å®ƒé©¬ä¸Šå°±å“åº”ä¸€æ¬¡æˆ‘ä»¬çš„äº¤äº’å‘¢ï¼Ÿ<code>debounce()</code>ç»™æˆ‘ä»¬æä¾›äº†å‚æ•°è®©æˆ‘ä»¬æ¥æ§åˆ¶æ˜¯ç¬æ—¶å“åº”è¿˜æ˜¯å»¶è¿Ÿå“åº”ã€‚<br>ä¸‹é¢æ”¾ä¸Šä¸€å¼ ç¬æ—¶å“åº”çš„ç¤ºæ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶è¿˜æ˜¯æŠŠè¿™äº›äº¤äº’å½’ä¸ºäº†ä¸€ç»„ï¼Œåªå“åº”ä¸€æ¬¡ã€‚ä½†<strong>å“åº”çš„æ˜¯ç”¨æˆ·ä¸€å¼€å§‹è§¦å‘äº¤äº’äº‹ä»¶</strong>ï¼š<br><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202307042146305.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="ä¸¾ä¾‹ä¸æ³¨æ„äº‹é¡¹"><a href="#ä¸¾ä¾‹ä¸æ³¨æ„äº‹é¡¹" class="headerlink" title="ä¸¾ä¾‹ä¸æ³¨æ„äº‹é¡¹"></a>ä¸¾ä¾‹ä¸æ³¨æ„äº‹é¡¹</h4><p><code>debounce()</code>å¯ä»¥ç”¨äºç”¨æˆ·è¾“å…¥ï¼Œç”¨æˆ·è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°ç­‰ã€‚</p>
<blockquote>
<p>æ¯”å¦‚åœ¨ç”¨æˆ·æ³¨å†Œç•Œé¢ï¼Œç­‰ç”¨æˆ·åœæ­¢è¾“å…¥é‚®ç®±åï¼Œåˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„å†…å®¹æ˜¯å¦ç¬¦åˆé‚®ç®±æ ¡éªŒè§„åˆ™ã€‚</p>
<p>åœ¨ä½¿ç”¨æ—¶ï¼Œ<strong>æˆ‘ä»¬è¦æ³¨æ„ä¸€ä¸ªåœ°æ–¹</strong>ã€‚å°±æ˜¯<code>debounce()</code>ä¸èƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä¸‹é¢ç»™å‡ºäº†ä¸€ç§æ­£ç¡®ç”¨æ³•ä¸ä¸€ç§é”™è¯¯ç”¨æ³•ï¼Œè¯·è¯»è€…è‡ªè¡Œä½“ä¼šã€‚</p>
<ul>
<li>WRONG<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="variable language_">window</span>).<span class="title function_">on</span>(<span class="string">&#x27;scroll&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">   _.<span class="title function_">debounce</span>(doSomething, <span class="number">300</span>); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li>RIGHT<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="variable language_">window</span>).<span class="title function_">on</span>(<span class="string">&#x27;scroll&#x27;</span>, _.<span class="title function_">debounce</span>(doSomething, <span class="number">200</span>));</span><br></pre></td></tr></table></figure>
<h3 id="Throttle"><a href="#Throttle" class="headerlink" title="Throttle"></a>Throttle</h3><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4>è¿™å‰é¢ç®€å•ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°ã€‚å®ƒçš„<strong>å®šä¹‰</strong>æ˜¯:<br>ä¸å…è®¸æŸä¸ªå‡½æ•°åœ¨{delay}é•¿åº¦çš„æ—¶é—´é—´éš”å†…æ‰§è¡Œè¶…è¿‡ä¸€æ¬¡</li>
</ul>
<h4 id="ç”¨æ³•ä¸¾ä¾‹"><a href="#ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="ç”¨æ³•ä¸¾ä¾‹"></a>ç”¨æ³•ä¸¾ä¾‹</h4><p>å®ƒçš„ç”¨æ³•ä¸<code>debounce()</code>ç›¸ä¼¼,ä»¥lodash.jsä¸ºä¾‹ï¼š<br><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">_.<span class="title function_">throttle</span>(dosomething, <span class="number">16</span>)</span><br></pre></td></tr></table></figure><br>ä¸»è¦ç”¨åœ¨æ£€æµ‹ç”¨æˆ·ç•Œé¢æ˜¯å¦å·²ç»é è¿‘åº•éƒ¨äº†ï¼Œå¦‚æœé è¿‘åº•éƒ¨å°±éœ€è¦è¯·æ±‚æ–°çš„å†…å®¹ä¾›ç”¨æˆ·æŸ¥é˜…ã€‚</p>
</blockquote>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p><a href="https://css-tricks.com/debouncing-throttling-explained-examples/#top-of-site">Debouncing and Throttling Explained Through Examples</a></p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”±â€œobject is not extensibleâ€æŠ¥é”™å¼•å‘çš„æ€è€ƒåŠè§£å†³æ–¹æ¡ˆ@React-Toolkit/@Immer.js</title>
    <url>/2022/11/13/3e5d23898d6d/</url>
    <content><![CDATA[<h2 id="é—®é¢˜é‡è¿°"><a href="#é—®é¢˜é‡è¿°" class="headerlink" title="é—®é¢˜é‡è¿°"></a>é—®é¢˜é‡è¿°</h2><p>â€‹    æœ€è¿‘åœ¨åšä¸€ä¸ªæ•°æ®æµè§ˆå¹³å°ï¼Œå¦‚å›¾æ‰€ç¤º</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181518651.png" alt="æ•°æ®æµè§ˆå¹³å°"></p>
<p>â€‹    å¤§è‡´çš„ç¼–ç é€»è¾‘æ˜¯å·¦ä¸Šè§’çš„æ•°æ®é›†é€‰æ‹©å™¨ï¼Œæ§åˆ¶å…¨å±€UIçš„æ”¹å˜ã€‚æ¯”å¦‚<strong>å·¦éƒ¨çš„æ ‘å½¢æ§ä»¶æ•°æ®</strong>ï¼Œ<strong>ç”»å¸ƒä¸­çš„èŠ‚ç‚¹é“¾æ¥å›¾</strong>ç­‰ç­‰ï¼Œéƒ½æ˜¯æ ¹æ®å½“å‰æ‰€é€‰çš„æ•°æ®é›†æ¥å®šçš„ã€‚è¿™ç§ç»„ä»¶é—´çš„çŠ¶æ€å¤ç”¨ï¼Œè‡ªç„¶è€Œç„¶å°±æƒ³åˆ°æŠŠæ•°æ®é›†ä½œä¸ºä¸€ä¸ªçŠ¶æ€æ¥äº¤ç»™reduxç®¡ç†ã€‚</p>
<h3 id="ä½¿ç”¨redux-toolkit"><a href="#ä½¿ç”¨redux-toolkit" class="headerlink" title="ä½¿ç”¨redux-toolkit"></a>ä½¿ç”¨redux-toolkit</h3><p>â€‹    å¥½çš„ï¼Œç°åœ¨å¼€å§‹æŸ¥reduxå®˜æ–¹æ–‡æ¡£ã€‚å› ä¸ºåˆšå­¦ä¼šreactï¼Œæ•™ç¨‹ä¸­reduxçš„storeä¸­ä½¿ç”¨çš„æ˜¯<code>createStore()</code>åˆ›å»ºçš„ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ç›®å‰å·²ç»å¼ƒç”¨äº†ï¼Œå®˜æ–¹å»ºè®®ä½¿ç”¨çš„æ˜¯<code>configureStore()</code>ã€‚ç»è¿‡ä¸€ç•ªæ–‡æ¡£çš„æŸ¥é˜…ï¼Œå¼€å§‹ä½¿ç”¨<code>createSlice()</code>æ¥é‡å†™reducerã€‚</p>
<h4 id="ä½¿ç”¨createSlice"><a href="#ä½¿ç”¨createSlice" class="headerlink" title="ä½¿ç”¨createSlice()"></a>ä½¿ç”¨<code>createSlice()</code></h4><p>â€‹    è¿™é‡Œç›´æ¥è´´ä¸Šæˆ‘è¿™éƒ¨åˆ†sliceçš„<strong>é”™è¯¯ä»£ç </strong></p>
<ul>
<li><strong>åˆ›å»ºslice</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  redux/optionSlice.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; dataSets &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/getData&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">HIGHLIGHT</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constant&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> optionSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;option&#x27;</span>,</span><br><span class="line">    <span class="attr">initialState</span>: &#123;</span><br><span class="line">        <span class="attr">data</span>: dataSets[<span class="string">&quot;case1&quot;</span>],</span><br><span class="line">        <span class="attr">mode</span>: <span class="variable constant_">HIGHLIGHT</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">reducers</span>: &#123;</span><br><span class="line">      	<span class="comment">//è¿™é‡Œå¯¹äºstateçš„è§£é‡Šåœ¨ä¸‹æ–‡</span></span><br><span class="line">        <span class="attr">changedata</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">data</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">changemode</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">mode</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; changedata, changemode &#125; = optionSlice.<span class="property">actions</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> optionSlice.<span class="property">reducer</span></span><br></pre></td></tr></table></figure>
<p><code>slice</code>æœ‰ä¸¤ä¸ªå¯¼å‡ºï¼Œä¸€ä¸ªæ˜¯åœ¨å†…éƒ¨è´Ÿè´£æ“ä½œçŠ¶æ€çš„actionï¼›ä¸€ä¸ªæ˜¯reducer</p>
<p>æˆ‘è¿˜æœ‰ä¸€å¦å¤–ä¸€ä¸ª<code>selectionSlice</code>è´Ÿè´£ç®¡ç†å…¶ä»–çš„çŠ¶æ€ï¼Œè¿™é‡Œè€ƒè™‘åˆ°ç¯‡å¹…å°±ä¸ç»™å‡ºäº†ã€‚</p>
<h4 id="åœ¨index-jsä¸­èåˆä¸¤ä¸ªsilce"><a href="#åœ¨index-jsä¸­èåˆä¸¤ä¸ªsilce" class="headerlink" title="åœ¨index.jsä¸­èåˆä¸¤ä¸ªsilce"></a>åœ¨<code>index.js</code>ä¸­èåˆä¸¤ä¸ªsilce</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//   redux/index.js</span></span><br><span class="line"><span class="keyword">import</span> optionReducer <span class="keyword">from</span> <span class="string">&#x27;./optionSlice&#x27;</span>;   <span class="comment">//æ³¨æ„ï¼Œè¿™é‡Œå¼•å…¥çš„æ˜¯sliceä¸­å¯¼å‡ºçš„reducerï¼Œsliceæœ‰ä¸¤ä¸ªå¯¼å‡ºï¼šreducerå’Œaction</span></span><br><span class="line"><span class="keyword">import</span> selectionReducer <span class="keyword">from</span> <span class="string">&quot;./selectionSlice&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reducers = &#123;</span><br><span class="line">    <span class="attr">option</span>: optionReducer,</span><br><span class="line">    <span class="attr">selection</span>: selectionReducer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="åœ¨store-jsé…ç½®storeï¼Œå¹¶ä½¿ç”¨-lt-Provider-store-store-gt-è®©æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨reduxä¸­ç®¡ç†çš„çŠ¶æ€"><a href="#åœ¨store-jsé…ç½®storeï¼Œå¹¶ä½¿ç”¨-lt-Provider-store-store-gt-è®©æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨reduxä¸­ç®¡ç†çš„çŠ¶æ€" class="headerlink" title="åœ¨store.jsé…ç½®storeï¼Œå¹¶ä½¿ç”¨&lt;Provider store={store}&gt;è®©æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨reduxä¸­ç®¡ç†çš„çŠ¶æ€"></a>åœ¨store.jsé…ç½®storeï¼Œå¹¶ä½¿ç”¨<code>&lt;Provider store=&#123;store&#125;&gt;</code>è®©æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨reduxä¸­ç®¡ç†çš„çŠ¶æ€</h4><ul>
<li>é…ç½®<code>store</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// redux/store.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; reducers &#125; <span class="keyword">from</span> <span class="string">&#x27;./index&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">reducer</span>: reducers,<span class="comment">//è¿™é‡Œå†…ç½®äº†combineReducer</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul>
<li>æ·»åŠ <code>Provider</code></li>
</ul>
<p>â€‹    åœ¨Appæ ‡ç­¾å¤–éƒ¨å¥—ä¸Š<code>&lt;Provider&gt;</code>æ ‡ç­¾</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRoot &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; store &#125; <span class="keyword">from</span> <span class="string">&#x27;./redux/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)).<span class="title function_">render</span>(</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="ç»˜åˆ¶èŠ‚ç‚¹é“¾æ¥å›¾"><a href="#ç»˜åˆ¶èŠ‚ç‚¹é“¾æ¥å›¾" class="headerlink" title="ç»˜åˆ¶èŠ‚ç‚¹é“¾æ¥å›¾"></a>ç»˜åˆ¶èŠ‚ç‚¹é“¾æ¥å›¾</h3><p>â€‹    ç”¨æˆ·é€‰æ‹©ä¸€ä»½æ•°æ®é›†ï¼Œå°±ä¼šæŠŠè¿™ä»½æ•°æ®é›†äº¤ç»™reduxç®¡ç†ï¼Œåœ¨å…¶ä»–ç»„ä»¶ä¸­å¦‚æœæƒ³è¦å–ç”¨æ•°æ®é›†ï¼Œä½¿ç”¨<code>useSelector(state =&gt; state.option.data)</code>å³å¯å–ç”¨ã€‚<strong><font color="red">é—®é¢˜å°±å‘ç”Ÿåœ¨è¿™ä¸€æ­¥</font></strong></p>
<p>â€‹    æˆ‘å…ˆç®€è¿°ä¸€ä¸‹æˆ‘çš„ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// componnets/Canvas/index.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Canvas</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">useSelector</span>(<span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">option</span>.<span class="property">data</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">initCanvas</span>()  <span class="comment">//drawLayout</span></span><br><span class="line">  &#125;,[data])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">initCanvas</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// .....append canvas</span></span><br><span class="line">    <span class="keyword">const</span> nodes = data.<span class="property">nodes</span></span><br><span class="line">    <span class="keyword">const</span> links = data.<span class="property">links</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//append circle,line......</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> simulation = d3.<span class="title function_">forceSimulation</span>(nodes)</span><br><span class="line">            .<span class="title function_">force</span>(<span class="string">&quot;link&quot;</span>, d3.<span class="title function_">forceLink</span>(links).<span class="title function_">id</span>(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">mgmt_ip</span></span><br><span class="line">            &#125;).<span class="title function_">strength</span>(<span class="number">0.5</span>).<span class="title function_">distance</span>(<span class="number">10</span>))</span><br><span class="line">            <span class="comment">//......some force option</span></span><br><span class="line">    				.<span class="title function_">on</span>(<span class="string">&quot;tick&quot;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">              <span class="comment">//refresh canvas</span></span><br><span class="line">            &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">  	<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;container&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹    è¿™ä¸ªä»£ç å¾ˆç®€å•ï¼Œæˆ‘åœ¨<code>useLayoutEffect()</code>è¿™ä¸ªé’©å­é‡Œç¼–å†™äº†ä¸€ä¸ªç”»å¸ƒåˆå§‹åŒ–å‡½æ•°<code>initCanvas()</code>ã€‚ç›®çš„æ˜¯è®©ç»„ä»¶æŒ‚è½½å‰ï¼Œå…ˆåœ¨ä¸€ä¸ª<code>&lt;div&gt;</code>ä¸­æ·»åŠ ä¸€ä¸ªcanvasï¼Œå¹¶ç»˜åˆ¶å‡ºæ•°æ®ã€‚</p>
<h3 id="æŠ¥é”™é‡ç°"><a href="#æŠ¥é”™é‡ç°" class="headerlink" title="æŠ¥é”™é‡ç°"></a>æŠ¥é”™é‡ç°</h3><p>â€‹    <strong><font color="maroon">ç»“æœè¿™ä¸ªä»£ç ç›´æ¥æŠ¥çº¢äº†ï¼ŒæŠ¥äº†ä¸€ä¸ªæˆ‘ä»æ²¡è§è¿‡çš„é”™è¯¯:   â€œUncaught TypeError:Cannot add property vx,object is extensibleâ€</font></strong></p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181519528.png" alt=""></p>
<p>â€‹    ä»è¿™ä¸ªæŠ¥é”™ä¿¡æ¯å¾ˆå®¹æ˜“å°±èƒ½çŸ¥é“ï¼Œæ˜¯åœ¨æˆ‘è®¾ç½®åŠ›æ¨¡æ‹Ÿå™¨æ—¶ï¼Œè°ƒç”¨<code>d3.forceLink(links)</code>ç»‘å®šè¿è¾¹ï¼Œå’Œç»‘å®šèŠ‚ç‚¹æ—¶ï¼Œæ— æ³•åƒè¾¹æ•°æ®å’Œç‚¹æ•°æ®ä¸­æ·»åŠ vxï¼Œvyç­‰å±æ€§å¯¼è‡´çš„ã€‚</p>
<p>â€‹    ä¸ºäº†è¿›ä¸€æ­¥éªŒè¯è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ç”¨ä»¥ä¸‹ä»£ç éªŒè¯äº†æˆ‘æ‹¿åˆ°çš„æ•°æ®æ˜¯å¦çœŸçš„ä¸å¯æ‹“å±•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> nodes = data.<span class="property">nodes</span></span><br><span class="line"><span class="keyword">const</span> links = data.<span class="property">links</span></span><br><span class="line">nodes.<span class="title function_">forEach</span>(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(node.<span class="title function_">isExtensible</span>())</span><br><span class="line">&#125;)</span><br><span class="line">links.<span class="title function_">forEach</span>(<span class="function"><span class="params">link</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(link.<span class="title function_">isExtensible</span>())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>â€‹    æ¯«æ— æ„å¤–ï¼Œæ§åˆ¶å°è¾“å‡ºäº†æ¸…ä¸€è‰²çš„<code>false</code>ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼è§£å†³ï¼ˆç¬¨æ–¹æ³•ï¼‰"><a href="#é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼è§£å†³ï¼ˆç¬¨æ–¹æ³•ï¼‰" class="headerlink" title="é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼è§£å†³ï¼ˆç¬¨æ–¹æ³•ï¼‰"></a>é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼è§£å†³ï¼ˆç¬¨æ–¹æ³•ï¼‰</h3><p>â€‹    æ‰€ä»¥è¿™ä¸ªé—®é¢˜å¯ä»¥åŸºæœ¬ç¡®å®šæ˜¯å› ä¸ºæˆ‘çš„æ•°æ®ä¸å¯æ‹“å±•é€ æˆçš„ï¼Œè™½ç„¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ä½†æ˜¯è§£å†³è¿™ä¸ªçš„åŠæ³•æ— éå°±æ˜¯è®©æˆ‘çš„æ•°æ®èƒ½å¤Ÿè¢«æ‹“å±•ã€‚ä½†æ˜¯æœäº†åŠå¤©è§£é™¤ä¸å¯æ‹“å±•æ€§çš„åŠæ³•ï¼Œæ‰¾ä¸åˆ°ã€‚äºæ˜¯åªèƒ½é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼ï¼Œæ‹·è´ä¸€ä»½æ–°çš„å¯¹è±¡ã€‚</p>
<p>â€‹    æ‹·è´åˆ†ä¸¤ç§æ–¹å¼ï¼šæµ…æ‹·è´ä¸æ·±æ‹·è´ã€‚åœ¨æœ‰æŒ‡é’ˆçš„æƒ…å†µä¸‹ï¼Œ<strong>æµ…æ‹·è´åªæ˜¯å¢åŠ äº†ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å·²ç»å­˜åœ¨çš„å†…å­˜</strong>ï¼Œè€Œæ·±æ‹·è´å°±æ˜¯<strong>å¢åŠ ä¸€ä¸ªæŒ‡é’ˆå¹¶ä¸”ç”³è¯·ä¸€ä¸ªæ–°çš„å†…å­˜</strong>ï¼Œ<strong>ä½¿è¿™ä¸ªå¢åŠ çš„æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªæ–°çš„å†…å­˜</strong>ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ·±æ‹·è´ï¼Œç”³è¯·ä¸€ä¸ªæ–°çš„å†…å­˜å­˜æ”¾æ‹·è´çš„å¯¹è±¡ã€‚</p>
<p>â€‹    <code>nodes</code>ä¸<code>links</code>æ•°ç»„ä¸­å­˜æ”¾çš„objå¦‚å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  nodes<span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line"> 	 	id<span class="punctuation">:</span>xxxx<span class="punctuation">,</span></span><br><span class="line">    role<span class="punctuation">:</span>xxxx<span class="punctuation">,</span></span><br><span class="line">    type<span class="punctuation">:</span>xxxx</span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	links<span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line"> 	 	source<span class="punctuation">:</span>xxxx<span class="punctuation">,</span></span><br><span class="line">    target<span class="punctuation">:</span>xxxx<span class="punctuation">,</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>â€‹    å› æ­¤æˆ‘ä»¬ä½¿ç”¨å¯¹è±¡æ‹“å±•ç¬¦<code>&#123;...node&#125;,&#123;...link&#125;</code>å³å¯å®Œæˆæ·±æ‹·è´ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> newNode = nodes.<span class="title function_">map</span>(<span class="function"><span class="params">node</span> =&gt;</span> (&#123;...node&#125;));</span><br><span class="line"><span class="keyword">const</span> newLink = links.<span class="title function_">map</span>(<span class="function"><span class="params">link</span> =&gt;</span> (&#123;...link&#125;))</span><br></pre></td></tr></table></figure>
<p>â€‹    æ¥ç€æˆ‘ä»¬ä½¿ç”¨newNodeå’ŒnewLinkæ›¿æ¢åŸæ¥çš„nodeså’Œlinksï¼Œå°±OKäº†ã€‚</p>
<h3 id="æŠŠreduxä¸­å­˜å‚¨çš„æ•°æ®å¯¹è±¡æ›¿æ¢ä¸ºæ•°æ®å"><a href="#æŠŠreduxä¸­å­˜å‚¨çš„æ•°æ®å¯¹è±¡æ›¿æ¢ä¸ºæ•°æ®å" class="headerlink" title="æŠŠreduxä¸­å­˜å‚¨çš„æ•°æ®å¯¹è±¡æ›¿æ¢ä¸ºæ•°æ®å"></a>æŠŠreduxä¸­å­˜å‚¨çš„æ•°æ®å¯¹è±¡æ›¿æ¢ä¸ºæ•°æ®å</h3><p>â€‹    ä¸Šé¢çš„åŠæ³•æ˜¾ç„¶å¾ˆè ¢Â·Â·Â·Â·Â·Â·ã€‚<strong>æˆ‘æ…¢æ…¢å¼€å§‹æ„è¯†åˆ°è¿™ä¸ªå¯¹è±¡çš„ä¸å¯æ‹“å±•æ€§å¾ˆå¯èƒ½æ˜¯reduxå¸®æˆ‘å¤„ç†çš„</strong>ï¼Œå› ä¸º<strong>æˆ‘ä»¬åœ¨reduxä¸­å­˜æ”¾çš„æ•°æ®åº”è¯¥ç”±å¯¹åº”çš„reduceræ¥è¿›è¡Œæ›´æ”¹</strong>ï¼Œå¦‚æœå¤–éƒ¨èƒ½å¤Ÿæ›´æ”¹ä¼šå¯¼è‡´UIç»„ä»¶ä¸­è·å–çš„çŠ¶æ€å‡ºç°é”™è¯¯ã€‚</p>
<p>â€‹    å› ä¸ºå‘ç°è¿™ä¸ªé—®é¢˜å·²ç»å¾ˆæ™šäº†ï¼Œæˆ‘æ²¡æœ‰æ€¥ç€å»éªŒè¯çš„æƒ³æ³•æ˜¯ä¸æ˜¯å¯¹çš„ï¼Œå› ä¸ºæˆ‘æƒ³èµ¶ç´§æŠŠæˆ‘çš„è ¢æ–¹æ³•æ¢æ‰ï¼Œè®©æˆ‘çš„ç¨‹åºçœ‹èµ·æ¥åˆ«é‚£ä¹ˆçƒ‚ã€‚æˆ‘ä¹‹å‰å»ºç«‹äº†ä¸€ä¸ªå‡½æ•°å¸®æˆ‘æä¾›æ•°æ®é›†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> case1 <span class="keyword">from</span> <span class="string">&quot;../assets/case1.json&quot;</span></span><br><span class="line"><span class="keyword">import</span> case2 <span class="keyword">from</span> <span class="string">&quot;../assets/case2.json&quot;</span></span><br><span class="line"><span class="keyword">import</span> case3 <span class="keyword">from</span> <span class="string">&quot;../assets/case3.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">generate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> datasets = &#123;</span><br><span class="line">        case1,</span><br><span class="line">        case2,</span><br><span class="line">        case3</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> datasets;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> dataSets = <span class="title function_">generate</span>();</span><br></pre></td></tr></table></figure>
<p>â€‹    è¿™ä¹ˆåšçš„ç›®çš„æ˜¯æˆ‘åœ¨ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨<code>import &#123;dataSets&#125; from &quot;../util/getData.js&quot;</code>å°±èƒ½è·å–åˆ°å…¨éƒ¨æ•°æ®é›†äº†ã€‚</p>
<p>â€‹    å†™åˆ°è¿™ï¼Œåº”è¯¥å¾ˆæ˜ç™½äº†ã€‚æ­£ç¡®çš„æ€è·¯åº”è¯¥æ˜¯å°†æ•°æ®é›†çš„åå­—ï¼Œå¦‚case1ï¼Œcase2ï¼Œcase3â€¦â€¦äº¤ç»™reduxæ¥ç®¡ç†ï¼Œç”¨æˆ·æ¯æ¬¡åˆ‡æ¢æ•°æ®é›†ï¼Œå°±é€šçŸ¥reduceræ›´æ”¹å½“å‰çš„æ•°æ®é›†åç§°ã€‚åœ¨ç»„ä»¶ä¸­å¦‚æœæƒ³è¦ä½¿ç”¨æ•°æ®çš„è¯å°±ä»¥ä¸‹ä»£ç æ¥è·å–ã€‚è¿™ä¹ˆåšæ˜¾ç„¶æ¯”æŠŠæ•´ä»½æ•°æ®äº¤ç»™reduxç®¡ç†æ›´åŠ åˆç†ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;dataSets&#125; <span class="keyword">from</span> <span class="string">&quot;../util/getData.js</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function Component()&#123;</span></span><br><span class="line"><span class="string">  const dataName = useSelector(state =&gt; state.option.dataName)</span></span><br><span class="line"><span class="string">  const data = dataSets[dataName]</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  //func body</span></span><br><span class="line"><span class="string">  return ....</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè´´ä¸Šä¸€ä¸ªæ­£ç¡®ä»£ç ï¼Œå’Œä¹‹å‰ç›¸æ¯”ï¼Œæˆ‘æŠŠäº¤ç»™reduxç®¡ç†çš„çŠ¶æ€ä»<code>data</code>æ¢æˆäº†<code>dataName</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// redux/optionSlice.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">HIGHLIGHT</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constant&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**data option */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> optionSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;option&#x27;</span>,</span><br><span class="line">    <span class="attr">initialState</span>: &#123;</span><br><span class="line">        <span class="attr">dataName</span>: <span class="string">&quot;case1&quot;</span>,</span><br><span class="line">        <span class="attr">mode</span>: <span class="variable constant_">HIGHLIGHT</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">reducers</span>: &#123;</span><br><span class="line">        <span class="attr">changedata</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">dataName</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">changemode</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">mode</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; changedata, changemode &#125; = optionSlice.<span class="property">actions</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> optionSlice.<span class="property">reducer</span></span><br></pre></td></tr></table></figure>
<p>â€‹    å…¶å®å·²ç»å‘ç°åŒºåˆ«äº†ï¼Œåœ¨ä¿®æ”¹ä¹‹å‰ï¼Œæˆ‘æŠŠæ•´ä¸ªæ•°æ®é›†<code>data = &#123;nodes:[...],links:[...]&#125;</code>ä½œä¸ºäº†æ•´ä¸ªçŠ¶æ€å­˜æ”¾åˆ°äº†reduxä¸­ã€‚è€Œä¿®æ”¹ä¹‹åï¼Œæˆ‘åªå­˜äº†<strong>æ•°æ®é›†çš„åç§°</strong>ï¼Œä½¿ç”¨çš„æ—¶å€™ç”¨è¿™ä¸ª<strong>åç§°</strong>å»ä¸€ä¸ªå­˜æ”¾äº†æ‰€æœ‰dataSetsçš„åœ°æ–¹å–ã€‚è¿™æ˜¾ç„¶æ˜¯ä¸€ç§æ›´åŠ åˆç†çš„ç¼–ç æ–¹å¼ã€‚</p>
<h2 id="äº§ç”ŸåŸå› åˆ†æ"><a href="#äº§ç”ŸåŸå› åˆ†æ" class="headerlink" title="äº§ç”ŸåŸå› åˆ†æ"></a>äº§ç”ŸåŸå› åˆ†æ</h2><h4 id="immer-js-gt-ä¸å¯å˜æ•°æ®ç»“æ„"><a href="#immer-js-gt-ä¸å¯å˜æ•°æ®ç»“æ„" class="headerlink" title="immer.js =&gt; ä¸å¯å˜æ•°æ®ç»“æ„"></a>immer.js =&gt; ä¸å¯å˜æ•°æ®ç»“æ„</h4><p>â€‹    åŸºæœ¬èƒ½å¤Ÿåˆæ­¥ç¡®å®šredux-toolkitåœ¨è¿”å›æ–°çŠ¶æ€å€¼çš„æ—¶å€™ï¼Œè®¾ç½®äº†è¿”å›çš„objæ˜¯ä¸å¯æ‰©å±•çš„ã€‚ä¸ºäº†éªŒè¯æˆ‘çš„çŒœæƒ³ï¼Œæˆ‘å»redux-toolkitå®˜ç½‘æ‰¾åˆ°äº†ä¸‹é¢è¿™ç¯‡<code>Writing Reducers with Immer</code></p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181519759.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>â€‹    Immerï¼ŒImmeræ˜¯ä»€ä¹ˆï¼Ÿè¯»è¿™ç¯‡æ–‡ç« ç¬¬ä¸€å¥è¯</p>
<blockquote>
<p>Redux Toolkitâ€™s <a href="https://redux-toolkit.js.org/api/createReducer"><code>createReducer</code></a> and <a href="https://redux-toolkit.js.org/api/createSlice"><code>createSlice</code></a> automatically use [Immer]<br>(<a href="https://immerjs.github.io/immer/">https://immerjs.github.io/immer/</a>) internally to let you write simpler immutable update logic using â€œmutatingâ€ syntax. This helps simplify most reducer implementations.</p>
<p>è¯‘æ–‡ï¼šRedux Toolkit<a href="https://redux-toolkit.js.org/api/createReducer"><code>createReducer</code></a>å¹¶åœ¨å†…éƒ¨<a href="https://redux-toolkit.js.org/api/createSlice"><code>createSlice</code></a>è‡ªåŠ¨ä½¿ç”¨<a href="https://immerjs.github.io/immer/">Immer</a>è®©æ‚¨ä½¿ç”¨â€œmutatingâ€è¯­æ³•ç¼–å†™æ›´ç®€å•çš„ä¸å¯å˜çš„æ›´æ–°é€»è¾‘ã€‚è¿™æœ‰åŠ©äºç®€åŒ–å¤§å¤šæ•° reducer å®ç°ã€‚</p>
</blockquote>
<p>â€‹    <code>immutable update logic</code>ä¸å¯å˜çš„æ›´æ–°é€»è¾‘ï¼Œæˆ‘æƒ³æˆ‘æ‰¾åˆ°ç­”æ¡ˆäº†ã€‚äºæ˜¯æˆ‘å»googleäº†<code>immer.js</code>ï¼Œ</p>
<p>â€‹    åœ¨å®ƒçš„ä¸­æ–‡å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæœ‰ä¸€æ®µè¿™ä¹ˆä»‹ç»çš„è¯ï¼š</p>
<blockquote>
<p>Immer can be used in any context in which immutable data structures need to be used. For example in combination with React state, React or Redux reducers, or configuration management. Immutable data structures allow for (efficient) change detection: if the reference to an object didnâ€™t change, the object itself did not change. In addition, it makes cloning relatively cheap: Unchanged parts of a data tree donâ€™t need to be copied and are shared in memory with older versions of the same state.</p>
<p>è¯‘æ–‡ï¼š<strong>Immer å¯ä»¥åœ¨éœ€è¦ä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„çš„ä»»ä½•ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨</strong>ã€‚ä¾‹å¦‚ä¸ React stateã€React æˆ– <strong>Redux reducers</strong> æˆ–è€… configuration management ç»“åˆä½¿ç”¨ã€‚<strong>ä¸å¯å˜çš„æ•°æ®ç»“æ„å…è®¸ï¼ˆé«˜æ•ˆï¼‰çš„å˜åŒ–æ£€æµ‹</strong>ï¼šå¦‚æœå¯¹å¯¹è±¡çš„å¼•ç”¨æ²¡æœ‰æ”¹å˜ï¼Œé‚£ä¹ˆå¯¹è±¡æœ¬èº«ä¹Ÿæ²¡æœ‰æ”¹å˜ã€‚æ­¤å¤–ï¼Œå®ƒ<strong>ä½¿å…‹éš†å¯¹è±¡ç›¸å¯¹ä¾¿å®œ</strong>ï¼š<strong>æ•°æ®æ ‘çš„æœªæ›´æ”¹éƒ¨åˆ†ä¸éœ€è¦å¤åˆ¶ï¼Œå¹¶ä¸”åœ¨å†…å­˜ä¸­ä¸ç›¸åŒçŠ¶æ€çš„æ—§ç‰ˆæœ¬å…±äº«</strong></p>
</blockquote>
<p>â€‹    çœ‹å®Œè¿™ä¸¤æ®µè¯ï¼Œæ¯”è¾ƒæŠ½è±¡ï¼Œç›´æ¥çœ‹å®˜æ–¹ç»™çš„ä»£ç ç¤ºä¾‹ï¼š</p>
<ul>
<li><strong>æœ‰ä¸€ä¸ªTodoåˆ—è¡¨ï¼Œæˆ‘ä»¬è¦å¯¹å®ƒè¿›è¡Œæ›´æ–°</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> baseState = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;Learn TypeScript&quot;</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;Try Immer&quot;</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸ä½¿ç”¨Immer</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸ä½¿ç”¨immer</span></span><br><span class="line"><span class="keyword">const</span> nextState = baseState.<span class="title function_">slice</span>() <span class="comment">// æµ…æ‹·è´æ•°ç»„</span></span><br><span class="line">nextState[<span class="number">1</span>] = &#123;</span><br><span class="line">    <span class="comment">// æ›¿æ¢ç¬¬ä¸€å±‚å…ƒç´ </span></span><br><span class="line">    ...nextState[<span class="number">1</span>], <span class="comment">// æµ…æ‹·è´ç¬¬ä¸€å±‚å…ƒç´ </span></span><br><span class="line">    <span class="attr">done</span>: <span class="literal">true</span> <span class="comment">// æœŸæœ›çš„æ›´æ–°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å› ä¸º nextState æ˜¯æ–°æ‹·è´çš„, æ‰€ä»¥ä½¿ç”¨ push æ–¹æ³•æ˜¯å®‰å…¨çš„,</span></span><br><span class="line"><span class="comment">// ä½†æ˜¯åœ¨æœªæ¥çš„ä»»æ„æ—¶é—´åšç›¸åŒçš„äº‹æƒ…ä¼šè¿åä¸å˜æ€§åŸåˆ™å¹¶ä¸”å¯¼è‡´ bugï¼</span></span><br><span class="line">nextState.<span class="title function_">push</span>(&#123;<span class="attr">title</span>: <span class="string">&quot;Tweet about it&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨Immer</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> produce <span class="keyword">from</span> <span class="string">&quot;immer&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nextState = <span class="title function_">produce</span>(baseState, <span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">    draft[<span class="number">1</span>].<span class="property">done</span> = <span class="literal">true</span></span><br><span class="line">    draft.<span class="title function_">push</span>(&#123;<span class="attr">title</span>: <span class="string">&quot;Tweet about it&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>â€‹    ä»ä¸Šå¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨Immerä¼šæŠŠæ›´æ”¹åº”ç”¨å½“å‰çš„è‰ç¨¿<code>draft</code>ä¸Šï¼Œå®ƒæ˜¯å½“å‰çŠ¶æ€çš„ä»£ç†ï¼Œä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†æ‰€æœ‰çš„æ›´æ”¹ï¼ŒImmerä¼šæ ¹æ®<code>draft</code>ä¸Š<code>state</code>çš„æ›´æ”¹ç”Ÿæˆæ–°çš„<code>nextState</code>,å·¥ä½œåŸç†ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181519683.png" alt=""></p>
<p>â€‹    å¼•ç”¨å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¸€æ®µè¯ï¼Œæ¥è§£é‡ŠImmerçš„ä½œç”¨</p>
<blockquote>
<p>Using Immer is like having a personal assistant. The assistant takes a letter (the current state) and gives you a copy (draft) to jot changes onto. Once you are done, the assistant will take your draft and produce the real immutable, final letter for you (the next state).</p>
<p>ä½¿ç”¨ Immer å°±åƒæ‹¥æœ‰ä¸€ä¸ªç§äººåŠ©ç†ã€‚åŠ©æ‰‹æ‹¿ä¸€å°ä¿¡ï¼ˆå½“å‰çŠ¶æ€ï¼‰å¹¶ç»™æ‚¨ä¸€ä»½å‰¯æœ¬ï¼ˆè‰ç¨¿ï¼‰ä»¥è®°å½•æ›´æ”¹ã€‚å®Œæˆåï¼ŒåŠ©æ‰‹å°†æ¥å—æ‚¨çš„è‰ç¨¿å¹¶ä¸ºæ‚¨ç”ŸæˆçœŸæ­£ä¸å˜çš„æœ€ç»ˆä¿¡ä»¶ï¼ˆä¸‹ä¸€ä¸ªçŠ¶æ€ï¼‰ã€‚</p>
</blockquote>
<p>â€‹    è¿™ä¸ªâ€œç§äººåŠ©ç†â€å…¶å®æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡Proxyï¼Œæˆ‘åœ¨reduxä¸­ä¹Ÿåšäº†è¿›ä¸€æ­¥çš„éªŒè¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// /redux/optionSlice.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line">        <span class="attr">changedata</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(state)</span><br><span class="line">            state.<span class="property">dataName</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">changemode</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">mode</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>â€‹    æˆ‘åœ¨ä»£ç ä¸­æ‰“å°äº†stateï¼Œå¹¶åœ¨æ§åˆ¶å°æŸ¥çœ‹äº†å®ƒçš„è¾“å‡ºï¼Œç¡®å®æ˜¯ä¸€ä¸ªProxyå¯¹è±¡ã€‚</p>
<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181520917.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="Redux-toolkitä¸­createSlice-çš„ä½¿ç”¨"><a href="#Redux-toolkitä¸­createSlice-çš„ä½¿ç”¨" class="headerlink" title="Redux-toolkitä¸­createSlice()çš„ä½¿ç”¨"></a>Redux-toolkitä¸­<code>createSlice()</code>çš„ä½¿ç”¨</h3><p>åœ¨æµ…äº†è§£äº†Immer.jsåï¼Œæˆ‘å›åˆ°å®˜æ–¹æ–‡æ¡£ä¸­é˜…è¯»å‰©ä½™éƒ¨åˆ†ã€‚å¹¶æ•´ç†äº†ä»¥ä¸‹å¯¹æˆ‘å¯èƒ½æœ‰å¸®åŠ©çš„ç‚¹ </p>
<h4 id="çŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œä¸ºä»€ä¹ˆä¼šå¼•å…¥Immer-js"><a href="#çŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œä¸ºä»€ä¹ˆä¼šå¼•å…¥Immer-js" class="headerlink" title="çŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œä¸ºä»€ä¹ˆä¼šå¼•å…¥Immer.js"></a>çŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œä¸ºä»€ä¹ˆä¼šå¼•å…¥Immer.js</h4><p>â€‹    è¦åˆ†æçŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œé¦–å…ˆæˆ‘ä»¬è¦å¼•å…¥çš„ä¸€ä¸ªé—®é¢˜æ˜¯Reduxä¸­ä¸å¯æ”¹å˜çŠ¶æ€çš„å‡ ä¸ªåŸå› ã€‚å®˜æ–¹æ–‡æ¡£ä¸­åˆ—å‡ºäº†äº”æ¡åŸå› ï¼Œä½†æˆ‘è®¤ä¸ºæœ€é‡è¦çš„æ˜¯ç¬¬ä¸€æ¡ï¼š<strong>ä¼šå¯¼è‡´bugï¼Œä¾‹å¦‚UIæ— æ³•æ­£ç¡®æ›´æ–°æ˜¾ç¤ºæœ€æ–°å€¼</strong>ã€‚</p>
<p>â€‹    é‚£ä¹ˆreduxä¸èƒ½æ›´æ”¹åŸå§‹çŠ¶æ€ï¼Œæˆ‘ä»¬å¦‚ä½•è¿”å›æ›´æ–°åçš„çŠ¶æ€å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åœ¨Reducerä¸­åªèƒ½æ‹·è´åŸå§‹å€¼ï¼Œä¿®æ”¹å‰¯æœ¬å¹¶è¿”å›å‰¯æœ¬ã€‚å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âœ… This is safe, because we made a copy</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  ...state,</span><br><span class="line">  <span class="attr">value</span>: <span class="number">123</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹    è¿™ä¹Ÿè®©æˆ‘æƒ³åˆ°äº†ä¹‹å‰åœ¨å†™ç±»ç»„ä»¶æ—¶ï¼Œå¿…é¡»è¦ç”¨æ‹·è´çš„æ–¹å¼ä¿®æ”¹ï¼Œå¦‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setState</span>(<span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">  &#123;...state,<span class="attr">key</span>:newValue&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>â€‹    æˆ‘çŒœå’ŒImmer.jsä¹Ÿæœ‰å…³ç³»ã€‚</p>
<p>â€‹    è¿™æ ·ä¿®æ”¹å½“ç„¶OKæ²¡æœ‰é—®é¢˜ï¼Œ<strong>ä½†æ˜¯å¦‚æœçŠ¶æ€ä¹‹ä¸­åµŒå¥—äº†è®¸å¤šå±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸€å±‚éƒ½è¿›è¡Œæ‹·è´</strong>ï¼Œè¿™æ ·çš„ä»£ç ç»´æŠ¤æ–¹å¼æ˜¾ç„¶æ˜¯ç¾éš¾ä¸€æ ·çš„å­˜åœ¨ï¼è¿™é‡Œæˆ‘è´´ä¸Šå®˜ç½‘ç»™çš„ä¾‹å­ã€‚</p>
<blockquote>
<p>æ‰‹åŠ¨ç¼–å†™ä¸å¯å˜çš„æ›´æ–°é€»è¾‘å¾ˆå›°éš¾ï¼Œå¹¶ä¸”<strong>åœ¨ reducer ä¸­æ„å¤–æ”¹å˜çŠ¶æ€æ˜¯ Redux ç”¨æˆ·æœ€å¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯</strong>ã€‚</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handwrittenReducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...state,</span><br><span class="line">    <span class="attr">first</span>: &#123;</span><br><span class="line">      ...state.<span class="property">first</span>,</span><br><span class="line">      <span class="attr">second</span>: &#123;</span><br><span class="line">        ...state.<span class="property">first</span>.<span class="property">second</span>,</span><br><span class="line">        [action.<span class="property">someId</span>]: &#123;</span><br><span class="line">          ...state.<span class="property">first</span>.<span class="property">second</span>[action.<span class="property">someId</span>],</span><br><span class="line">          <span class="attr">fourth</span>: action.<span class="property">someValue</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹    æ‰€ä»¥ï¼Œå¼•å…¥äº†Immerï¼ŒImmeræ˜¯ä¸€ä¸ªåº“ï¼Œç®€åŒ–äº†ç¼–å†™ä¸å¯å˜æ›´æ–°é€»è¾‘çš„è¿‡ç¨‹ã€‚Immerçš„å·¥ä½œæµç¨‹æˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œä¸åšè¿‡å¤šèµ˜è¿°ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒReactToolkitçš„<code>createReducer</code>å’Œ<code>createSlice</code>éƒ½åœ¨å†…éƒ¨ä½¿ç”¨äº†Immerã€‚ä¸Šæ–‡æˆ‘ä¹Ÿå·²ç»éªŒè¯è¿‡äº†<code>state</code>æ˜¯ä¸€ä¸ªä»£ç†ã€‚</p>
<h4 id="æ›´æ”¹çŠ¶æ€çš„ä¸¤ç§æ–¹å¼ï¼šresetä¸replace"><a href="#æ›´æ”¹çŠ¶æ€çš„ä¸¤ç§æ–¹å¼ï¼šresetä¸replace" class="headerlink" title="æ›´æ”¹çŠ¶æ€çš„ä¸¤ç§æ–¹å¼ï¼šresetä¸replace"></a>æ›´æ”¹çŠ¶æ€çš„ä¸¤ç§æ–¹å¼ï¼š<code>reset</code>ä¸<code>replace</code></h4><ul>
<li>reset</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// reset ä¿®æ”¹</span></span><br><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">todoDeleted</span>(<span class="params">state, action.payload</span>) &#123;</span><br><span class="line">      <span class="comment">// Construct a new array immutably</span></span><br><span class="line">      <span class="keyword">const</span> newTodos = state.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">id</span> !== action.<span class="property">payload</span>)</span><br><span class="line">      <span class="comment">// &quot;Mutate&quot; the existing state to save the new array</span></span><br><span class="line">      state.<span class="property">todos</span> = newTodos</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>replace</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// replace æ›¿æ¢</span></span><br><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">todoDeleted</span>(<span class="params">state, action.payload</span>) &#123;</span><br><span class="line">      <span class="comment">// Construct a new result array immutably and return it</span></span><br><span class="line">      <span class="keyword">return</span> state.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">id</span> !== action.<span class="property">payload</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªæ˜“é”™çš„åœ°æ–¹ï¼Œå°±æ˜¯æœ‰ä¸€äº›ä¿®æ”¹å‡½æ•°ä¼šæœ‰é»˜è®¤è¿”å›å€¼ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹çŠ¶æ€åæœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œreducerå°±ä¸çŸ¥é“åº”è¯¥ä½¿ç”¨å“ªä¸ªå€¼ä½œä¸ºæœ€æ–°çš„çŠ¶æ€äº†ã€‚å¦‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="comment">// âŒ ERROR: mutates state, but also returns new array size!</span></span><br><span class="line">    <span class="attr">brokenReducer</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> state.<span class="title function_">push</span>(action.<span class="property">payload</span>),</span><br><span class="line">    <span class="comment">// âœ… SAFE: the `void` keyword prevents a return value</span></span><br><span class="line">    <span class="attr">fixedReducer1</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> <span class="keyword">void</span> state.<span class="title function_">push</span>(action.<span class="property">payload</span>),</span><br><span class="line">    <span class="comment">// âœ… SAFE: curly braces make this a function body and no return</span></span><br><span class="line">    <span class="attr">fixedReducer2</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="title function_">push</span>(action.<span class="property">payload</span>)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h4 id="å¦‚ä½•è¾“å‡ºå½“å‰çŠ¶æ€"><a href="#å¦‚ä½•è¾“å‡ºå½“å‰çŠ¶æ€" class="headerlink" title="å¦‚ä½•è¾“å‡ºå½“å‰çŠ¶æ€"></a>å¦‚ä½•è¾“å‡ºå½“å‰çŠ¶æ€</h4><p>â€‹    æƒ³è¦ä»reducerä¸­è®°å½•æ­£åœ¨è¿›è¡Œçš„çŠ¶æ€ä»¥æŸ¥çœ‹å®ƒåœ¨æ›´æ–°æ—¶çš„æ ·å­ï¼Œè¿™ä¸ªåœºæ™¯æ˜¯å¾ˆå¸¸è§çš„ã€‚ä½†ä¸å¹¸çš„æ˜¯ï¼Œç›´æ¥è¾“å‡º<code>state</code>æ˜¯ä¸€ä¸ª<code>Proxy</code>å¯¹è±¡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒImmeræä¾›äº†ä¸€ä¸ªå‡½æ•°<code>current()</code>ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹çŠ¶æ€å¯ä»¥ä½¿ç”¨å®ƒ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">todoToggled</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">      <span class="comment">// âŒ ERROR: logs the Proxy-wrapped data</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(state)</span><br><span class="line">      <span class="comment">// âœ… CORRECT: logs a plain JS copy of the current data</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">current</span>(state))</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h4 id="ä¸ºä»€ä¹ˆä¼šå¼•å…¥Immerï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šå¼•å…¥Immerï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå¼•å…¥Immerï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šå¼•å…¥Immerï¼Ÿ</h4><p>â€‹    ä¸‹é¢ä¸‰ç‚¹æ˜¯æˆ‘å¯¹å®˜æ–¹æ–‡æ¡£çš„ä¸€ä¸ªæ€»ç»“ä¸å¤è¿°</p>
<ul>
<li><p>ä½¿ç”¨Immerçš„ä¼˜ç‚¹</p>
<ul>
<li>Immeræå¤§ç®€åŒ–äº†ä¸å¯å˜çš„æ›´æ–°é€»è¾‘</li>
<li>å‡å°‘äº†reduceræ›´æ–°çŠ¶æ€çš„ç¼–å†™é”™è¯¯ã€‚å¼•å…¥Immeråï¼Œæ— éœ€åˆ›å»ºå‰¯æœ¬ï¼Œç›´æ¥è¿›è¡Œä¿®æ”¹å³å¯ã€‚ï¼ˆç›¸å½“äºä½ æŠŠä¿®æ”¹çš„å·¥ä½œäº¤ç»™äº†ä¸€ä¸ªä»£ç†ï¼Œç”±ä»£ç†å¸®ä½ è¿›è¡Œä¿®æ”¹ï¼‰</li>
</ul>
</li>
<li><p>Immeråœ¨æ€§èƒ½ä¸Šçš„æƒè¡¡</p>
<ul>
<li>æ— éœ€è€ƒè™‘ï¼Œreducerå‡ ä¹ä»æ¥éƒ½ä¸æ˜¯Reduxåº”ç”¨ä¸­çš„æ€§èƒ½ç“¶é¢ˆ</li>
</ul>
</li>
<li><p>æ˜¯å¦è€ƒè™‘æœªæ¥å°†Immerè®¾ç½®ä¸ºå¯é€‰é¡¹ï¼Ÿ</p>
<ul>
<li>æˆ‘æœ‰é¢„æ„Ÿå¾ˆå¤šäººåœ¨ç®€å•çœ‹äº†Redux-toolkitæ–‡æ¡£å°±æ‹¿å»ç”¨äº†ä»¥åï¼Œéƒ½ä¼šç»™å®ƒä»¬æIssueã€‚å› ä¸ºè¿™ä¸ªå¯¹è±¡çš„ä¸å¯å˜æ€§ç¨å¾®ä¸ç•™æ„å°±ä¼šå‡ºé”™ï¼ˆä½†æ˜¯ä¹ æƒ¯äº†å®ƒä»¬çš„å†™æ³•ä»¥åå…¶å®æ•ˆç‡æå‡å¾ˆå¤šï¼‰ã€‚å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿç»™å‡ºäº†ä¸ºä»€ä¹ˆä¸æ‰“ç®—å°†Immerè®¾ç½®ä¸ºå¯é€‰é¡¹çš„ç†ç”±ï¼Œå®ƒä»¬è¯´React-toolkitçš„æ¶æ„æ˜¯é€šè¿‡ç›´æ¥å¯¼å…¥Immeræ¥å®ç°çš„ï¼Œéœ€è¦åœ¨åº”ç”¨ç¨‹åºåŠ è½½æœŸé—´ç«‹å³åŒæ­¥ä½¿ç”¨Immerã€‚</li>
</ul>
<blockquote>
<p>And finally: <strong>Immer is built into RTK by default because we believe it is the best choice for our users!</strong> We <em>want</em> our users to be using Immer, and consider it to be a critical non-negotiable component of RTK. The great benefits like simpler reducer code and preventing accidental mutations far outweigh the relatively small concerns.</p>
<p>æœ€åï¼š<strong>Immer é»˜è®¤å†…ç½®åœ¨ React-toolkit ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬ç›¸ä¿¡å®ƒæ˜¯æˆ‘ä»¬ç”¨æˆ·çš„æœ€ä½³é€‰æ‹©ï¼</strong>æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„ç”¨æˆ·ä½¿ç”¨ Immerï¼Œå¹¶å°†å…¶è§†ä¸º React-toolkit çš„å…³é”®ç»„ä»¶ã€‚æ›´ç®€å•çš„ reducer ä»£ç å’Œé˜²æ­¢æ„å¤–çªå˜ç­‰å·¨å¤§å¥½å¤„ï¼Œè¿œè¿œè¶…è¿‡äº†é‚£äº›å¯ä»¥è¢«å¿½è§†çš„é—®é¢˜ã€‚</p>
</blockquote>
</li>
</ul>
<h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>â€‹    è¿™æ˜¯æˆ‘è§£å†³é—®é¢˜çš„å®Œæ•´è¿‡ç¨‹ï¼Œæœ€è¿‘åœ¨åšé¡¹ç›®ï¼Œå†™äº†å¥½ä¹…çš„æ–‡æ¡£ï¼Œå¥½ä¹…æ²¡æœ‰æ²‰æ·€è‡ªå·±çš„ä»£ç èƒ½åŠ›äº†ã€‚ç¢°å·§å‘¨æ—¥ï¼Œç¢°å·§é‡åˆ°äº†ä¸€ä¸ªå€¼å¾—è®°å½•çš„é—®é¢˜ï¼Œèµ¶ç´§æŠŠè‡ªå·±çš„æ€è€ƒè¿‡ç¨‹è½å®åœ¨äº†æ–‡å­—ã€‚</p>
<p>â€‹    ä»ç»„ä»¶ä¸­é€‰æ‹©çŠ¶æ€å‡æ ¼ä¸ºå…¨å±€è¿™æ˜¯ä¸€ä¸ªå€¼å¾—æ€è€ƒçš„é—®é¢˜ï¼Œæˆ‘ä¹Ÿè®¤ä¸ºè¿™æ˜¯å¾ˆè€ƒéªŒä¸€ä¸ªReactå†™æ‰‹èƒ½åŠ›çš„å·¥ä½œã€‚æœ€è¿‘åˆšå…¥é—¨Reactï¼Œæµ…è®°å½•ä¸€ä¸‹è§£å†³é—®é¢˜çš„å…¨è¿‡ç¨‹ã€‚</p>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>è§£å†³nginxè®¿é—®åŠ¨æ€æ¥å£æŠ¥é”™404Not Foundé—®é¢˜</title>
    <url>/2022/08/03/f105851c143d/</url>
    <content><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>è®¡è®¾åšäº†ä¸€å¥—æ‹›è˜èƒŒè°ƒç³»ç»Ÿï¼Œå‰åç«¯åˆ†åˆ«ä½¿ç”¨äº†Ant Design Vueä¸JFinalæ¡†æ¶ã€‚æƒ³è¦å°†é¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯å¤–éƒ¨è®¿é—®ä¸€ç›´æŠ¥é”™404Not Found<br><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181520276.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h2><p>æŠŠé”™è¯¯å®šä½ä¸ºï¼šæ‰¾ä¸åˆ°åŠ¨æ€æ¥å£ï¼Œä½†æ˜¯ä¸çŸ¥é“æ˜¯é¡¹ç›®ä¸­å‡ºç°äº†é—®é¢˜ï¼Œè¿˜æ˜¯ç»nginxä»£ç†åå‡ºç°äº†é—®é¢˜ã€‚<br>å› æ­¤è¦åˆ†åˆ«æµ‹è¯• é¡¹ç›®æœ¬èº«çš„æ¥å£ å’Œ nginxä»£ç†åçš„æ¥å£ã€‚</p>
<h5 id="é¦–å…ˆæµ‹è¯•é¡¹ç›®å†…æ¥å£ï¼š"><a href="#é¦–å…ˆæµ‹è¯•é¡¹ç›®å†…æ¥å£ï¼š" class="headerlink" title="é¦–å…ˆæµ‹è¯•é¡¹ç›®å†…æ¥å£ï¼š"></a>é¦–å…ˆæµ‹è¯•é¡¹ç›®å†…æ¥å£ï¼š</h5><p>åœ¨ubuntuç«¯è¾“å…¥å‘½ä»¤ï¼šcurl <a href="http://localhost:port/xxx/xxx">http://localhost:port/xxx/xxx</a><br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿™é‡Œæˆ‘çš„æ¥å£æ˜¯ï¼š curl http://localhost:20294/sys/login</span><br></pre></td></tr></table></figure><br>è¿è¡Œç»“æœï¼š<br><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181520630.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¯´æ˜æˆ‘çš„é¡¹ç›®å†…æ¥å£æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p>
<h5 id="å†æµ‹è¯•nginxä»£ç†åçš„æ¥å£ï¼š"><a href="#å†æµ‹è¯•nginxä»£ç†åçš„æ¥å£ï¼š" class="headerlink" title="å†æµ‹è¯•nginxä»£ç†åçš„æ¥å£ï¼š"></a>å†æµ‹è¯•nginxä»£ç†åçš„æ¥å£ï¼š</h5><p>å†ubuntuä¸­è¾“å…¥å‘½ä»¤<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl http://localhost:8080/api/user/login</span><br></pre></td></tr></table></figure><br>è¿è¡Œç»“æœï¼š<br><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181520460.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>è¿™é‡Œæç¤ºæ‰¾ä¸åˆ°æ¥å£äº†ï¼Œè¯´æ˜é—®é¢˜å‡ºåœ¨ä»£ç†æœåŠ¡å™¨nginxä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å»ä¿®æ”¹nginxçš„é…ç½®æ–‡ä»¶ã€‚</p>
<p>æŒ‰ç…§å…¶ä»–åšå®¢çš„å»ºè®®ï¼Œæˆ‘å°†nginxé…ç½®ä¸­è¿™ä¸ªåœ°æ–¹åŠ ä¸Šäº†æ–œæ <br><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181520853.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é‡å¯æœåŠ¡å™¨åï¼Œè¿˜æ˜¯ä¸è¡Œã€‚</p>
<h4 id="å½»åº•è§£å†³"><a href="#å½»åº•è§£å†³" class="headerlink" title="å½»åº•è§£å†³"></a>å½»åº•è§£å†³</h4><p>åœ¨å½“æˆ‘ä¸çŸ¥é“æ€ä¹ˆåŠçš„æ—¶å€™ï¼Œæˆ‘çªç„¶å‘ç°æˆ‘çš„æœåŠ¡å™¨ä¸­ï¼Œ<strong>æœ‰ä¸¤ä¸ªnginxÂ·Â·Â·Â·Â·</strong><br>æˆ‘åœ¨æƒ³æ˜¯ä¸æ˜¯å› ä¸ºæœ‰ä¸¤ä¸ªnginxï¼Œä¿®æ”¹çš„é…ç½®æ–‡ä»¶ä¸æ˜¯æˆ‘å¯åŠ¨çš„é‚£ä¸ªnginxã€‚äºæ˜¯æˆ‘æŠŠæ‰€æœ‰nginxé…ç½®æ–‡ä»¶éƒ½æ›¿æ¢æˆæˆ‘åŸå§‹çš„é…ç½®æ–‡ä»¶ï¼Œå†é‡å¯ã€‚è¿˜æ˜¯ä¸è¡Œ</p>
<p>æ‹…å¿ƒæ˜¯ä¸¤ä¸ªnginxçš„é—®é¢˜ï¼Œæˆ‘æŠŠæœåŠ¡å™¨ä¸­çš„æ‰€æœ‰nginxåˆ é™¤äº†ã€‚åˆ é™¤æ­¥éª¤ï¼ˆä¾æ¬¡è¿è¡Œä¸‹é¢çš„æ­¥éª¤ï¼‰ï¼š<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ps aux|grep nginx  #æŸ¥çœ‹nginxè¿›ç¨‹</span><br><span class="line">kill -9 è¿›ç¨‹å·      #æ€æ­»ä¸Šä¸€æ­¥ä¸­æŸ¥è¯¢åˆ°çš„nginxï¼ˆè¿›ç¨‹å·åœ¨ç¬¬äºŒåˆ—ï¼‰</span><br><span class="line">find / -name nginx #æ‰¾åˆ°nginxçš„æ–‡ä»¶åœ°å€</span><br><span class="line">rm -rf xxx         #åˆ é™¤nginxæ‰€æœ‰æ–‡ä»¶</span><br></pre></td></tr></table></figure><br>æœ€åç”¨wegetå®‰è£…æ–°çš„nginxï¼Œç„¶åæŒ‰ç…§åŸæœ¬å®‰è£…æ­¥éª¤è¿›è¡Œå®‰è£…ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶åï¼Œå†è¿è¡Œcurlè®¿é—®åŠ¨æ€æ¥å£ï¼Œçªç„¶å°±å¯ä»¥äº†!</p>
<p>ä¸‹é¢è´´å‡ºæˆ‘çš„nginxé…ç½®æ–‡ä»¶:<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">user root;</span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line">worker_processes  4;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format main <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    server_names_hash_bucket_size 128;</span><br><span class="line">    client_header_buffer_size 32k;</span><br><span class="line">    underscores_in_headers on;</span><br><span class="line">    large_client_header_buffers 4 32k;</span><br><span class="line">    client_max_body_size 50m;</span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    tcp_nopush          on;</span><br><span class="line">    fastcgi_connect_timeout 300;</span><br><span class="line">    fastcgi_send_timeout    300;</span><br><span class="line">    fastcgi_read_timeout    300;</span><br><span class="line">    fastcgi_buffer_size     64k;</span><br><span class="line">    fastcgi_buffers     4   64k;</span><br><span class="line">    fastcgi_busy_buffers_size 128k;</span><br><span class="line">    fastcgi_temp_file_write_size 256k;</span><br><span class="line">    tcp_nodelay         on;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">######################################################</span></span><br><span class="line">    <span class="comment">#############     éº»é›€é…ç½®åœ°å€    ###########</span></span><br><span class="line">    <span class="comment">######################################################</span></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       8080;</span><br><span class="line">        server_name  somename;</span><br><span class="line"></span><br><span class="line">        location /api/ &#123;</span><br><span class="line">            proxy_pass http://0.0.0.0:20294/; <span class="comment">#æ˜ å°„åˆ°æœ¬åœ°ç«¯å£ã€‚</span></span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_set_header Host <span class="variable">$http_host</span>;</span><br><span class="line">            proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            proxy_set_header X-Forwarded-Proto https;</span><br><span class="line">            proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">            client_max_body_size 200m;</span><br><span class="line">            proxy_connect_timeout 600;</span><br><span class="line">            proxy_read_timeout 600;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        location / &#123;</span><br><span class="line">            root /root/project-template/config/static;</span><br><span class="line">            try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ @router;</span><br><span class="line">            index index.html;</span><br><span class="line">            proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            proxy_set_header X-Forwarded-Proto https;</span><br><span class="line">            proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">            client_max_body_size 200m;</span><br><span class="line">            proxy_connect_timeout 600;</span><br><span class="line">            proxy_read_timeout 600;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location @router &#123;</span><br><span class="line">            rewrite ^.*$ /index.html last;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<font color="blue" size="4">éœ€è¦æ³¨æ„çš„æ˜¯ï¼šé…ç½®åŠ¨æ€è®¿é—®apiçš„æ—¶å€™ï¼Œè®°å¾—åœ¨æœ€ååŠ ä¸Šæ–œæ </font>


<p><img src="https://raw.githubusercontent.com/zqqcee/img_repo/main/img/202305181520695.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>è‡³æ­¤ï¼Œé—®é¢˜å®Œç¾è§£å†³ã€‚</p>
]]></content>
      <categories>
        <category>others</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨åšå®¢ä¸­åº”ç”¨ipad-cursorï¼Œ@Hexo(Theme:NexT)</title>
    <url>/2023/07/23/ebae3e5deab8/</url>
    <content><![CDATA[<h2 id="èµ·å› "><a href="#èµ·å› " class="headerlink" title="èµ·å› "></a>èµ·å› </h2><p>å‰ä¸¤å¤©ç¡å‰åˆ·<code>twitter</code>ï¼Œå¶ç„¶é—´åˆ·åˆ°ä¸€ä¸ªå¾ˆæ£’çš„é¡¹ç›®<code>ipad-cursor</code>ï¼Œæƒ³æŠŠè¿™ä¸ªç”¨åœ¨è‡ªå·±çš„åšå®¢ä¸­ã€‚é—®äº†ä¸€ä¸‹ä½œè€…<a href="https://github.com/CatsJuice">@CatsJuice</a>ï¼Œå‘ç°æš‚æœªæä¾›å…³äºHexoçš„æ”¯æŒï¼Œäºæ˜¯æƒ³ç€è‡ªå·±æŠŠè¿™ä¸ªåŠŸèƒ½åŠ ä¸Šï¼Œè¯´ä¸å®šè¿˜èƒ½å†™ä¸ª<code>hexo-plugin</code>ã€‚</p>
<h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="/Users/zqqcee/Desktop/å±å¹•å½•åˆ¶2023-07-24 ä¸‹åˆ4.35.30.gif" alt="å±å¹•å½•åˆ¶2023-07-24 ä¸‹åˆ4.35.30"></p>
<h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>åªéœ€è¦ä¸ºæƒ³è¦æ·»åŠ <code>ipad-cursor</code>æ•ˆæœçš„å…ƒç´ æ·»åŠ å±æ€§<code>data-cursor:block</code>æˆ–<code>data-cursor:text</code>å³å¯ã€‚</p>
<ul>
<li>åˆ›å»º<code>ipad-cursor-hexo</code>ç›®å½•ï¼Œæ”¾ç½®åœ¨<code>/themes/next/source/js</code>ä¸‹ï¼Œ</li>
<li><p>åˆ›å»ºä¸¤ä¸ªjsæ–‡ä»¶ï¼š<code>config.js</code>ï¼Œ<code>index.js</code>ã€‚</p>
</li>
<li><p>æ‰¾åˆ°éœ€è¦æ·»åŠ <code>data-cursor</code>çš„å…ƒç´ </p>
<p>æ–¹å¼ï¼šç›´æ¥åœ¨DevToolsä¸­é€‰æ‹©ï¼Œå³å¯å®šä½ï¼Œå¦‚æœå…ƒç´ æ²¡æœ‰<code>class</code>ä¸<code>id</code>ä¸æ–¹ä¾¿å®šä½ï¼Œå¯ä»¥åœ¨<code>hexo</code>å·¥ç¨‹ä¸‹æ‰¾åˆ°è¿™ä¸ªå…ƒç´ å¯¹åº”çš„<code>.swig</code>æ–‡ä»¶ï¼Œæ·»åŠ ä¸Š<code>id</code>ï¼Œæ–¹ä¾¿é€‰æ‹©å™¨é€‰æ‹©ã€‚</p>
</li>
<li><p>ä½¿ç”¨jsä¸ºå…¶æ·»åŠ å±æ€§<code>document.querySelector(&#39;xx&#39;)?.setAttribute(&#39;data-cursor&#39;,&#39;block&#39;)</code></p>
</li>
<li><p>åˆ›å»ºåˆå§‹åŒ–å‡½æ•°<code>init</code>ï¼Œç›‘å¬<code>DOMContentLoaded</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">init</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;*&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">_</span> =&gt;</span> _.<span class="property">style</span>.<span class="property">cursor</span> = <span class="string">&#x27;none&#x27;</span>);</span><br><span class="line">  <span class="comment">//document.querySelector(&#x27;xxx&#x27;).setAttribute(&#x27;data-cursor&#x27;,&#x27;block&#x27;);</span></span><br><span class="line">  <span class="comment">//document.querySelector(&#x27;xxx&#x27;).setAttribute(&#x27;data-cursor&#x27;,&#x27;block&#x27;);</span></span><br><span class="line">  <span class="comment">//......</span></span><br><span class="line">  cursor.<span class="title function_">initCursor</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">on</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>,init);</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ³¨ï¼šå¦‚æœ<code>selector</code>éš¾ä»¥é€‰æ‹©ï¼Œè€ƒè™‘ç›´æ¥ä¿®æ”¹<code>.swig</code>æ–‡ä»¶ï¼Œåœ¨æ ‡ç­¾ä¸Šç›´æ¥æ·»åŠ ã€‚</p>
</li>
</ul>
<p><code>ipad-cursor</code>å…·ä½“ç”¨æ³•è¯·å‚è€ƒï¼š<a href="https://github.com/CatsJuice/ipad-cursor">github/ipad-cursor</a></p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><ul>
<li><p>é¼ æ ‡æ ·å¼ä¸ç”Ÿæ•ˆé—®é¢˜ï¼š</p>
<ul>
<li><p>è¿™ä¸ªé—®é¢˜ä¸»è¦å‘ˆç°åœ¨å½“é¼ æ ‡æ”¾ç½®åˆ°<code>&lt;a&gt;ï¼Œ&lt;p&gt;</code>ç­‰æ ‡ç­¾ä¸­ï¼Œé¼ æ ‡ä¼šå˜ä¸ºä¸€ä¸ªå°æ‰‹ç‚¹å‡»çš„æ ·å¼ã€‚</p>
</li>
<li><p>NexTä¸»é¢˜ä¸­ï¼Œåœ¨ä¸€äº›åœ°æ–¹è®¾ç½®äº†cursorçš„å±æ€§ï¼Œ<code>ipad-cursor</code>çš„åŸç†æ˜¯å…ˆè®¾ç½®<code>cursor:none</code>,å†æ·»åŠ ä¸€ä¸ª<code>&lt;div&gt;</code>éšç€é¼ æ ‡ç§»åŠ¨ã€‚ä½†æ˜¯<code>cursor:none</code>ä¼šè¢«NexTä¸»é¢˜è®¾ç½®çš„æ ·å¼è¦†ç›–æ‰ã€‚</p>
</li>
<li><p><strong>è§£å†³æ–¹æ³•ï¼š</strong>éœ€è¦æ‰‹åŠ¨å°†æ‰€æœ‰å…ƒç´ çš„styleé‡æ–°è®¾ç½®<code>cursor:none</code></p>
</li>
</ul>
</li>
<li><p>è½½å…¥æ–‡ç« åcursorå¤±æ•ˆé—®é¢˜ï¼š</p>
<ul>
<li>è¿™ä¸ªé—®é¢˜ä¸»è¦å‘ˆç°åœ¨å½“è½½å…¥æ–‡ç« æ—¶ï¼Œ<code>cursor</code>å¤±æ•ˆã€‚</li>
<li>å› ä¸ºå·²ç»ç»‘å®šäº†<code>document.on(&#39;DOMContentLoaded&#39;)</code>äº‹ä»¶ï¼Œæ’é™¤ipad-cursoré”™è¯¯ä½¿ç”¨é—®é¢˜ã€‚è¿›ä¸€æ­¥æ’æŸ¥ï¼Œå‘ç°åœ¨<code>&lt;head&gt;</code>ä¸­ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„å¼•å…¥jsæ–‡ä»¶ï¼Œè€Œåœ¨è½½å…¥æ–‡ç« åï¼Œç›¸å¯¹è·¯å¾„æ”¹å˜ï¼Œé€ æˆ<code>ipad-cursor-hexo.js</code>æ–‡ä»¶æ— æ³•ç”Ÿæ•ˆé—®é¢˜</li>
<li><strong>è§£å†³æ–¹æ³•</strong>ï¼šåœ¨<code>&lt;head&gt;</code>ä½¿ç”¨ç»å¯¹è·¯å¾„å¼•å…¥</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>thought</category>
      </categories>
      <tags>
        <tag>javascript</tag>
      </tags>
  </entry>
</search>
