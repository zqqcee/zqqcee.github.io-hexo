<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="MXnxXuB_QrrsHGVDyL1PctN3b34klY8nvY_MD6CFETw">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zqqcee.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ä½¿ç”¨Redux-Toolkitï¼Œç”±â€œobject is not extensibleâ€å¼•å‘çš„æ€è€ƒåŠè§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡ä»‹ç»äº†Redux-Toolkitä¸­çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œä»‹ç»äº†Immer.jså³å®ƒå¦‚ä½•è¢«åº”ç”¨åœ¨äº†Reduxçš„çŠ¶æ€ç®¡ç†ä¸­">
<meta property="og:type" content="website">
<meta property="og:title" content="ç”±â€œobject is not extensibleâ€æŠ¥é”™å¼•å‘çš„æ€è€ƒåŠè§£å†³æ–¹æ¡ˆ@React-Toolkit&#x2F;@Immer.js">
<meta property="og:url" content="https://zqqcee.github.io/post_backup/%E4%BD%BF%E7%94%A8Redux-Toolkit%EF%BC%8C%E7%94%B1%E2%80%9Cobject%20is%20not%20extensible%E2%80%9D%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html">
<meta property="og:site_name" content="zqqcee">
<meta property="og:description" content="ä½¿ç”¨Redux-Toolkitï¼Œç”±â€œobject is not extensibleâ€å¼•å‘çš„æ€è€ƒåŠè§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡ä»‹ç»äº†Redux-Toolkitä¸­çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œä»‹ç»äº†Immer.jså³å®ƒå¦‚ä½•è¢«åº”ç”¨åœ¨äº†Reduxçš„çŠ¶æ€ç®¡ç†ä¸­">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://img-blog.csdnimg.cn/09423177c7b9404ca910b175e2fc6e5a.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2325eabe7c694c99874fdda2bc580c29.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/7dfa9eb024664d65b2f35719c1991d41.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/cb718876426441449f9ffdf19e58a76a.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/267bc47df3a14d86a7f497924999de9e.png">
<meta property="article:published_time" content="2023-06-16T04:58:34.375Z">
<meta property="article:modified_time" content="2023-03-24T06:18:32.497Z">
<meta property="article:author" content="zqqcee">
<meta property="article:tag" content="javascript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/09423177c7b9404ca910b175e2fc6e5a.png">

<link rel="canonical" href="https://zqqcee.github.io/post_backup/%E4%BD%BF%E7%94%A8Redux-Toolkit%EF%BC%8C%E7%94%B1%E2%80%9Cobject%20is%20not%20extensible%E2%80%9D%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>ç”±â€œobject is not extensibleâ€æŠ¥é”™å¼•å‘çš„æ€è€ƒåŠè§£å†³æ–¹æ¡ˆ@React-Toolkit/@Immer.js | zqqcee
</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">zqqcee</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Comes in a big package "ğŸ“¦" </p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-chitchat">

    <a href="/chitchat/" rel="section"><i class="fa fa-fan fa-fw"></i>Chitchat</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-leetcode">

    <a href="/leetcode/" rel="section"><i class="fa fa-crosshairs fa-fw"></i>Leetcode</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
  
  

          <div class="content page posts-expand">
            

    
    
    
    <div class="post-block" lang="en">
      <header class="post-header">

<h1 class="post-title" itemprop="name headline">ç”±â€œobject is not extensibleâ€æŠ¥é”™å¼•å‘çš„æ€è€ƒåŠè§£å†³æ–¹æ¡ˆ@React-Toolkit/@Immer.js
</h1>

<div class="post-meta">
    <div class="post-description">ä½¿ç”¨Redux-Toolkitï¼Œç”±â€œobject is not extensibleâ€å¼•å‘çš„æ€è€ƒåŠè§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡ä»‹ç»äº†Redux-Toolkitä¸­çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ï¼Œä»‹ç»äº†Immer.jså³å®ƒå¦‚ä½•è¢«åº”ç”¨åœ¨äº†Reduxçš„çŠ¶æ€ç®¡ç†ä¸­</div>
  

</div>

</header>

      
      
      
      <div class="post-body">
          <h2 id="é—®é¢˜é‡è¿°"><a href="#é—®é¢˜é‡è¿°" class="headerlink" title="é—®é¢˜é‡è¿°"></a>é—®é¢˜é‡è¿°</h2><p>â€‹    æœ€è¿‘åœ¨åšä¸€ä¸ªæ•°æ®æµè§ˆå¹³å°ï¼Œå¦‚å›¾æ‰€ç¤º</p>
<p><img src="https://img-blog.csdnimg.cn/09423177c7b9404ca910b175e2fc6e5a.png" alt="æ•°æ®æµè§ˆå¹³å°"></p>
<p>â€‹    å¤§è‡´çš„ç¼–ç é€»è¾‘æ˜¯å·¦ä¸Šè§’çš„æ•°æ®é›†é€‰æ‹©å™¨ï¼Œæ§åˆ¶å…¨å±€UIçš„æ”¹å˜ã€‚æ¯”å¦‚<strong>å·¦éƒ¨çš„æ ‘å½¢æ§ä»¶æ•°æ®</strong>ï¼Œ<strong>ç”»å¸ƒä¸­çš„èŠ‚ç‚¹é“¾æ¥å›¾</strong>ç­‰ç­‰ï¼Œéƒ½æ˜¯æ ¹æ®å½“å‰æ‰€é€‰çš„æ•°æ®é›†æ¥å®šçš„ã€‚è¿™ç§ç»„ä»¶é—´çš„çŠ¶æ€å¤ç”¨ï¼Œè‡ªç„¶è€Œç„¶å°±æƒ³åˆ°æŠŠæ•°æ®é›†ä½œä¸ºä¸€ä¸ªçŠ¶æ€æ¥äº¤ç»™reduxç®¡ç†ã€‚</p>
<h3 id="ä½¿ç”¨redux-toolkit"><a href="#ä½¿ç”¨redux-toolkit" class="headerlink" title="ä½¿ç”¨redux-toolkit"></a>ä½¿ç”¨redux-toolkit</h3><p>â€‹    å¥½çš„ï¼Œç°åœ¨å¼€å§‹æŸ¥reduxå®˜æ–¹æ–‡æ¡£ã€‚å› ä¸ºåˆšå­¦ä¼šreactï¼Œæ•™ç¨‹ä¸­reduxçš„storeä¸­ä½¿ç”¨çš„æ˜¯<code>createStore()</code>åˆ›å»ºçš„ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•ç›®å‰å·²ç»å¼ƒç”¨äº†ï¼Œå®˜æ–¹å»ºè®®ä½¿ç”¨çš„æ˜¯<code>configureStore()</code>ã€‚ç»è¿‡ä¸€ç•ªæ–‡æ¡£çš„æŸ¥é˜…ï¼Œå¼€å§‹ä½¿ç”¨<code>createSlice()</code>æ¥é‡å†™reducerã€‚</p>
<h4 id="ä½¿ç”¨createSlice"><a href="#ä½¿ç”¨createSlice" class="headerlink" title="ä½¿ç”¨createSlice()"></a>ä½¿ç”¨<code>createSlice()</code></h4><p>â€‹    è¿™é‡Œç›´æ¥è´´ä¸Šæˆ‘è¿™éƒ¨åˆ†sliceçš„<strong>é”™è¯¯ä»£ç </strong></p>
<ul>
<li><strong>åˆ›å»ºslice</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//  redux/optionSlice.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; dataSets &#125; <span class="keyword">from</span> <span class="string">&quot;../utils/getData&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">HIGHLIGHT</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constant&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> optionSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;option&#x27;</span>,</span><br><span class="line">    <span class="attr">initialState</span>: &#123;</span><br><span class="line">        <span class="attr">data</span>: dataSets[<span class="string">&quot;case1&quot;</span>],</span><br><span class="line">        <span class="attr">mode</span>: <span class="variable constant_">HIGHLIGHT</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">reducers</span>: &#123;</span><br><span class="line">      	<span class="comment">//è¿™é‡Œå¯¹äºstateçš„è§£é‡Šåœ¨ä¸‹æ–‡</span></span><br><span class="line">        <span class="attr">changedata</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">data</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">changemode</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">mode</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; changedata, changemode &#125; = optionSlice.<span class="property">actions</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> optionSlice.<span class="property">reducer</span></span><br></pre></td></tr></table></figure>
<p><code>slice</code>æœ‰ä¸¤ä¸ªå¯¼å‡ºï¼Œä¸€ä¸ªæ˜¯åœ¨å†…éƒ¨è´Ÿè´£æ“ä½œçŠ¶æ€çš„actionï¼›ä¸€ä¸ªæ˜¯reducer</p>
<p>æˆ‘è¿˜æœ‰ä¸€å¦å¤–ä¸€ä¸ª<code>selectionSlice</code>è´Ÿè´£ç®¡ç†å…¶ä»–çš„çŠ¶æ€ï¼Œè¿™é‡Œè€ƒè™‘åˆ°ç¯‡å¹…å°±ä¸ç»™å‡ºäº†ã€‚</p>
<h4 id="åœ¨index-jsä¸­èåˆä¸¤ä¸ªsilce"><a href="#åœ¨index-jsä¸­èåˆä¸¤ä¸ªsilce" class="headerlink" title="åœ¨index.jsä¸­èåˆä¸¤ä¸ªsilce"></a>åœ¨<code>index.js</code>ä¸­èåˆä¸¤ä¸ªsilce</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//   redux/index.js</span></span><br><span class="line"><span class="keyword">import</span> optionReducer <span class="keyword">from</span> <span class="string">&#x27;./optionSlice&#x27;</span>;   <span class="comment">//æ³¨æ„ï¼Œè¿™é‡Œå¼•å…¥çš„æ˜¯sliceä¸­å¯¼å‡ºçš„reducerï¼Œsliceæœ‰ä¸¤ä¸ªå¯¼å‡ºï¼šreducerå’Œaction</span></span><br><span class="line"><span class="keyword">import</span> selectionReducer <span class="keyword">from</span> <span class="string">&quot;./selectionSlice&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reducers = &#123;</span><br><span class="line">    <span class="attr">option</span>: optionReducer,</span><br><span class="line">    <span class="attr">selection</span>: selectionReducer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="åœ¨store-jsé…ç½®storeï¼Œå¹¶ä½¿ç”¨-lt-Provider-store-store-gt-è®©æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨reduxä¸­ç®¡ç†çš„çŠ¶æ€"><a href="#åœ¨store-jsé…ç½®storeï¼Œå¹¶ä½¿ç”¨-lt-Provider-store-store-gt-è®©æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨reduxä¸­ç®¡ç†çš„çŠ¶æ€" class="headerlink" title="åœ¨store.jsé…ç½®storeï¼Œå¹¶ä½¿ç”¨&lt;Provider store={store}&gt;è®©æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨reduxä¸­ç®¡ç†çš„çŠ¶æ€"></a>åœ¨store.jsé…ç½®storeï¼Œå¹¶ä½¿ç”¨<code>&lt;Provider store=&#123;store&#125;&gt;</code>è®©æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨reduxä¸­ç®¡ç†çš„çŠ¶æ€</h4><ul>
<li>é…ç½®<code>store</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// redux/store.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; configureStore &#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; reducers &#125; <span class="keyword">from</span> <span class="string">&#x27;./index&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">reducer</span>: reducers,<span class="comment">//è¿™é‡Œå†…ç½®äº†combineReducer</span></span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<ul>
<li>æ·»åŠ <code>Provider</code></li>
</ul>
<p>â€‹    åœ¨Appæ ‡ç­¾å¤–éƒ¨å¥—ä¸Š<code>&lt;Provider&gt;</code>æ ‡ç­¾</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRoot &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Provider</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; store &#125; <span class="keyword">from</span> <span class="string">&#x27;./redux/store&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)).<span class="title function_">render</span>(</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="ç»˜åˆ¶èŠ‚ç‚¹é“¾æ¥å›¾"><a href="#ç»˜åˆ¶èŠ‚ç‚¹é“¾æ¥å›¾" class="headerlink" title="ç»˜åˆ¶èŠ‚ç‚¹é“¾æ¥å›¾"></a>ç»˜åˆ¶èŠ‚ç‚¹é“¾æ¥å›¾</h3><p>â€‹    ç”¨æˆ·é€‰æ‹©ä¸€ä»½æ•°æ®é›†ï¼Œå°±ä¼šæŠŠè¿™ä»½æ•°æ®é›†äº¤ç»™reduxç®¡ç†ï¼Œåœ¨å…¶ä»–ç»„ä»¶ä¸­å¦‚æœæƒ³è¦å–ç”¨æ•°æ®é›†ï¼Œä½¿ç”¨<code>useSelector(state =&gt; state.option.data)</code>å³å¯å–ç”¨ã€‚<strong><font color="red">é—®é¢˜å°±å‘ç”Ÿåœ¨è¿™ä¸€æ­¥</font></strong></p>
<p>â€‹    æˆ‘å…ˆç®€è¿°ä¸€ä¸‹æˆ‘çš„ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// componnets/Canvas/index.jsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">Canvas</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">useSelector</span>(<span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">option</span>.<span class="property">data</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">initCanvas</span>()  <span class="comment">//drawLayout</span></span><br><span class="line">  &#125;,[data])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">initCanvas</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// .....append canvas</span></span><br><span class="line">    <span class="keyword">const</span> nodes = data.<span class="property">nodes</span></span><br><span class="line">    <span class="keyword">const</span> links = data.<span class="property">links</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//append circle,line......</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> simulation = d3.<span class="title function_">forceSimulation</span>(nodes)</span><br><span class="line">            .<span class="title function_">force</span>(<span class="string">&quot;link&quot;</span>, d3.<span class="title function_">forceLink</span>(links).<span class="title function_">id</span>(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">mgmt_ip</span></span><br><span class="line">            &#125;).<span class="title function_">strength</span>(<span class="number">0.5</span>).<span class="title function_">distance</span>(<span class="number">10</span>))</span><br><span class="line">            <span class="comment">//......some force option</span></span><br><span class="line">    				.<span class="title function_">on</span>(<span class="string">&quot;tick&quot;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">              <span class="comment">//refresh canvas</span></span><br><span class="line">            &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">  	<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;container&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹    è¿™ä¸ªä»£ç å¾ˆç®€å•ï¼Œæˆ‘åœ¨<code>useLayoutEffect()</code>è¿™ä¸ªé’©å­é‡Œç¼–å†™äº†ä¸€ä¸ªç”»å¸ƒåˆå§‹åŒ–å‡½æ•°<code>initCanvas()</code>ã€‚ç›®çš„æ˜¯è®©ç»„ä»¶æŒ‚è½½å‰ï¼Œå…ˆåœ¨ä¸€ä¸ª<code>&lt;div&gt;</code>ä¸­æ·»åŠ ä¸€ä¸ªcanvasï¼Œå¹¶ç»˜åˆ¶å‡ºæ•°æ®ã€‚</p>
<h3 id="æŠ¥é”™é‡ç°"><a href="#æŠ¥é”™é‡ç°" class="headerlink" title="æŠ¥é”™é‡ç°"></a>æŠ¥é”™é‡ç°</h3><p>â€‹    <strong><font color="maroon">ç»“æœè¿™ä¸ªä»£ç ç›´æ¥æŠ¥çº¢äº†ï¼ŒæŠ¥äº†ä¸€ä¸ªæˆ‘ä»æ²¡è§è¿‡çš„é”™è¯¯:   â€œUncaught TypeError:Cannot add property vx,object is extensibleâ€</font></strong></p>
<p><img src="https://img-blog.csdnimg.cn/2325eabe7c694c99874fdda2bc580c29.png" alt=""></p>
<p>â€‹    ä»è¿™ä¸ªæŠ¥é”™ä¿¡æ¯å¾ˆå®¹æ˜“å°±èƒ½çŸ¥é“ï¼Œæ˜¯åœ¨æˆ‘è®¾ç½®åŠ›æ¨¡æ‹Ÿå™¨æ—¶ï¼Œè°ƒç”¨<code>d3.forceLink(links)</code>ç»‘å®šè¿è¾¹ï¼Œå’Œç»‘å®šèŠ‚ç‚¹æ—¶ï¼Œæ— æ³•åƒè¾¹æ•°æ®å’Œç‚¹æ•°æ®ä¸­æ·»åŠ vxï¼Œvyç­‰å±æ€§å¯¼è‡´çš„ã€‚</p>
<p>â€‹    ä¸ºäº†è¿›ä¸€æ­¥éªŒè¯è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ç”¨ä»¥ä¸‹ä»£ç éªŒè¯äº†æˆ‘æ‹¿åˆ°çš„æ•°æ®æ˜¯å¦çœŸçš„ä¸å¯æ‹“å±•</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> nodes = data.<span class="property">nodes</span></span><br><span class="line"><span class="keyword">const</span> links = data.<span class="property">links</span></span><br><span class="line">nodes.<span class="title function_">forEach</span>(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(node.<span class="title function_">isExtensible</span>())</span><br><span class="line">&#125;)</span><br><span class="line">links.<span class="title function_">forEach</span>(<span class="function"><span class="params">link</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(link.<span class="title function_">isExtensible</span>())</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>â€‹    æ¯«æ— æ„å¤–ï¼Œæ§åˆ¶å°è¾“å‡ºäº†æ¸…ä¸€è‰²çš„<code>false</code>ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼è§£å†³ï¼ˆç¬¨æ–¹æ³•ï¼‰"><a href="#é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼è§£å†³ï¼ˆç¬¨æ–¹æ³•ï¼‰" class="headerlink" title="é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼è§£å†³ï¼ˆç¬¨æ–¹æ³•ï¼‰"></a>é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼è§£å†³ï¼ˆç¬¨æ–¹æ³•ï¼‰</h3><p>â€‹    æ‰€ä»¥è¿™ä¸ªé—®é¢˜å¯ä»¥åŸºæœ¬ç¡®å®šæ˜¯å› ä¸ºæˆ‘çš„æ•°æ®ä¸å¯æ‹“å±•é€ æˆçš„ï¼Œè™½ç„¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ä½†æ˜¯è§£å†³è¿™ä¸ªçš„åŠæ³•æ— éå°±æ˜¯è®©æˆ‘çš„æ•°æ®èƒ½å¤Ÿè¢«æ‹“å±•ã€‚ä½†æ˜¯æœäº†åŠå¤©è§£é™¤ä¸å¯æ‹“å±•æ€§çš„åŠæ³•ï¼Œæ‰¾ä¸åˆ°ã€‚äºæ˜¯åªèƒ½é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼ï¼Œæ‹·è´ä¸€ä»½æ–°çš„å¯¹è±¡ã€‚</p>
<p>â€‹    æ‹·è´åˆ†ä¸¤ç§æ–¹å¼ï¼šæµ…æ‹·è´ä¸æ·±æ‹·è´ã€‚åœ¨æœ‰æŒ‡é’ˆçš„æƒ…å†µä¸‹ï¼Œ<strong>æµ…æ‹·è´åªæ˜¯å¢åŠ äº†ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å·²ç»å­˜åœ¨çš„å†…å­˜</strong>ï¼Œè€Œæ·±æ‹·è´å°±æ˜¯<strong>å¢åŠ ä¸€ä¸ªæŒ‡é’ˆå¹¶ä¸”ç”³è¯·ä¸€ä¸ªæ–°çš„å†…å­˜</strong>ï¼Œ<strong>ä½¿è¿™ä¸ªå¢åŠ çš„æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªæ–°çš„å†…å­˜</strong>ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ·±æ‹·è´ï¼Œç”³è¯·ä¸€ä¸ªæ–°çš„å†…å­˜å­˜æ”¾æ‹·è´çš„å¯¹è±¡ã€‚</p>
<p>â€‹    <code>nodes</code>ä¸<code>links</code>æ•°ç»„ä¸­å­˜æ”¾çš„objå¦‚å›¾æ‰€ç¤ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  nodes<span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line"> 	 	id<span class="punctuation">:</span>xxxx<span class="punctuation">,</span></span><br><span class="line">    role<span class="punctuation">:</span>xxxx<span class="punctuation">,</span></span><br><span class="line">    type<span class="punctuation">:</span>xxxx</span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	links<span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line"> 	 	source<span class="punctuation">:</span>xxxx<span class="punctuation">,</span></span><br><span class="line">    target<span class="punctuation">:</span>xxxx<span class="punctuation">,</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>â€‹    å› æ­¤æˆ‘ä»¬ä½¿ç”¨å¯¹è±¡æ‹“å±•ç¬¦<code>&#123;...node&#125;,&#123;...link&#125;</code>å³å¯å®Œæˆæ·±æ‹·è´ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> newNode = nodes.<span class="title function_">map</span>(<span class="function"><span class="params">node</span> =&gt;</span> (&#123;...node&#125;));</span><br><span class="line"><span class="keyword">const</span> newLink = links.<span class="title function_">map</span>(<span class="function"><span class="params">link</span> =&gt;</span> (&#123;...link&#125;))</span><br></pre></td></tr></table></figure>
<p>â€‹    æ¥ç€æˆ‘ä»¬ä½¿ç”¨newNodeå’ŒnewLinkæ›¿æ¢åŸæ¥çš„nodeså’Œlinksï¼Œå°±OKäº†ã€‚</p>
<h3 id="æŠŠreduxä¸­å­˜å‚¨çš„æ•°æ®å¯¹è±¡æ›¿æ¢ä¸ºæ•°æ®å"><a href="#æŠŠreduxä¸­å­˜å‚¨çš„æ•°æ®å¯¹è±¡æ›¿æ¢ä¸ºæ•°æ®å" class="headerlink" title="æŠŠreduxä¸­å­˜å‚¨çš„æ•°æ®å¯¹è±¡æ›¿æ¢ä¸ºæ•°æ®å"></a>æŠŠreduxä¸­å­˜å‚¨çš„æ•°æ®å¯¹è±¡æ›¿æ¢ä¸ºæ•°æ®å</h3><p>â€‹    ä¸Šé¢çš„åŠæ³•æ˜¾ç„¶å¾ˆè ¢Â·Â·Â·Â·Â·Â·ã€‚<strong>æˆ‘æ…¢æ…¢å¼€å§‹æ„è¯†åˆ°è¿™ä¸ªå¯¹è±¡çš„ä¸å¯æ‹“å±•æ€§å¾ˆå¯èƒ½æ˜¯reduxå¸®æˆ‘å¤„ç†çš„</strong>ï¼Œå› ä¸º<strong>æˆ‘ä»¬åœ¨reduxä¸­å­˜æ”¾çš„æ•°æ®åº”è¯¥ç”±å¯¹åº”çš„reduceræ¥è¿›è¡Œæ›´æ”¹</strong>ï¼Œå¦‚æœå¤–éƒ¨èƒ½å¤Ÿæ›´æ”¹ä¼šå¯¼è‡´UIç»„ä»¶ä¸­è·å–çš„çŠ¶æ€å‡ºç°é”™è¯¯ã€‚</p>
<p>â€‹    å› ä¸ºå‘ç°è¿™ä¸ªé—®é¢˜å·²ç»å¾ˆæ™šäº†ï¼Œæˆ‘æ²¡æœ‰æ€¥ç€å»éªŒè¯çš„æƒ³æ³•æ˜¯ä¸æ˜¯å¯¹çš„ï¼Œå› ä¸ºæˆ‘æƒ³èµ¶ç´§æŠŠæˆ‘çš„è ¢æ–¹æ³•æ¢æ‰ï¼Œè®©æˆ‘çš„ç¨‹åºçœ‹èµ·æ¥åˆ«é‚£ä¹ˆçƒ‚ã€‚æˆ‘ä¹‹å‰å»ºç«‹äº†ä¸€ä¸ªå‡½æ•°å¸®æˆ‘æä¾›æ•°æ®é›†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> case1 <span class="keyword">from</span> <span class="string">&quot;../assets/case1.json&quot;</span></span><br><span class="line"><span class="keyword">import</span> case2 <span class="keyword">from</span> <span class="string">&quot;../assets/case2.json&quot;</span></span><br><span class="line"><span class="keyword">import</span> case3 <span class="keyword">from</span> <span class="string">&quot;../assets/case3.json&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">generate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> datasets = &#123;</span><br><span class="line">        case1,</span><br><span class="line">        case2,</span><br><span class="line">        case3</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> datasets;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> dataSets = <span class="title function_">generate</span>();</span><br></pre></td></tr></table></figure>
<p>â€‹    è¿™ä¹ˆåšçš„ç›®çš„æ˜¯æˆ‘åœ¨ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨<code>import &#123;dataSets&#125; from &quot;../util/getData.js&quot;</code>å°±èƒ½è·å–åˆ°å…¨éƒ¨æ•°æ®é›†äº†ã€‚</p>
<p>â€‹    å†™åˆ°è¿™ï¼Œåº”è¯¥å¾ˆæ˜ç™½äº†ã€‚æ­£ç¡®çš„æ€è·¯åº”è¯¥æ˜¯å°†æ•°æ®é›†çš„åå­—ï¼Œå¦‚case1ï¼Œcase2ï¼Œcase3â€¦â€¦äº¤ç»™reduxæ¥ç®¡ç†ï¼Œç”¨æˆ·æ¯æ¬¡åˆ‡æ¢æ•°æ®é›†ï¼Œå°±é€šçŸ¥reduceræ›´æ”¹å½“å‰çš„æ•°æ®é›†åç§°ã€‚åœ¨ç»„ä»¶ä¸­å¦‚æœæƒ³è¦ä½¿ç”¨æ•°æ®çš„è¯å°±ä»¥ä¸‹ä»£ç æ¥è·å–ã€‚è¿™ä¹ˆåšæ˜¾ç„¶æ¯”æŠŠæ•´ä»½æ•°æ®äº¤ç»™reduxç®¡ç†æ›´åŠ åˆç†ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;dataSets&#125; <span class="keyword">from</span> <span class="string">&quot;../util/getData.js</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function Component()&#123;</span></span><br><span class="line"><span class="string">  const dataName = useSelector(state =&gt; state.option.dataName)</span></span><br><span class="line"><span class="string">  const data = dataSets[dataName]</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  //func body</span></span><br><span class="line"><span class="string">  return ....</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè´´ä¸Šä¸€ä¸ªæ­£ç¡®ä»£ç ï¼Œå’Œä¹‹å‰ç›¸æ¯”ï¼Œæˆ‘æŠŠäº¤ç»™reduxç®¡ç†çš„çŠ¶æ€ä»<code>data</code>æ¢æˆäº†<code>dataName</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// redux/optionSlice.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createSlice &#125; <span class="keyword">from</span> <span class="string">&quot;@reduxjs/toolkit&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">HIGHLIGHT</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./constant&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**data option */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> optionSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;option&#x27;</span>,</span><br><span class="line">    <span class="attr">initialState</span>: &#123;</span><br><span class="line">        <span class="attr">dataName</span>: <span class="string">&quot;case1&quot;</span>,</span><br><span class="line">        <span class="attr">mode</span>: <span class="variable constant_">HIGHLIGHT</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">reducers</span>: &#123;</span><br><span class="line">        <span class="attr">changedata</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">dataName</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">changemode</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">mode</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> &#123; changedata, changemode &#125; = optionSlice.<span class="property">actions</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> optionSlice.<span class="property">reducer</span></span><br></pre></td></tr></table></figure>
<p>â€‹    å…¶å®å·²ç»å‘ç°åŒºåˆ«äº†ï¼Œåœ¨ä¿®æ”¹ä¹‹å‰ï¼Œæˆ‘æŠŠæ•´ä¸ªæ•°æ®é›†<code>data = &#123;nodes:[...],links:[...]&#125;</code>ä½œä¸ºäº†æ•´ä¸ªçŠ¶æ€å­˜æ”¾åˆ°äº†reduxä¸­ã€‚è€Œä¿®æ”¹ä¹‹åï¼Œæˆ‘åªå­˜äº†<strong>æ•°æ®é›†çš„åç§°</strong>ï¼Œä½¿ç”¨çš„æ—¶å€™ç”¨è¿™ä¸ª<strong>åç§°</strong>å»ä¸€ä¸ªå­˜æ”¾äº†æ‰€æœ‰dataSetsçš„åœ°æ–¹å–ã€‚è¿™æ˜¾ç„¶æ˜¯ä¸€ç§æ›´åŠ åˆç†çš„ç¼–ç æ–¹å¼ã€‚</p>
<h2 id="äº§ç”ŸåŸå› åˆ†æ"><a href="#äº§ç”ŸåŸå› åˆ†æ" class="headerlink" title="äº§ç”ŸåŸå› åˆ†æ"></a>äº§ç”ŸåŸå› åˆ†æ</h2><h4 id="immer-js-gt-ä¸å¯å˜æ•°æ®ç»“æ„"><a href="#immer-js-gt-ä¸å¯å˜æ•°æ®ç»“æ„" class="headerlink" title="immer.js =&gt; ä¸å¯å˜æ•°æ®ç»“æ„"></a>immer.js =&gt; ä¸å¯å˜æ•°æ®ç»“æ„</h4><p>â€‹    åŸºæœ¬èƒ½å¤Ÿåˆæ­¥ç¡®å®šredux-toolkitåœ¨è¿”å›æ–°çŠ¶æ€å€¼çš„æ—¶å€™ï¼Œè®¾ç½®äº†è¿”å›çš„objæ˜¯ä¸å¯æ‰©å±•çš„ã€‚ä¸ºäº†éªŒè¯æˆ‘çš„çŒœæƒ³ï¼Œæˆ‘å»redux-toolkitå®˜ç½‘æ‰¾åˆ°äº†ä¸‹é¢è¿™ç¯‡<code>Writing Reducers with Immer</code></p>
<p><img src="https://img-blog.csdnimg.cn/7dfa9eb024664d65b2f35719c1991d41.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>â€‹    Immerï¼ŒImmeræ˜¯ä»€ä¹ˆï¼Ÿè¯»è¿™ç¯‡æ–‡ç« ç¬¬ä¸€å¥è¯</p>
<blockquote>
<p>Redux Toolkitâ€™s <a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/api/createReducer"><code>createReducer</code></a> and <a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/api/createSlice"><code>createSlice</code></a> automatically use [Immer]<br>(<a target="_blank" rel="noopener" href="https://immerjs.github.io/immer/">https://immerjs.github.io/immer/</a>) internally to let you write simpler immutable update logic using â€œmutatingâ€ syntax. This helps simplify most reducer implementations.</p>
<p>è¯‘æ–‡ï¼šRedux Toolkit<a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/api/createReducer"><code>createReducer</code></a>å¹¶åœ¨å†…éƒ¨<a target="_blank" rel="noopener" href="https://redux-toolkit.js.org/api/createSlice"><code>createSlice</code></a>è‡ªåŠ¨ä½¿ç”¨<a target="_blank" rel="noopener" href="https://immerjs.github.io/immer/">Immer</a>è®©æ‚¨ä½¿ç”¨â€œmutatingâ€è¯­æ³•ç¼–å†™æ›´ç®€å•çš„ä¸å¯å˜çš„æ›´æ–°é€»è¾‘ã€‚è¿™æœ‰åŠ©äºç®€åŒ–å¤§å¤šæ•° reducer å®ç°ã€‚</p>
</blockquote>
<p>â€‹    <code>immutable update logic</code>ä¸å¯å˜çš„æ›´æ–°é€»è¾‘ï¼Œæˆ‘æƒ³æˆ‘æ‰¾åˆ°ç­”æ¡ˆäº†ã€‚äºæ˜¯æˆ‘å»googleäº†<code>immer.js</code>ï¼Œ</p>
<p>â€‹    åœ¨å®ƒçš„ä¸­æ–‡å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæœ‰ä¸€æ®µè¿™ä¹ˆä»‹ç»çš„è¯ï¼š</p>
<blockquote>
<p>Immer can be used in any context in which immutable data structures need to be used. For example in combination with React state, React or Redux reducers, or configuration management. Immutable data structures allow for (efficient) change detection: if the reference to an object didnâ€™t change, the object itself did not change. In addition, it makes cloning relatively cheap: Unchanged parts of a data tree donâ€™t need to be copied and are shared in memory with older versions of the same state.</p>
<p>è¯‘æ–‡ï¼š<strong>Immer å¯ä»¥åœ¨éœ€è¦ä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„çš„ä»»ä½•ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨</strong>ã€‚ä¾‹å¦‚ä¸ React stateã€React æˆ– <strong>Redux reducers</strong> æˆ–è€… configuration management ç»“åˆä½¿ç”¨ã€‚<strong>ä¸å¯å˜çš„æ•°æ®ç»“æ„å…è®¸ï¼ˆé«˜æ•ˆï¼‰çš„å˜åŒ–æ£€æµ‹</strong>ï¼šå¦‚æœå¯¹å¯¹è±¡çš„å¼•ç”¨æ²¡æœ‰æ”¹å˜ï¼Œé‚£ä¹ˆå¯¹è±¡æœ¬èº«ä¹Ÿæ²¡æœ‰æ”¹å˜ã€‚æ­¤å¤–ï¼Œå®ƒ<strong>ä½¿å…‹éš†å¯¹è±¡ç›¸å¯¹ä¾¿å®œ</strong>ï¼š<strong>æ•°æ®æ ‘çš„æœªæ›´æ”¹éƒ¨åˆ†ä¸éœ€è¦å¤åˆ¶ï¼Œå¹¶ä¸”åœ¨å†…å­˜ä¸­ä¸ç›¸åŒçŠ¶æ€çš„æ—§ç‰ˆæœ¬å…±äº«</strong></p>
</blockquote>
<p>â€‹    çœ‹å®Œè¿™ä¸¤æ®µè¯ï¼Œæ¯”è¾ƒæŠ½è±¡ï¼Œç›´æ¥çœ‹å®˜æ–¹ç»™çš„ä»£ç ç¤ºä¾‹ï¼š</p>
<ul>
<li><strong>æœ‰ä¸€ä¸ªTodoåˆ—è¡¨ï¼Œæˆ‘ä»¬è¦å¯¹å®ƒè¿›è¡Œæ›´æ–°</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> baseState = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;Learn TypeScript&quot;</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&quot;Try Immer&quot;</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸ä½¿ç”¨Immer</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¸ä½¿ç”¨immer</span></span><br><span class="line"><span class="keyword">const</span> nextState = baseState.<span class="title function_">slice</span>() <span class="comment">// æµ…æ‹·è´æ•°ç»„</span></span><br><span class="line">nextState[<span class="number">1</span>] = &#123;</span><br><span class="line">    <span class="comment">// æ›¿æ¢ç¬¬ä¸€å±‚å…ƒç´ </span></span><br><span class="line">    ...nextState[<span class="number">1</span>], <span class="comment">// æµ…æ‹·è´ç¬¬ä¸€å±‚å…ƒç´ </span></span><br><span class="line">    <span class="attr">done</span>: <span class="literal">true</span> <span class="comment">// æœŸæœ›çš„æ›´æ–°</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å› ä¸º nextState æ˜¯æ–°æ‹·è´çš„, æ‰€ä»¥ä½¿ç”¨ push æ–¹æ³•æ˜¯å®‰å…¨çš„,</span></span><br><span class="line"><span class="comment">// ä½†æ˜¯åœ¨æœªæ¥çš„ä»»æ„æ—¶é—´åšç›¸åŒçš„äº‹æƒ…ä¼šè¿åä¸å˜æ€§åŸåˆ™å¹¶ä¸”å¯¼è‡´ bugï¼</span></span><br><span class="line">nextState.<span class="title function_">push</span>(&#123;<span class="attr">title</span>: <span class="string">&quot;Tweet about it&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨Immer</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> produce <span class="keyword">from</span> <span class="string">&quot;immer&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nextState = <span class="title function_">produce</span>(baseState, <span class="function"><span class="params">draft</span> =&gt;</span> &#123;</span><br><span class="line">    draft[<span class="number">1</span>].<span class="property">done</span> = <span class="literal">true</span></span><br><span class="line">    draft.<span class="title function_">push</span>(&#123;<span class="attr">title</span>: <span class="string">&quot;Tweet about it&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>â€‹    ä»ä¸Šå¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨Immerä¼šæŠŠæ›´æ”¹åº”ç”¨å½“å‰çš„è‰ç¨¿<code>draft</code>ä¸Šï¼Œå®ƒæ˜¯å½“å‰çŠ¶æ€çš„ä»£ç†ï¼Œä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†æ‰€æœ‰çš„æ›´æ”¹ï¼ŒImmerä¼šæ ¹æ®<code>draft</code>ä¸Š<code>state</code>çš„æ›´æ”¹ç”Ÿæˆæ–°çš„<code>nextState</code>,å·¥ä½œåŸç†ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/cb718876426441449f9ffdf19e58a76a.png" alt=""></p>
<p>â€‹    å¼•ç”¨å®˜æ–¹æ–‡æ¡£ä¸­çš„ä¸€æ®µè¯ï¼Œæ¥è§£é‡ŠImmerçš„ä½œç”¨</p>
<blockquote>
<p>Using Immer is like having a personal assistant. The assistant takes a letter (the current state) and gives you a copy (draft) to jot changes onto. Once you are done, the assistant will take your draft and produce the real immutable, final letter for you (the next state).</p>
<p>ä½¿ç”¨ Immer å°±åƒæ‹¥æœ‰ä¸€ä¸ªç§äººåŠ©ç†ã€‚åŠ©æ‰‹æ‹¿ä¸€å°ä¿¡ï¼ˆå½“å‰çŠ¶æ€ï¼‰å¹¶ç»™æ‚¨ä¸€ä»½å‰¯æœ¬ï¼ˆè‰ç¨¿ï¼‰ä»¥è®°å½•æ›´æ”¹ã€‚å®Œæˆåï¼ŒåŠ©æ‰‹å°†æ¥å—æ‚¨çš„è‰ç¨¿å¹¶ä¸ºæ‚¨ç”ŸæˆçœŸæ­£ä¸å˜çš„æœ€ç»ˆä¿¡ä»¶ï¼ˆä¸‹ä¸€ä¸ªçŠ¶æ€ï¼‰ã€‚</p>
</blockquote>
<p>â€‹    è¿™ä¸ªâ€œç§äººåŠ©ç†â€å…¶å®æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡Proxyï¼Œæˆ‘åœ¨reduxä¸­ä¹Ÿåšäº†è¿›ä¸€æ­¥çš„éªŒè¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// /redux/optionSlice.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line">        <span class="attr">changedata</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="variable language_">console</span>.<span class="title function_">log</span>(state)</span><br><span class="line">            state.<span class="property">dataName</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">changemode</span>: (<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">            state.<span class="property">mode</span> = action.<span class="property">payload</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>â€‹    æˆ‘åœ¨ä»£ç ä¸­æ‰“å°äº†stateï¼Œå¹¶åœ¨æ§åˆ¶å°æŸ¥çœ‹äº†å®ƒçš„è¾“å‡ºï¼Œç¡®å®æ˜¯ä¸€ä¸ªProxyå¯¹è±¡ã€‚</p>
<p><img src="https://img-blog.csdnimg.cn/267bc47df3a14d86a7f497924999de9e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="Redux-toolkitä¸­createSlice-çš„ä½¿ç”¨"><a href="#Redux-toolkitä¸­createSlice-çš„ä½¿ç”¨" class="headerlink" title="Redux-toolkitä¸­createSlice()çš„ä½¿ç”¨"></a>Redux-toolkitä¸­<code>createSlice()</code>çš„ä½¿ç”¨</h3><p>åœ¨æµ…äº†è§£äº†Immer.jsåï¼Œæˆ‘å›åˆ°å®˜æ–¹æ–‡æ¡£ä¸­é˜…è¯»å‰©ä½™éƒ¨åˆ†ã€‚å¹¶æ•´ç†äº†ä»¥ä¸‹å¯¹æˆ‘å¯èƒ½æœ‰å¸®åŠ©çš„ç‚¹ </p>
<h4 id="çŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œä¸ºä»€ä¹ˆä¼šå¼•å…¥Immer-js"><a href="#çŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œä¸ºä»€ä¹ˆä¼šå¼•å…¥Immer-js" class="headerlink" title="çŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œä¸ºä»€ä¹ˆä¼šå¼•å…¥Immer.js"></a>çŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œä¸ºä»€ä¹ˆä¼šå¼•å…¥Immer.js</h4><p>â€‹    è¦åˆ†æçŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œé¦–å…ˆæˆ‘ä»¬è¦å¼•å…¥çš„ä¸€ä¸ªé—®é¢˜æ˜¯Reduxä¸­ä¸å¯æ”¹å˜çŠ¶æ€çš„å‡ ä¸ªåŸå› ã€‚å®˜æ–¹æ–‡æ¡£ä¸­åˆ—å‡ºäº†äº”æ¡åŸå› ï¼Œä½†æˆ‘è®¤ä¸ºæœ€é‡è¦çš„æ˜¯ç¬¬ä¸€æ¡ï¼š<strong>ä¼šå¯¼è‡´bugï¼Œä¾‹å¦‚UIæ— æ³•æ­£ç¡®æ›´æ–°æ˜¾ç¤ºæœ€æ–°å€¼</strong>ã€‚</p>
<p>â€‹    é‚£ä¹ˆreduxä¸èƒ½æ›´æ”¹åŸå§‹çŠ¶æ€ï¼Œæˆ‘ä»¬å¦‚ä½•è¿”å›æ›´æ–°åçš„çŠ¶æ€å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åœ¨Reducerä¸­åªèƒ½æ‹·è´åŸå§‹å€¼ï¼Œä¿®æ”¹å‰¯æœ¬å¹¶è¿”å›å‰¯æœ¬ã€‚å¦‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âœ… This is safe, because we made a copy</span></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  ...state,</span><br><span class="line">  <span class="attr">value</span>: <span class="number">123</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹    è¿™ä¹Ÿè®©æˆ‘æƒ³åˆ°äº†ä¹‹å‰åœ¨å†™ç±»ç»„ä»¶æ—¶ï¼Œå¿…é¡»è¦ç”¨æ‹·è´çš„æ–¹å¼ä¿®æ”¹ï¼Œå¦‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">setState</span>(<span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">  &#123;...state,<span class="attr">key</span>:newValue&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>â€‹    æˆ‘çŒœå’ŒImmer.jsä¹Ÿæœ‰å…³ç³»ã€‚</p>
<p>â€‹    è¿™æ ·ä¿®æ”¹å½“ç„¶OKæ²¡æœ‰é—®é¢˜ï¼Œ<strong>ä½†æ˜¯å¦‚æœçŠ¶æ€ä¹‹ä¸­åµŒå¥—äº†è®¸å¤šå±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸€å±‚éƒ½è¿›è¡Œæ‹·è´</strong>ï¼Œè¿™æ ·çš„ä»£ç ç»´æŠ¤æ–¹å¼æ˜¾ç„¶æ˜¯ç¾éš¾ä¸€æ ·çš„å­˜åœ¨ï¼è¿™é‡Œæˆ‘è´´ä¸Šå®˜ç½‘ç»™çš„ä¾‹å­ã€‚</p>
<blockquote>
<p>æ‰‹åŠ¨ç¼–å†™ä¸å¯å˜çš„æ›´æ–°é€»è¾‘å¾ˆå›°éš¾ï¼Œå¹¶ä¸”<strong>åœ¨ reducer ä¸­æ„å¤–æ”¹å˜çŠ¶æ€æ˜¯ Redux ç”¨æˆ·æœ€å¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯</strong>ã€‚</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">handwrittenReducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    ...state,</span><br><span class="line">    <span class="attr">first</span>: &#123;</span><br><span class="line">      ...state.<span class="property">first</span>,</span><br><span class="line">      <span class="attr">second</span>: &#123;</span><br><span class="line">        ...state.<span class="property">first</span>.<span class="property">second</span>,</span><br><span class="line">        [action.<span class="property">someId</span>]: &#123;</span><br><span class="line">          ...state.<span class="property">first</span>.<span class="property">second</span>[action.<span class="property">someId</span>],</span><br><span class="line">          <span class="attr">fourth</span>: action.<span class="property">someValue</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â€‹    æ‰€ä»¥ï¼Œå¼•å…¥äº†Immerï¼ŒImmeræ˜¯ä¸€ä¸ªåº“ï¼Œç®€åŒ–äº†ç¼–å†™ä¸å¯å˜æ›´æ–°é€»è¾‘çš„è¿‡ç¨‹ã€‚Immerçš„å·¥ä½œæµç¨‹æˆ‘ä»¬åœ¨ä¸Šæ–‡ä¸­å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œä¸åšè¿‡å¤šèµ˜è¿°ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒReactToolkitçš„<code>createReducer</code>å’Œ<code>createSlice</code>éƒ½åœ¨å†…éƒ¨ä½¿ç”¨äº†Immerã€‚ä¸Šæ–‡æˆ‘ä¹Ÿå·²ç»éªŒè¯è¿‡äº†<code>state</code>æ˜¯ä¸€ä¸ªä»£ç†ã€‚</p>
<h4 id="æ›´æ”¹çŠ¶æ€çš„ä¸¤ç§æ–¹å¼ï¼šresetä¸replace"><a href="#æ›´æ”¹çŠ¶æ€çš„ä¸¤ç§æ–¹å¼ï¼šresetä¸replace" class="headerlink" title="æ›´æ”¹çŠ¶æ€çš„ä¸¤ç§æ–¹å¼ï¼šresetä¸replace"></a>æ›´æ”¹çŠ¶æ€çš„ä¸¤ç§æ–¹å¼ï¼š<code>reset</code>ä¸<code>replace</code></h4><ul>
<li>reset</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// reset ä¿®æ”¹</span></span><br><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">todoDeleted</span>(<span class="params">state, action.payload</span>) &#123;</span><br><span class="line">      <span class="comment">// Construct a new array immutably</span></span><br><span class="line">      <span class="keyword">const</span> newTodos = state.<span class="property">todos</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">id</span> !== action.<span class="property">payload</span>)</span><br><span class="line">      <span class="comment">// &quot;Mutate&quot; the existing state to save the new array</span></span><br><span class="line">      state.<span class="property">todos</span> = newTodos</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>replace</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// replace æ›¿æ¢</span></span><br><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">todoDeleted</span>(<span class="params">state, action.payload</span>) &#123;</span><br><span class="line">      <span class="comment">// Construct a new result array immutably and return it</span></span><br><span class="line">      <span class="keyword">return</span> state.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">id</span> !== action.<span class="property">payload</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªæ˜“é”™çš„åœ°æ–¹ï¼Œå°±æ˜¯æœ‰ä¸€äº›ä¿®æ”¹å‡½æ•°ä¼šæœ‰é»˜è®¤è¿”å›å€¼ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹çŠ¶æ€åæœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œreducerå°±ä¸çŸ¥é“åº”è¯¥ä½¿ç”¨å“ªä¸ªå€¼ä½œä¸ºæœ€æ–°çš„çŠ¶æ€äº†ã€‚å¦‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="comment">// âŒ ERROR: mutates state, but also returns new array size!</span></span><br><span class="line">    <span class="attr">brokenReducer</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> state.<span class="title function_">push</span>(action.<span class="property">payload</span>),</span><br><span class="line">    <span class="comment">// âœ… SAFE: the `void` keyword prevents a return value</span></span><br><span class="line">    <span class="attr">fixedReducer1</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> <span class="keyword">void</span> state.<span class="title function_">push</span>(action.<span class="property">payload</span>),</span><br><span class="line">    <span class="comment">// âœ… SAFE: curly braces make this a function body and no return</span></span><br><span class="line">    <span class="attr">fixedReducer2</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="title function_">push</span>(action.<span class="property">payload</span>)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<h4 id="å¦‚ä½•è¾“å‡ºå½“å‰çŠ¶æ€"><a href="#å¦‚ä½•è¾“å‡ºå½“å‰çŠ¶æ€" class="headerlink" title="å¦‚ä½•è¾“å‡ºå½“å‰çŠ¶æ€"></a>å¦‚ä½•è¾“å‡ºå½“å‰çŠ¶æ€</h4><p>â€‹    æƒ³è¦ä»reducerä¸­è®°å½•æ­£åœ¨è¿›è¡Œçš„çŠ¶æ€ä»¥æŸ¥çœ‹å®ƒåœ¨æ›´æ–°æ—¶çš„æ ·å­ï¼Œè¿™ä¸ªåœºæ™¯æ˜¯å¾ˆå¸¸è§çš„ã€‚ä½†ä¸å¹¸çš„æ˜¯ï¼Œç›´æ¥è¾“å‡º<code>state</code>æ˜¯ä¸€ä¸ª<code>Proxy</code>å¯¹è±¡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒImmeræä¾›äº†ä¸€ä¸ªå‡½æ•°<code>current()</code>ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹çŠ¶æ€å¯ä»¥ä½¿ç”¨å®ƒ</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">todoToggled</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">      <span class="comment">// âŒ ERROR: logs the Proxy-wrapped data</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(state)</span><br><span class="line">      <span class="comment">// âœ… CORRECT: logs a plain JS copy of the current data</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">current</span>(state))</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h4 id="ä¸ºä»€ä¹ˆä¼šå¼•å…¥Immerï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¼šå¼•å…¥Immerï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå¼•å…¥Immerï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¼šå¼•å…¥Immerï¼Ÿ</h4><p>â€‹    ä¸‹é¢ä¸‰ç‚¹æ˜¯æˆ‘å¯¹å®˜æ–¹æ–‡æ¡£çš„ä¸€ä¸ªæ€»ç»“ä¸å¤è¿°</p>
<ul>
<li><p>ä½¿ç”¨Immerçš„ä¼˜ç‚¹</p>
<ul>
<li>Immeræå¤§ç®€åŒ–äº†ä¸å¯å˜çš„æ›´æ–°é€»è¾‘</li>
<li>å‡å°‘äº†reduceræ›´æ–°çŠ¶æ€çš„ç¼–å†™é”™è¯¯ã€‚å¼•å…¥Immeråï¼Œæ— éœ€åˆ›å»ºå‰¯æœ¬ï¼Œç›´æ¥è¿›è¡Œä¿®æ”¹å³å¯ã€‚ï¼ˆç›¸å½“äºä½ æŠŠä¿®æ”¹çš„å·¥ä½œäº¤ç»™äº†ä¸€ä¸ªä»£ç†ï¼Œç”±ä»£ç†å¸®ä½ è¿›è¡Œä¿®æ”¹ï¼‰</li>
</ul>
</li>
<li><p>Immeråœ¨æ€§èƒ½ä¸Šçš„æƒè¡¡</p>
<ul>
<li>æ— éœ€è€ƒè™‘ï¼Œreducerå‡ ä¹ä»æ¥éƒ½ä¸æ˜¯Reduxåº”ç”¨ä¸­çš„æ€§èƒ½ç“¶é¢ˆ</li>
</ul>
</li>
<li><p>æ˜¯å¦è€ƒè™‘æœªæ¥å°†Immerè®¾ç½®ä¸ºå¯é€‰é¡¹ï¼Ÿ</p>
<ul>
<li>æˆ‘æœ‰é¢„æ„Ÿå¾ˆå¤šäººåœ¨ç®€å•çœ‹äº†Redux-toolkitæ–‡æ¡£å°±æ‹¿å»ç”¨äº†ä»¥åï¼Œéƒ½ä¼šç»™å®ƒä»¬æIssueã€‚å› ä¸ºè¿™ä¸ªå¯¹è±¡çš„ä¸å¯å˜æ€§ç¨å¾®ä¸ç•™æ„å°±ä¼šå‡ºé”™ï¼ˆä½†æ˜¯ä¹ æƒ¯äº†å®ƒä»¬çš„å†™æ³•ä»¥åå…¶å®æ•ˆç‡æå‡å¾ˆå¤šï¼‰ã€‚å®˜æ–¹æ–‡æ¡£ä¸­ä¹Ÿç»™å‡ºäº†ä¸ºä»€ä¹ˆä¸æ‰“ç®—å°†Immerè®¾ç½®ä¸ºå¯é€‰é¡¹çš„ç†ç”±ï¼Œå®ƒä»¬è¯´React-toolkitçš„æ¶æ„æ˜¯é€šè¿‡ç›´æ¥å¯¼å…¥Immeræ¥å®ç°çš„ï¼Œéœ€è¦åœ¨åº”ç”¨ç¨‹åºåŠ è½½æœŸé—´ç«‹å³åŒæ­¥ä½¿ç”¨Immerã€‚</li>
</ul>
<blockquote>
<p>And finally: <strong>Immer is built into RTK by default because we believe it is the best choice for our users!</strong> We <em>want</em> our users to be using Immer, and consider it to be a critical non-negotiable component of RTK. The great benefits like simpler reducer code and preventing accidental mutations far outweigh the relatively small concerns.</p>
<p>æœ€åï¼š<strong>Immer é»˜è®¤å†…ç½®åœ¨ React-toolkit ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬ç›¸ä¿¡å®ƒæ˜¯æˆ‘ä»¬ç”¨æˆ·çš„æœ€ä½³é€‰æ‹©ï¼</strong>æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„ç”¨æˆ·ä½¿ç”¨ Immerï¼Œå¹¶å°†å…¶è§†ä¸º React-toolkit çš„å…³é”®ç»„ä»¶ã€‚æ›´ç®€å•çš„ reducer ä»£ç å’Œé˜²æ­¢æ„å¤–çªå˜ç­‰å·¨å¤§å¥½å¤„ï¼Œè¿œè¿œè¶…è¿‡äº†é‚£äº›å¯ä»¥è¢«å¿½è§†çš„é—®é¢˜ã€‚</p>
</blockquote>
</li>
</ul>
<h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>â€‹    è¿™æ˜¯æˆ‘è§£å†³é—®é¢˜çš„å®Œæ•´è¿‡ç¨‹ï¼Œæœ€è¿‘åœ¨åšé¡¹ç›®ï¼Œå†™äº†å¥½ä¹…çš„æ–‡æ¡£ï¼Œå¥½ä¹…æ²¡æœ‰æ²‰æ·€è‡ªå·±çš„ä»£ç èƒ½åŠ›äº†ã€‚ç¢°å·§å‘¨æ—¥ï¼Œç¢°å·§é‡åˆ°äº†ä¸€ä¸ªå€¼å¾—è®°å½•çš„é—®é¢˜ï¼Œèµ¶ç´§æŠŠè‡ªå·±çš„æ€è€ƒè¿‡ç¨‹è½å®åœ¨äº†æ–‡å­—ã€‚</p>
<p>â€‹    ä»ç»„ä»¶ä¸­é€‰æ‹©çŠ¶æ€å‡æ ¼ä¸ºå…¨å±€è¿™æ˜¯ä¸€ä¸ªå€¼å¾—æ€è€ƒçš„é—®é¢˜ï¼Œæˆ‘ä¹Ÿè®¤ä¸ºè¿™æ˜¯å¾ˆè€ƒéªŒä¸€ä¸ªReactå†™æ‰‹èƒ½åŠ›çš„å·¥ä½œã€‚æœ€è¿‘åˆšå…¥é—¨Reactï¼Œæµ…è®°å½•ä¸€ä¸‹è§£å†³é—®é¢˜çš„å…¨è¿‡ç¨‹ã€‚</p>

      </div>
      
      
      
    </div>
    

    
    
    


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E9%87%8D%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">é—®é¢˜é‡è¿°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8redux-toolkit"><span class="nav-number">1.1.</span> <span class="nav-text">ä½¿ç”¨redux-toolkit</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8createSlice"><span class="nav-number">1.1.1.</span> <span class="nav-text">ä½¿ç”¨createSlice()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8index-js%E4%B8%AD%E8%9E%8D%E5%90%88%E4%B8%A4%E4%B8%AAsilce"><span class="nav-number">1.1.2.</span> <span class="nav-text">åœ¨index.jsä¸­èåˆä¸¤ä¸ªsilce</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8store-js%E9%85%8D%E7%BD%AEstore%EF%BC%8C%E5%B9%B6%E4%BD%BF%E7%94%A8-lt-Provider-store-store-gt-%E8%AE%A9%E6%89%80%E6%9C%89%E7%BB%84%E4%BB%B6%E9%83%BD%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8redux%E4%B8%AD%E7%AE%A1%E7%90%86%E7%9A%84%E7%8A%B6%E6%80%81"><span class="nav-number">1.1.3.</span> <span class="nav-text">åœ¨store.jsé…ç½®storeï¼Œå¹¶ä½¿ç”¨&lt;Provider store&#x3D;{store}&gt;è®©æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥ä½¿ç”¨reduxä¸­ç®¡ç†çš„çŠ¶æ€</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E8%8A%82%E7%82%B9%E9%93%BE%E6%8E%A5%E5%9B%BE"><span class="nav-number">1.2.</span> <span class="nav-text">ç»˜åˆ¶èŠ‚ç‚¹é“¾æ¥å›¾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%A5%E9%94%99%E9%87%8D%E7%8E%B0"><span class="nav-number">1.3.</span> <span class="nav-text">æŠ¥é”™é‡ç°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">2.</span> <span class="nav-text">è§£å†³æ–¹æ¡ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%87%E7%94%A8%E6%8B%B7%E8%B4%9D%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E5%BC%8F%E8%A7%A3%E5%86%B3%EF%BC%88%E7%AC%A8%E6%96%B9%E6%B3%95%EF%BC%89"><span class="nav-number">2.1.</span> <span class="nav-text">é‡‡ç”¨æ‹·è´å¯¹è±¡çš„æ–¹å¼è§£å†³ï¼ˆç¬¨æ–¹æ³•ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%8Aredux%E4%B8%AD%E5%AD%98%E5%82%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1%E6%9B%BF%E6%8D%A2%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%90%8D"><span class="nav-number">2.2.</span> <span class="nav-text">æŠŠreduxä¸­å­˜å‚¨çš„æ•°æ®å¯¹è±¡æ›¿æ¢ä¸ºæ•°æ®å</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90"><span class="nav-number">3.</span> <span class="nav-text">äº§ç”ŸåŸå› åˆ†æ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#immer-js-gt-%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">3.0.1.</span> <span class="nav-text">immer.js &#x3D;&gt; ä¸å¯å˜æ•°æ®ç»“æ„</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redux-toolkit%E4%B8%ADcreateSlice-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">3.1.</span> <span class="nav-text">Redux-toolkitä¸­createSlice()çš„ä½¿ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E7%9A%84%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%80%A7%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%BC%95%E5%85%A5Immer-js"><span class="nav-number">3.1.1.</span> <span class="nav-text">çŠ¶æ€çš„ä¸å¯å˜æ€§ï¼Œä¸ºä»€ä¹ˆä¼šå¼•å…¥Immer.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9%E7%8A%B6%E6%80%81%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9Areset%E4%B8%8Ereplace"><span class="nav-number">3.1.2.</span> <span class="nav-text">æ›´æ”¹çŠ¶æ€çš„ä¸¤ç§æ–¹å¼ï¼šresetä¸replace</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E8%BE%93%E5%87%BA%E5%BD%93%E5%89%8D%E7%8A%B6%E6%80%81"><span class="nav-number">3.1.3.</span> <span class="nav-text">å¦‚ä½•è¾“å‡ºå½“å‰çŠ¶æ€</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%BC%95%E5%85%A5Immer%EF%BC%9F"><span class="nav-number">3.1.4.</span> <span class="nav-text">ä¸ºä»€ä¹ˆä¼šå¼•å…¥Immerï¼Ÿ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%9D%E8%80%83"><span class="nav-number">4.</span> <span class="nav-text">æ€è€ƒ</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zqqcee"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">zqqcee</p>
  <div class="site-description" itemprop="description"> Research interest in Visualization and Visual Analytics <br> Contact Me: <a>zqqcee@gmail.com</a></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zqqcee" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;zqqcee" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/RRie1" title="CSDN â†’ https:&#x2F;&#x2F;blog.csdn.net&#x2F;RRie1" rel="noopener" target="_blank"><i class="fab fa-mailchimp fa-fw"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 â€“ 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">zqqcee</span>
</div>

<!--
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>
-->

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


</body>
</html>
